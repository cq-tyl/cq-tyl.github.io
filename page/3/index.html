<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
 <meta name="referrer" content="no-referrer"/>
    
    <title>TYL</title>
    
    
        <meta name="keywords" content="TYL" />
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="cq_tyl的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="TYL">
<meta property="og:url" content="https://cq_tyl.gitee.io/page/3/index.html">
<meta property="og:site_name" content="TYL">
<meta property="og:description" content="cq_tyl的个人博客">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="cq_tyl">
<meta name="twitter:card" content="summary">
    

    
        <link rel="alternate" href="/atom.xml" title="TYL" type="application/atom+xml" />
    

    
        <link rel="icon" href="/favicon.ico" />
    

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/libs/open-sans/styles.css">

    
<link rel="stylesheet" href="/libs/source-code-pro/styles.css">


    
<link rel="stylesheet" href="/css/style.css">

    
<script src="/libs/jquery/2.1.3/jquery.min.js"></script>

    
<script src="/libs/jquery/plugins/cookie/1.4.1/jquery.cookie.js"></script>

    
    
        
<link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">

    
    
        
<link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">

    
    
    
    


    
<meta name="generator" content="Hexo 6.3.0"></head>

<head></head>
<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">TYL</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/">首页</a>
                
                    <a class="main-nav-link" href="/about">我的简历</a>
                
            </nav>
            
            <div id="search-form-wrap">

    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="https://cq_tyl.gitee.io"></form>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/">首页</a></td>
                
                    <td><a class="main-nav-link" href="/about">我的简历</a></td>
                
                <td>
                    
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="https://cq_tyl.gitee.io"></form>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap" id='categories'>
        <h3 class="widget-title">
            <span>categories</span>
            &nbsp;
            <a id='allExpand' href="#">
                <i class="fa fa-angle-double-down fa-2x"></i>
            </a>
        </h3>
        
        
        
         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Android Application
                        </a>
                         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            AndroidStudio插件
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%20Application/AndroidStudio%E6%8F%92%E4%BB%B6/Alibaba-Java-Coding-Guidelines%EF%BC%88%E9%98%BF%E9%87%8C%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83%E6%A3%80%E6%B5%8B%EF%BC%89/">Alibaba-Java-Coding-Guidelines（阿里代码规范检测）</a></li>  <li class="file"><a href="/wiki/Android%20Application/AndroidStudio%E6%8F%92%E4%BB%B6/Studio%E6%B1%89%E5%8C%96%E6%8F%92%E4%BB%B6/">Studio汉化插件</a></li>  <li class="file"><a href="/wiki/Android%20Application/AndroidStudio%E6%8F%92%E4%BB%B6/%E7%BF%BB%E8%AF%91%E6%8F%92%E4%BB%B6Translation/">翻译插件Translation</a></li>  <li class="file"><a href="/wiki/Android%20Application/AndroidStudio%E6%8F%92%E4%BB%B6/database-navigator%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93/">Database-Navigator查看数据库</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Android兼容适配
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%20Application/Android%E5%85%BC%E5%AE%B9%E9%80%82%E9%85%8D/%E8%99%9A%E6%8B%9F%E6%8C%89%E9%94%AE%E9%81%AE%E6%8C%A1%E5%B8%83%E5%B1%80-%E9%9A%90%E8%97%8F%E5%BA%95%E9%83%A8%E8%99%9A%E6%8B%9F%E6%8C%89%E9%94%AENavigation%E5%AE%9E%E7%8E%B0%E5%85%A8%E5%B1%8F/">虚拟按键遮挡布局-隐藏底部虚拟按键Navigation实现全屏</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%85%BC%E5%AE%B9%E9%80%82%E9%85%8D/%E8%AE%BE%E7%BD%AEImageView%E5%9B%BE%E7%89%87%E6%97%B6,%E5%AE%BD%E5%BA%A6%E4%B8%BAmatch%E6%97%B6%E9%9C%80%E8%A6%81%E8%AE%BE%E7%BD%AEscaleType%E4%B8%BAfitXY/">设置ImageView图片时,宽度为match时需要设置scaleType为fitXY</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%85%BC%E5%AE%B9%E9%80%82%E9%85%8D/%E9%80%82%E9%85%8D%E5%8D%8E%E4%B8%BA%E7%AD%89%E6%9C%89%E8%99%9A%E6%8B%9F%E6%8C%89%E9%94%AE%E7%9A%84%E5%B1%8F%E5%B9%95%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">适配华为等有虚拟按键的屏幕的解决方案</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%85%BC%E5%AE%B9%E9%80%82%E9%85%8D/%E5%A4%9A%E4%B8%AAfragment%E9%87%8D%E5%8F%A0%E6%97%B6%EF%BC%8C%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6%E7%A9%BF%E9%80%8F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%EF%BC%88viewpager+fragment%EF%BC%89/">多个Fragment重叠时，点击事件穿透解决方法（viewpager+fragment）</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Android动画
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%20Application/Android%E5%8A%A8%E7%94%BB/LayoutTransition%EF%BC%88%E9%80%9A%E7%94%A8%E9%9A%90%E8%97%8F%E6%98%BE%E7%A4%BA%E5%8A%A8%E7%94%BB%EF%BC%89/">LayoutTransition（通用隐藏显示动画）</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%8A%A8%E7%94%BB/%E5%85%B1%E4%BA%AB%E5%85%83%E7%B4%A0%EF%BC%88Shared-Element%EF%BC%89/">共享元素（Shared-Element）</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%8A%A8%E7%94%BB/%E5%90%AF%E5%8A%A8%E9%A1%B5%E7%BC%A9%E6%94%BE%E5%8A%A8%E7%94%BB/">启动页缩放动画</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%8A%A8%E7%94%BB/%E5%B8%A7%E5%8A%A8%E7%94%BB/">帧动画</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%8A%A8%E7%94%BB/%E8%A1%A5%E9%97%B4%E5%8A%A8%E7%94%BB/">补间动画</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%8A%A8%E7%94%BB/%E6%8F%AD%E9%9C%B2%E6%95%88%E6%9E%9C/">揭露效果</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Android基础
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/JAV%E7%BA%BF%E7%A8%8B%E6%B1%A0/">JAV线程池</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/TCP%E5%8D%8F%E8%AE%AE%EF%BC%88Socket%EF%BC%89/">TCP协议（Socket）</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/Notifaction/">Notifaction</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/JAVA%E9%9B%86%E5%90%88/">JAVA集合</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/android-%E8%AE%A1%E6%97%B6%E5%99%A8%EF%BC%88Handle+Runable-%E5%8F%AF%E9%87%8D%E7%BD%AE%E6%97%B6%E9%97%B4%E5%8F%AF%E6%9A%82%E5%81%9C%EF%BC%89/">Android-计时器（Handle+Runable-可重置时间可暂停）</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/">JAVA多线程之间的通信</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/JSON%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90/">JSON数据解析</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/Sevice%EF%BC%88%E6%9C%8D%E5%8A%A1%EF%BC%89/">Sevice（服务）</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%EF%BC%88%E5%9F%BA%E7%A1%80%EF%BC%89/">类加载器（基础）</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/new-Random()--%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/">New-Random()--生成随机数</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">正则表达式</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/SharedPreferences%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/">SharedPreferences数据存储</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/android-popwind/">Android-Popwind</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/%E5%90%8C%E6%AD%A5%E9%94%81Synchronized%E5%92%8CLock/">同步锁Synchronized和Lock</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/Android-ConstraintLayout-%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/">Android-ConstraintLayout-使用详解</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/EditText%E7%84%A6%E7%82%B9%E5%8A%A8%E6%80%81%E6%8E%A7%E5%88%B6/">EditText焦点动态控制</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/StringBuffer%E5%92%8CStringBuilder/">StringBuffer和StringBuilder</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/ANR/">ANR</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/android-ImageView-scaleType%E7%9A%84%E5%B1%9E%E6%80%A7%E7%90%86%E8%A7%A3/">Android-ImageView-scaleType的属性理解</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/android%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91/">Android事件分发</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6/">逻辑运算符</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/Android-%E5%80%92%E8%AE%A1%E6%97%B6/">Android-倒计时</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/Android%E4%B8%AD%E6%8E%A5%E5%8F%A3%E5%9B%9E%E8%B0%83-%E6%96%B9%E6%B3%95%E5%9B%9E%E8%B0%83/">Android中接口回调-方法回调</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/android-6-0%E5%8A%A8%E6%80%81%E6%9D%83%E9%99%90/">Android-6-0动态权限</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/Android-M-%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E6%9D%83%E9%99%90%E8%AF%B7%E6%B1%82/">Android-M-最简单的权限请求</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/Toast%EF%BC%88%E8%87%AA%E5%AE%9A%E4%B9%89Toast%EF%BC%89/">Toast（自定义Toast）</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/android-6-0%E6%96%B0%E7%89%B9%E6%80%A7/">Android-6-0新特性</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1-AsyncTask/">异步任务-AsyncTask</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/AndroidManifest-xml/">AndroidManifest-Xml</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/Java-Character-%E7%B1%BB%EF%BC%88%E5%8D%95%E4%B8%AA%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B-%E5%AD%97%E6%AF%8D-%E6%95%B0%E5%AD%97-%E5%A4%A7%E5%B0%8F%E5%86%99%E5%88%A4%E6%96%AD%EF%BC%89/">Java-Character-类（单个字符串类型-字母-数字-大小写判断）</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/BroadCastReceiver(%E5%B9%BF%E6%92%AD)/">BroadCastReceiver(广播)</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/Iterator%E8%BF%AD%E4%BB%A3%E5%99%A8/">Iterator迭代器</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/UDP%E5%8D%8F%E8%AE%AE/">UDP协议</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/Activity%E5%90%91Fragment%E4%BC%A0%E5%80%BC/">Activity向Fragment传值</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%9F%BA%E7%A1%80/android%E5%AD%97%E9%97%B4%E8%B7%9D%E5%92%8C%E8%A1%8C%E9%97%B4%E8%B7%9D/">Android字间距和行间距</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Android工具类
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android%E5%8A%A8%E6%80%81%E4%BF%AE%E6%94%B9%E6%A1%8C%E9%9D%A2%E5%9B%BE%E6%A0%87%E5%8F%8A%E5%BA%94%E7%94%A8%E6%A1%8C%E9%9D%A2%E5%BA%94%E7%94%A8%E5%90%8D%E7%A7%B0/">Android动态修改桌面图标及应用桌面应用名称</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android%E5%8F%91%E5%B8%83%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BA%93%E5%88%B0JitPack%E4%B8%8A/">Android发布自定义库到JitPack上</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/JAVA%E5%86%85%E5%AD%98%E5%88%92%E5%88%86/">JAVA内存划分</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/android-studio-mac-%E8%8E%B7%E5%8F%96MD5-SHA1-SHA256%E8%AF%81%E4%B9%A6%E6%8C%87%E7%BA%B9/">Android-Studio-Mac-获取MD5-SHA1-SHA256证书指纹</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/android-textview%E7%A9%BA%E6%A0%BC%E5%8D%A0%E4%BD%8D%E7%AC%A6%E4%BB%A5%E5%8F%8A%E4%B8%80%E4%BA%9B%E5%85%B6%E4%BB%96%E5%8D%A0%E4%BD%8D%E7%AC%A6%E6%B1%87%E6%80%BB/">Android-Textview空格占位符以及一些其他占位符汇总</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/github%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E5%A4%B1%E8%B4%A5/">Github图片加载失败</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/%E5%88%A4%E6%96%AD%E6%9F%90%E4%B8%AAactivity%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%A0%88%E5%A0%86%E4%B8%AD/">判断某个Activity是否存在栈堆中</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Androd-%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8/">Androd-开机自启动</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android-%E5%9C%A8%E6%B2%A1%E6%9C%89usb%E8%BF%9E%E6%8E%A5%E7%BA%BF%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E5%A6%82%E4%BD%95%E8%BF%9E%E6%8E%A5%E6%89%8B%E6%9C%BA%E8%AE%BE%E5%A4%87/">Android-在没有Usb连接线的情况下如何连接手机设备</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android%E4%BF%9D%E6%B4%BB/">Android保活</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android%E5%B0%86String%E5%88%86%E5%89%B2%E8%BD%AC%E5%8C%96%E4%B8%BAArrayList/">Android将String分割转化为ArrayList</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%9B%E4%B8%AA%E6%96%B9%E5%90%91%E6%BB%9A%E5%8A%A8%E7%9A%84%E8%B7%91%E9%A9%AC%E7%81%AFMarqueeViewLibrary/">Android自定义四个方向滚动的跑马灯MarqueeViewLibrary</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android%E7%AC%AC%E4%B8%89%E6%96%B9%E5%B8%B8%E7%94%A8%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B/">Android第三方常用安全漏洞检测</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/EventBus/">EventBus</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Glide%E8%AE%BE%E7%BD%AE%E5%9C%86%E8%A7%92%E3%80%81%E5%9C%86%E5%BD%A2%E5%9B%BE%E7%89%87%EF%BC%88%E6%97%A0%E9%9C%80%E5%86%8D%E5%88%9B%E5%BB%BA%E5%B7%A5%E5%85%B7%E7%B1%BB%E4%BA%86%EF%BC%89/">Glide设置圆角、圆形图片（无需再创建工具类了）</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/GreenDao/">GreenDao</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/RxJava-RxAndroid/">RxJava-RxAndroid</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Sentry-Android%E9%9B%86%E6%88%90-%E4%BD%BF%E7%94%A8-%E6%B7%B7%E6%B7%86/">Sentry-Android集成-使用-混淆</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Svn%E5%BF%BD%E7%95%A5Android%E9%A1%B9%E7%9B%AE%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6-%E6%96%87%E4%BB%B6%E5%A4%B9/">Svn忽略Android项目上传文件-文件夹</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/android-RadioButton-drawableTop%E5%9B%BE%E7%89%87%E5%8F%98%E5%9E%8B/">Android-RadioButton-drawableTop图片变型</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/android-%E6%9C%AC%E5%9C%B0%E6%97%A5%E5%8E%86%E6%8F%92%E5%85%A5%E4%BA%8B%E4%BB%B6/">Android-本地日历插入事件</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/android-%E8%8E%B7%E5%8F%96assets%E5%86%85%E7%9A%84%E6%96%87%E4%BB%B6%E8%BD%ACFile/">Android-获取assets内的文件转File</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/android-%E8%BD%AF%E9%94%AE%E7%9B%98%E5%B7%A5%E5%85%B7%E7%B1%BB/">Android-软键盘工具类</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/android-%E9%80%8F%E6%98%8E%E5%BA%A6%E6%95%B0%E5%80%BC%E8%AE%B0%E5%BD%95%E8%A1%A8/">Android-透明度数值记录表</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/android%E6%98%8E%E8%BF%9B%E5%BA%B75-1%E7%9B%92%E5%AD%90%E5%AE%9A%E6%97%B6%E5%BC%80%E5%85%B3%E6%9C%BA/">Android明进康5-1盒子定时开关机</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/android%E8%B0%83%E8%AF%95%E8%BE%93%E5%87%BAlog%E6%89%93%E5%8D%B0%E4%BF%A1%E6%81%AF%E5%88%B0%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6/">Android调试输出log打印信息到本地文件</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/app%E6%98%AF%E5%90%A6%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C-%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81/">App是否正在运行-运行状态</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/%E5%9C%A8%E7%BA%BF%E5%9B%BE%E7%89%87%E5%8E%BB%E5%BA%95%E5%B7%A5%E5%85%B7---%E5%B0%86%E7%BA%AF%E8%89%B2%E8%83%8C%E6%99%AF%E7%9A%84%E5%9B%BE%E7%89%87%E8%BD%AC%E6%8D%A2%E4%B8%BA%E8%83%8C%E6%99%AF%E9%80%8F%E6%98%8E%E7%9A%84%E5%9B%BE%E7%89%87/">在线图片去底工具---将纯色背景的图片转换为背景透明的图片</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9C%86%E5%BD%A2%E5%A4%B4%E5%83%8FCircleImageView%E7%9A%84%E4%BD%BF%E7%94%A8/">自定义圆形头像CircleImageView的使用</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android-Gps-%E4%BD%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E5%BC%80%E5%85%B3%E6%A3%80%E6%B5%8B/">Android-Gps-位置信息开关检测</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/android-eclpse%E5%BF%AB%E6%8D%B7%E9%94%AE%E5%A4%A7%E5%85%A8/">Android-Eclpse快捷键大全</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/java-android-%E9%93%B6%E8%A1%8C%E5%8D%A1%E5%8F%B7%E6%9F%A5%E8%AF%A2%E9%93%B6%E8%A1%8C%E5%8D%A1%E7%B1%BB%E5%9E%8B%E5%8F%8A%E5%90%8D%E7%A7%B0/">Java-Android-银行卡号查询银行卡类型及名称</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android-RecyclerView%E5%AE%9E%E7%8E%B0%E6%A8%AA%E5%90%91%E6%BB%91%E5%8A%A8%E7%BF%BB%E9%A1%B5/">Android-RecyclerView实现横向滑动翻页</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/VAPTCHA-ANDROID-SDK%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/">VAPTCHA-ANDROID-SDK部署文档</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android-Jenkins%E8%87%AA%E5%8A%A8%E6%89%93%E5%8C%85/">Android-Jenkins自动打包</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android%E5%88%A4%E6%96%ADUrl%E6%A0%BC%E5%BC%8F%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE/">Android判断Url格式是否正确</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/marktext/">Marktext</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/%E8%87%AA%E5%88%B6-9%E5%9B%BE%E5%AE%9E%E7%8E%B0%E5%92%8C%E8%AE%BE%E8%AE%A1%E5%9B%BE%E4%B8%80%E8%87%B4%E7%9A%84%E9%98%B4%E5%BD%B1%E6%95%88%E6%9E%9C/">自制-9图实现和设计图一致的阴影效果</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android-pcm%E8%BD%AC%E7%A0%81wav/">Android-Pcm转码wav</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android-%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E7%9A%84%E6%97%8B%E8%BD%AC%E8%A7%92%E5%BA%A6/">Android-获取当前屏幕的旋转角度</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/android-%E4%BF%9D%E5%AD%98%E5%9B%BE%E7%89%87%E5%88%B0%E6%9C%AC%E5%9C%B0%E7%9B%B8%E5%86%8C%E5%B9%B6%E5%8F%8A%E6%97%B6%E6%9B%B4%E6%96%B0%E6%98%BE%E7%A4%BA/">Android-保存图片到本地相册并及时更新显示</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/android-%E5%A4%9A%E8%AF%AD%E8%A8%80%E5%88%87%E6%8D%A2/">Android-多语言切换</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/adb%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">Adb常用命令</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/adb%E9%85%8D%E7%BD%AE/">Adb配置</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android%20SildingMenu%EF%BC%88%E4%BE%A7%E6%BB%91%E8%8F%9C%E5%8D%95%EF%BC%89%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7/">Android SildingMenu（侧滑菜单）常用属性</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/Android%E5%9B%BE%E7%89%87%E6%89%8B%E5%8A%BF%E6%8E%A7%E4%BB%B6/">Android图片手势控件</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/DeBug%E8%B0%83%E8%AF%95/">DeBug调试</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/EditText%E5%BC%B9%E5%87%BA%E9%94%AE%E7%9B%98%E6%97%B6%E6%BB%9A%E5%8A%A8%E5%88%B0%E7%95%8C%E9%9D%A2%E6%8C%87%E5%AE%9A%E4%BD%8D%E7%BD%AE/">EditText弹出键盘时滚动到界面指定位置</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/%E6%97%A0%E9%9A%9C%E7%A2%8D%E5%8D%87%E7%BA%A7/">无障碍升级</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E5%B7%A5%E5%85%B7%E7%B1%BB/%E5%88%A4%E6%96%AD%E5%BD%93%E5%89%8D%E5%BA%94%E7%94%A8%E6%98%AF%E5%90%A6%E9%80%80%E5%88%B0%E5%90%8E%E5%8F%B0/">判断当前应用是否退到后台</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Android日常记录
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/Activity%E7%9A%84%E5%9B%9B%E7%A7%8D%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F/">Activity的四种启动模式</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/Android-Elevation/">Android-Elevation</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/Android-%E6%A0%B9%E6%8D%AE%E9%80%97%E5%8F%B7%E5%88%86%E9%9A%94String/">Android-根据逗号分隔String</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/Android%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">Android内存管理</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/Android%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">Android常用设计模式</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/Android%E8%87%AA%E5%AE%9A%E4%B9%89View/">Android自定义View</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/Anroid-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E4%BD%93%E6%A0%B7%E5%BC%8F/">Anroid-自定义字体样式</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/EditText%E4%B8%8D%E8%87%AA%E5%8A%A8%E8%8E%B7%E5%8F%96%E7%84%A6%E7%82%B9/">EditText不自动获取焦点</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/GlidePalette%E8%8E%B7%E5%8F%96%E5%9B%BE%E7%89%87%E8%83%8C%E6%99%AF%E8%89%B2/">GlidePalette获取图片背景色</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/Handler/">Handler</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E5%AE%89%E5%85%A8%E9%80%80%E5%87%BA%E7%BA%BF%E7%A8%8B%E6%96%B9%E6%B3%95/">Java多线程编程安全退出线程方法</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/android-MultiDex%E5%88%86%E5%8C%85/">Android-MultiDex分包</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/android-textview%E5%8A%A8%E6%80%81%E4%BF%AE%E6%94%B9%E6%8C%87%E5%AE%9A%E6%96%87%E5%AD%97%E9%A2%9C%E8%89%B2/">Android-Textview动态修改指定文字颜色</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/android-%E6%A0%B9%E6%8D%AE%E4%B8%89%E7%82%B9%E5%9D%90%E6%A0%87%E6%B1%82%E4%B8%89%E8%A7%92%E5%BD%A2%E9%9D%A2%E7%A7%AF/">Android-根据三点坐标求三角形面积</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/android-%E8%8B%B1%E6%96%87%E5%8D%95%E8%AF%8D%E5%8D%87%E5%BA%8F%E6%8E%92%E5%BA%8F%EF%BC%88Collections-sort()%EF%BC%89/">Android-英文单词升序排序（Collections-Sort()）</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/android%E4%B8%AD%E6%9B%B4%E6%96%B0UI%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/">android中更新UI的几种方式</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/viewpager%E8%87%AA%E5%AE%9A%E4%B9%89%E6%BB%91%E5%8A%A8%E9%80%9F%E5%BA%A6/">Viewpager自定义滑动速度</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/%E6%95%B0%E6%8D%AE%E5%BA%8F%E5%88%97%E5%8C%96%E6%96%B9%E6%A1%88/">数据序列化方案</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/%E7%A8%8B%E5%BA%8F%E5%91%98%E5%BF%85%E7%9F%A5%E7%9A%846%E7%82%B9%E7%BC%96%E7%A8%8B%E7%A7%98%E8%AF%80/">程序员必知的6点编程秘诀</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%8E%86-%E6%8F%92%E5%85%A5%E9%87%8D%E5%A4%8D%E4%BA%8B%E4%BB%B6%E8%A7%84%E5%88%99-(android-java)/">系统日历-插入重复事件规则-(Android-Java)</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Android日常问题
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E9%97%AE%E9%A2%98/Android-9-0-P-http-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E7%9A%84%E9%97%AE%E9%A2%98/">Android-9-0-P-Http-网络请求的问题</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E9%97%AE%E9%A2%98/Android-FaceBook%E7%99%BB%E5%BD%95-%E5%88%86%E4%BA%AB%E8%8E%B7%E5%8F%96HashKey%EF%BC%88%E5%AF%86%E9%92%A5%E6%95%A3%E5%88%97%EF%BC%89%E7%9A%84%E7%AE%80%E5%8D%95%E6%96%B9%E6%B3%95/">Android-FaceBook登录-分享获取HashKey（密钥散列）的简单方法</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E9%97%AE%E9%A2%98/Android-studio-%E7%82%B9%E5%87%BB%E8%BF%90%E8%A1%8C%E6%80%BB%E6%98%AF%E8%BF%9B%E5%85%A5Debug%E6%A8%A1%E5%BC%8F/">Android-Studio-点击运行总是进入Debug模式</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E9%97%AE%E9%A2%98/Android%E8%BF%9B%E7%A8%8B%E4%BF%9D%E6%B4%BB-%E6%81%AF%E5%B1%8F%E5%90%8E%E5%90%8E%E5%8F%B0%E4%BF%9D%E6%8C%81%E5%AE%9A%E4%BD%8D%E3%80%81%E7%BD%91%E7%BB%9C%E8%BF%90%E8%A1%8C/">Android进程保活-息屏后后台保持定位、网络运行</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E9%97%AE%E9%A2%98/DatePickerDialog--setMinDate-setMaxDate%E5%90%8E%E6%A0%87%E9%A2%98%E9%9A%8F%E7%9D%80%E5%8F%98%E5%8C%96-%EF%BC%88%E5%8E%BB%E6%8E%89%E6%A0%87%E9%A2%98%EF%BC%89/">DatePickerDialog--setMinDate-setMaxDate后标题随着变化-（去掉标题）</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E9%97%AE%E9%A2%98/recyclerview-smoothScrollToPosition()%E5%B9%B3%E6%BB%91%E5%A4%B1%E6%95%88-%E6%9C%AA%E8%B5%B7%E6%95%88%E6%9E%9C/">Recyclerview-smoothScrollToPosition()平滑失效-未起效果</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E9%97%AE%E9%A2%98/%E8%BD%AF%E9%94%AE%E7%9B%98%E5%BC%B9%E5%87%BA%E5%90%8E%E5%B8%83%E5%B1%80%E4%B8%8A%E7%A7%BB/">软键盘弹出后布局上移</a></li>  <li class="file"><a href="/wiki/Android%20Application/Android%E6%97%A5%E5%B8%B8%E9%97%AE%E9%A2%98/studio%E6%8F%92%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%85%A2%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">Studio插件下载慢解决方法</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Material-Design新控件
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%20Application/Material-Design%E6%96%B0%E6%8E%A7%E4%BB%B6/AppbarLayout/">AppbarLayout</a></li>  <li class="file"><a href="/wiki/Android%20Application/Material-Design%E6%96%B0%E6%8E%A7%E4%BB%B6/Chronometer%E8%AE%A1%E6%97%B6%E5%99%A8/">Chronometer计时器</a></li>  <li class="file"><a href="/wiki/Android%20Application/Material-Design%E6%96%B0%E6%8E%A7%E4%BB%B6/FloatingActionButton(%E6%82%AC%E6%B5%AE%E6%8C%89%E9%92%AE)/">FloatingActionButton(悬浮按钮)</a></li>  <li class="file"><a href="/wiki/Android%20Application/Material-Design%E6%96%B0%E6%8E%A7%E4%BB%B6/Snackbar/">Snackbar</a></li>  <li class="file"><a href="/wiki/Android%20Application/Material-Design%E6%96%B0%E6%8E%A7%E4%BB%B6/SwitchCompat/">SwitchCompat</a></li>  <li class="file"><a href="/wiki/Android%20Application/Material-Design%E6%96%B0%E6%8E%A7%E4%BB%B6/TabLayout/">TabLayout</a></li>  <li class="file"><a href="/wiki/Android%20Application/Material-Design%E6%96%B0%E6%8E%A7%E4%BB%B6/TextInputLayout/">TextInputLayout</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            android-https双向验证
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%20Application/android-https%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81/Glide-okhttps%E8%AF%81%E4%B9%A6%E9%AA%8C%E8%AF%81%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE/">Glide-Okhttps证书验证全局配置</a></li>  <li class="file"><a href="/wiki/Android%20Application/android-https%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81/P12%E8%AF%81%E4%B9%A6%E8%BD%ACBKS%E8%AF%81%E4%B9%A6/">P12证书转BKS证书</a></li>  <li class="file"><a href="/wiki/Android%20Application/android-https%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81/android-https%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81-%E6%80%BB%E7%BB%93/">Android-Https双向验证-总结</a></li>  <li class="file"><a href="/wiki/Android%20Application/android-https%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81/android-okhttps%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81/">Android-Okhttps双向验证</a></li>  <li class="file"><a href="/wiki/Android%20Application/android-https%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81/android-webView%E7%9A%84%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81/">Android-webView的双向验证</a></li>  <li class="file"><a href="/wiki/Android%20Application/android-https%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81/android-%E5%8D%95%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81%E7%9F%A5%E8%AF%86%E7%82%B9/">Android-单双向验证知识点</a></li>  <li class="file"><a href="/wiki/Android%20Application/android-https%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81/android%E8%8E%B7%E5%8F%96%E8%AF%81%E4%B9%A6%E6%96%87%E4%BB%B6/">Android获取证书文件</a></li>  <li class="file"><a href="/wiki/Android%20Application/android-https%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81/https%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81%E8%AF%81%E4%B9%A6%E7%94%9F%E6%88%90/">Https双向认证证书生成</a></li>  <li class="file"><a href="/wiki/Android%20Application/android-https%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81/phpstudy%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8/">Phpstudy搭建本地服务器</a></li>  <li class="file"><a href="/wiki/Android%20Application/android-https%E5%8F%8C%E5%90%91%E9%AA%8C%E8%AF%81/%E9%85%8D%E7%BD%AE%E5%AE%8C%E6%88%90%E5%90%8E%E7%9A%84%E6%B5%8B%E8%AF%95/">配置完成后的测试</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            android-加密-解密-数据压缩
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%20Application/android-%E5%8A%A0%E5%AF%86-%E8%A7%A3%E5%AF%86-%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9/android-%E5%8E%9F%E7%94%9Fbase64/">Android-原生Base64</a></li>  <li class="file"><a href="/wiki/Android%20Application/android-%E5%8A%A0%E5%AF%86-%E8%A7%A3%E5%AF%86-%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9/10%E8%BF%9B%E5%88%B6%E8%BD%AC20%E8%BF%9B%E5%88%B6%EF%BC%88%E4%BB%BB%E6%84%8F%E8%BF%9B%E5%88%B6-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E7%AC%A6%EF%BC%89/">10进制转20进制（任意进制-自定义字符）</a></li>  <li class="file"><a href="/wiki/Android%20Application/android-%E5%8A%A0%E5%AF%86-%E8%A7%A3%E5%AF%86-%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9/%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95%E8%BF%9B%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8E%8B%E7%BC%A9/">压缩算法进行字符串压缩</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            rxjava2
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%20Application/rxjava2/Rxjava2%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">Rxjava2的基本使用</a></li>  <li class="file"><a href="/wiki/Android%20Application/rxjava2/rxjava2%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/">Rxjava2基本概念</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Android FrameWork
                        </a>
                         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Framework源码分析
                        </a>
                         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Android 13
                        </a>
                         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            InPutManagerService
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/InPutManagerService/3.InputReader%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86/">3.InputReader事件处理</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/InPutManagerService/1.InputFlinger%E7%9A%84%E5%90%AF%E5%8A%A8/">1.InputFlinger的启动</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/InPutManagerService/2.EventHub%E8%8E%B7%E5%8F%96%E4%BA%8B%E4%BB%B6/">2.EventHub获取事件</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/InPutManagerService/4.InputDispatcher%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91/">4.InputDispatcher事件分发</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/InPutManagerService/5.%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%E5%9C%A8%E5%BA%94%E7%94%A8%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%86%E5%8F%91%E5%92%8C%E5%A4%84%E7%90%86/">5.触摸事件在应用进程的分发和处理</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            WMSAMS
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/WMSAMS/1.%E7%AA%97%E5%8F%A3%E5%B1%82%E7%BA%A7%20_%E5%AE%B9%E5%99%A8%E7%B1%BB/">1.窗口层级 _容器类</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/WMSAMS/2.%E7%AA%97%E5%8F%A3%E5%B1%82%E7%BA%A7%20_%E5%B1%82%E7%BA%A7%E7%BB%93%E6%9E%84%E6%A0%91%E7%9A%84%E6%9E%84%E5%BB%BA/">2.窗口层级 _层级结构树的构建</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/WMSAMS/3.%E7%AA%97%E5%8F%A3%E5%B1%82%E7%BA%A7_%E5%B1%82%E7%BA%A7%E7%BB%93%E6%9E%84%E6%A0%91%E6%B7%BB%E5%8A%A0%E7%AA%97%E5%8F%A3/">3.窗口层级_层级结构树添加窗口</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/WMSAMS/4.WMS%E7%AA%97%E5%8F%A3%E7%9B%B8%E5%85%B3%E6%B5%81%E7%A8%8B/"></a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/1.android13%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E4%B9%8BSeLinux%E6%9D%83%E9%99%90%E4%BB%8B%E7%BB%8D/">1.Android13启动流程之SeLinux权限介绍.md</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/2.Android13%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E4%B9%8BFirstStageMain%E9%98%B6%E6%AE%B5/">2.Android13启动流程之FirstStageMain阶段</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/3.Android13%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E4%B9%8BSecondStageMain%E9%98%B6%E6%AE%B5/">3.Android13启动流程之SecondStageMain阶段</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/4.Android13%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E4%B9%8BZygote%E5%92%8CSystemServer%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/">4.Android13启动流程之Zygote和SystemServer启动流程</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/5.Android13%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E4%B9%8BSystemServer%E5%86%85%E9%83%A8%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90/">5.android13启动流程之SystemServer内部逻辑分析.md</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/6.PowerManagerService%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%92%8C%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95/">6.PowerManagerService启动流程和核心方法</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/7.%E7%82%B9%E5%87%BB%E6%A1%8C%E9%9D%A2APP%E5%9B%BE%E6%A0%87%EF%BC%8C%E5%88%B0APP%E7%95%8C%E9%9D%A2%E6%98%BE%E7%A4%BA%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90(%E4%B8%80)/">7.点击桌面APP图标，到APP界面显示流程分析</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%2013/8.%E7%82%B9%E5%87%BB%E6%A1%8C%E9%9D%A2APP%E5%9B%BE%E6%A0%87%EF%BC%8C%E5%88%B0APP%E7%95%8C%E9%9D%A2%E6%98%BE%E7%A4%BA%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90(%E4%BA%8C)/">8.点击桌面APP图标，到APP界面显示流程分析(二)</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Framework相关
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E7%9B%B8%E5%85%B3/1.Handler%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/">Handler消息机制原理解析</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E7%9B%B8%E5%85%B3/2.Binder%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/">Binder原理解析</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E7%9B%B8%E5%85%B3/ANR%E7%9A%84%E4%BA%A7%E7%94%9F%E6%9C%BA%E5%88%B6/">ANR的产生机制</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E7%9B%B8%E5%85%B3/SystemUI/">SystemUI</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/Android%20FrameWork/LINUX%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/">LINUX基础命令</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/VIM%E4%BD%BF%E7%94%A8/">VIM使用</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/adb%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">Adb常用命令</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1/">自定义服务</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/%E4%BD%BF%E7%94%A8%20git%20add%20-p%20%E6%95%B4%E7%90%86%20patch/">使用Git Add -P 整理 Patch</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/dumpsys%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95/">Dumpsys命令用法</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/AOSP%20Repo%E5%91%BD%E4%BB%A4%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/">AOSP Repo 命令参考资料</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/ADB%E5%92%8CMonkey%E6%B5%8B%E8%AF%95/">ADB和Monkey测试</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/AOSP%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">AOSP常用编译和查找命令文件</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Eclipse%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/">Eclipse安装教程</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Windows%E5%92%8CUbuntu%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/">Windows和Ubuntu双系统安装</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Android%20%E6%BA%90%E7%A0%81%E6%A0%B9%E7%9B%AE%E5%BD%95%E4%BB%8B%E7%BB%8D/">Android源码根目录介绍</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Framework%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/">Framework遇到的问题</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/%E5%AF%BC%E5%85%A5%E7%B3%BB%E7%BB%9F%E6%BA%90%E7%A0%81%E5%88%B0Studio/">导入系统源码到Studio</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Linux%20%E8%AE%BE%E7%BD%AEswap/">Linux设置swap</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/wine%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/">Wine安装及使用</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/Selinux&SeAndroid/">Selinux&SeAndroid</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/rc%E6%96%87%E4%BB%B6%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99/">Rc文件语法规则</a></li>  <li class="file"><a href="/wiki/Android%20FrameWork/ASFP%20(android%20studio%20for%20platform)%E4%BD%BF%E7%94%A8/">ASFP (Android Studio for Platform)使用</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Android进阶
                        </a>
                         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Jetpack
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/Jetpack/Jetpack%E6%9E%B6%E6%9E%84%E7%BB%84%E4%BB%B6%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/">Jetpack架构组件从入门到精通</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/Jetpack/1.LifeCycle/">1.LifeCycle</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/Jetpack/2.LiveData/">2.LiveData</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/Jetpack/3.DataBinding/">3.DataBinding</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/Jetpack/4.Dagger2/">4.Dagger2</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/Jetpack/5.ViewModle/">5.ViewModle</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/Jetpack/6.Room/">6.Room</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/Jetpack/7.Hilt/">7.Hilt</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/Jetpack/8.Paging/">8.Paging</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/Jetpack/9.WorkManager/">9.WorkManager</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/Jetpack/10.Navigation/">10.Navigation</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            NDK
                        </a>
                         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Android进阶之旅
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/12_makefile/">12_makefile</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/16_1_Cmake%E8%AF%AD%E6%B3%95/">16_1_Cmake语法</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/16_2_Cmake%E9%A1%B9%E7%9B%AE%E5%B8%B8%E7%94%A8/">16_2_Cmake项目常用</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/19_NDK%E9%9D%A2%E8%AF%95%E9%A2%98/">19_NDK面试题</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/11_%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3%E9%9D%99%E6%80%81%E5%BA%93%E4%B8%8E%E5%8A%A8%E6%80%81%E5%BA%93%E5%8E%9F%E7%90%86/">11_编译流程详解/静态库与动态库原理.md</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/13_android.mk/">13_android.mk</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/14_Application.mk/">14_Application.mk</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/15_Android.mk%E5%92%8CAndroid.bp%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB/">15_Android.mk和Android.bp对应关系.md</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/17_Shell%E8%84%9A%E6%9C%AC/">17_Shell脚本</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/18_NDK%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">18_NDK环境配置</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/1_c%E5%9F%BA%E7%A1%80/">1_c基础</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/3_jni_native%E5%B1%82%E6%9E%84%E5%BB%BAjava%E5%AF%B9%E8%B1%A1/">3_jni_native层构建java对象</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/2_jni%E5%9F%BA%E7%A1%80/"></a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/4_jni_%E6%95%B0%E7%BB%84%E7%9A%84%E7%BB%86%E8%8A%82%E5%A4%84%E7%90%86/">4_jni_数组的细节处理</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/5_c%E8%BF%9B%E9%98%B6_%E5%86%85%E5%AD%98%E5%9B%9B%E9%A9%B1%E6%A8%A1%E5%9E%8B/">5_c进阶_内存四驱模型</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/7_%E9%93%B6%E8%A1%8C%E5%8D%A1%E8%AF%86%E5%88%AB/">7_银行卡识别.md</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/6_c++%E5%9F%BA%E7%A1%80/">6_c++基础</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/8_%E7%AE%97%E6%B3%95/">8_算法</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/9_%E9%9F%B3%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80/">9_音视频基础</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/20.jni%E6%96%B9%E6%B3%95%E5%A4%A7%E5%85%A8%E5%8F%8A%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/">20.jni方法大全及使用示例</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            蒋超大佬扫盲
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/1.%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">1.基础知识</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/CMake%E8%AF%AD%E6%B3%95/">CMake语法</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/2.Cmake%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">2.Cmake基础知识</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/3.JNI%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">3.JNI数据类型</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/4.JavaVM/">JavaVM</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/5.OPUS%E7%BC%96%E8%AF%91/">5.opus编译</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/6.libusb/">6.libusb</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/7.mmkv%E7%BC%96%E8%AF%91/">7.mmkv编译</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/8.mqtt/">8.mqtt</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/9.%E5%87%BD%E6%95%B0%E7%AD%BE%E5%90%8D%E5%8F%8Andk%E8%B0%83%E7%94%A8java%E6%96%B9%E6%B3%95/">9.函数签名及ndk调用java方法</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/10.%E7%BA%BF%E7%A8%8B/">10.线程</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            性能优化
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/leakcanary%E7%9A%84%E4%BD%BF%E7%94%A8/">Leakcanary的使用</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/1.App%E6%80%A7%E8%83%BD%E6%A6%82%E8%A7%88%E4%B8%8E%E5%B9%B3%E5%8F%B0%E5%8C%96%E5%AE%9E%E8%B7%B5/">1.App性能概览与平台化实践</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/2.App%E5%90%AF%E5%8A%A8%E4%BC%98%E5%8C%96/">2.App启动优化</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/3.%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96/">3.内存优化</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/4.%E5%B8%83%E5%B1%80%E4%BC%98%E5%8C%96/">4.布局优化</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/5.%E5%8D%A1%E9%A1%BF%E4%BC%98%E5%8C%96/">5.卡顿优化</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/6.%E7%BA%BF%E7%A8%8B%E4%BC%98%E5%8C%96/">6.线程优化</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/7.%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96/">7.网络优化</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/8.%E7%94%B5%E9%87%8F%E4%BC%98%E5%8C%96/">8.电量优化</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/9.%E7%98%A6%E8%BA%AB%E4%BC%98%E5%8C%96/">9.瘦身优化</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/10.%E7%A8%B3%E5%AE%9A%E6%80%A7%E4%BC%98%E5%8C%96/">10.稳定性优化</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/11.%E4%B8%93%E9%A1%B9%E6%8A%80%E6%9C%AF%E4%BC%98%E5%8C%96/">11.专项技术优化</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/java%20%E5%8F%8D%E5%B0%84%E5%8F%8A%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E5%88%9D%E6%AD%A5%E5%AD%A6%E4%B9%A0/">Java 反射及代理模式初步学习</a></li>  <li class="file"><a href="/wiki/Android%E8%BF%9B%E9%98%B6/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%BA%93Retrofit/">网络请求库Retrofit</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            C++
                        </a>
                         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            C++教程从0到1入门编程
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/C++/C++%E6%95%99%E7%A8%8B%E4%BB%8E0%E5%88%B01%E5%85%A5%E9%97%A8%E7%BC%96%E7%A8%8B/1.C++%E5%9F%BA%E7%A1%80/">C++基础</a></li>  <li class="file"><a href="/wiki/C++/C++%E6%95%99%E7%A8%8B%E4%BB%8E0%E5%88%B01%E5%85%A5%E9%97%A8%E7%BC%96%E7%A8%8B/2.C++%E6%8F%90%E9%AB%98/">C++提高</a></li>  <li class="file"><a href="/wiki/C++/C++%E6%95%99%E7%A8%8B%E4%BB%8E0%E5%88%B01%E5%85%A5%E9%97%A8%E7%BC%96%E7%A8%8B/3.C++%E6%A0%B8%E5%BF%83/">C++核心</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/C++/window%E7%B3%BB%E7%BB%9F_vscode%E4%B8%AD%E9%85%8D%E7%BD%AE%20c++%E7%8E%AF%E5%A2%83/">Vscode中配置 C++环境</a></li>  <li class="file"><a href="/wiki/C++/%E8%BD%BB%E6%9D%BE%E6%90%9E%E5%AE%9AC++%E8%AF%AD%E8%A8%80/">轻松搞定C++语言</a></li>  <li class="file"><a href="/wiki/C++/%E8%BD%BB%E6%9D%BE%E6%90%9E%E5%AE%9AC%E8%AF%AD%E8%A8%80(%E6%8F%90%E9%AB%98%E7%AF%87)/">轻松搞定C语言(提高篇)</a></li>  <li class="file"><a href="/wiki/C++/%E5%BD%BB%E5%BA%95%E6%90%9E%E5%AE%9AC%E6%8C%87%E9%92%88/">彻底搞定C指针</a></li>  <li class="file"><a href="/wiki/C++/Linux%E7%B3%BB%E7%BB%9F_vscode%E4%B8%AD%E9%85%8D%E7%BD%AE%20c++%E7%8E%AF%E5%A2%83/">Linux系统_vscode中配置 c++环境.md</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            其他笔记
                        </a>
                         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Flutter
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/Android-Studio%E9%85%8D%E7%BD%AEFlutter/">Android-Studio配置Flutter</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/Flutter(Android-%E6%B7%B7%E5%90%88%E5%BC%80%E5%8F%91)/">Flutter(Android-混合开发)</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/Flutter-Decoration%E8%83%8C%E6%99%AF%E8%AE%BE%E5%AE%9A%EF%BC%88%E8%BE%B9%E6%A1%86%E3%80%81%E5%9C%86%E8%A7%92%E3%80%81%E9%98%B4%E5%BD%B1%E3%80%81%E5%BD%A2%E7%8A%B6%E3%80%81%E6%B8%90%E5%8F%98%E3%80%81%E8%83%8C%E6%99%AF%E5%9B%BE%E5%83%8F%E7%AD%89%EF%BC%89/">Flutter-Decoration背景设定（边框、圆角、阴影、形状、渐变、背景图像等）</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/Flutter-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%92%8C%E9%A1%B9%E7%9B%AE%E8%B5%84%E6%BA%90/">Flutter-目录结构和项目资源</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/Flutter%E4%B8%AD%E7%9A%84%E6%89%8B%E5%8A%BF%E5%A4%84%E7%90%86/">Flutter中的手势处理</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/Flutter%E4%B9%8BScaffold/">Flutter之Scaffold</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/Flutter-%E6%8E%A7%E4%BB%B6%E4%B9%8B-MaterialApp/">Flutter-控件之-MaterialApp</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/Flutter%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/">Flutter代码开发规范</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/StatelessWidget%E5%92%8CStatefulWidget%E7%9A%84%E5%8C%BA%E5%88%AB/">StatelessWidget和StatefulWidget的区别</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-BottomAppBar-%EF%BC%88%E4%B8%8D%E8%A7%84%E5%88%99%E5%BA%95%E9%83%A8%E5%B7%A5%E5%85%B7%E6%A0%8F%EF%BC%89/">Flutter-BottomAppBar-（不规则底部工具栏）</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-BottomNavigationBar%E7%B1%BB/">Flutter-BottomNavigationBar类</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-Chip/">Flutter-Chip</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-ExpansionTile(%E9%97%AD%E5%90%88%E5%88%97%E8%A1%A8)/">Flutter-ExpansionTile(闭合列表)</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-Flexible%E5%92%8C-Expanded/">Flutter-Flexible和-Expanded</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-ListTile(06)/">Flutter-ListTile(06)</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-Padding/">Flutter-Padding</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-Stack(%E5%B1%82%E5%8F%A0%E6%8E%A7%E4%BB%B6)/">Flutter-Stack(层叠控件)</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-Text(02)/">Flutter-Text(02)</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-card%EF%BC%88%E5%8D%A1%E7%89%87%E5%B8%83%E5%B1%80%EF%BC%89/">Flutter-Card（卡片布局）</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-gridView/">Flutter-gridView</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-listview(07)/">Flutter-Listview(07)</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-mainAxisAlignment%E5%92%8CcrossAxisAlignment/">Flutter-mainAxisAlignment和crossAxisAlignment</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-%E5%8D%95%E9%80%89%E6%A1%86%E5%92%8C%E5%A4%8D%E9%80%89%E6%A1%86(05)/">Flutter-单选框和复选框(05)</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-%E5%9B%BE%E7%89%87(04)/">Flutter-图片(04)</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-%E5%AF%BC%E8%88%AA%E8%BF%94%E5%9B%9E%E6%8B%A6%E6%88%AAWillPopScope(%E9%98%B2%E8%AF%AF%E8%A7%A6)/">Flutter-导航返回拦截WillPopScope(防误触)</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-%E5%B1%82%E5%8F%A0%E5%B8%83%E5%B1%80Stack%E3%80%81Positioned/">Flutter-层叠布局Stack、Positioned</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-%E5%BC%B9%E6%80%A7%E5%B8%83%E5%B1%80Flex/">Flutter-弹性布局Flex</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-%E6%8C%89%E9%92%AE(03)/">Flutter-按钮(03)</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-%E6%B5%81%E5%BC%8F%E5%B8%83%E5%B1%80Wrap%E3%80%81Flow/">Flutter-流式布局Wrap、Flow</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-%E7%BA%BF%E6%80%A7%E5%B8%83%E5%B1%80Row%E5%92%8CColumn-1/">Flutter-线性布局Row和Column-1</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-%E7%BA%BF%E6%80%A7%E5%B8%83%E5%B1%80Row%E5%92%8CColumn/">Flutter-线性布局Row和Column</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-%E8%BE%93%E5%85%A5%E6%A1%86%E5%92%8C%E6%A0%87%E7%82%B9/">Flutter-输入框和标点</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter-%E9%A2%9C%E8%89%B2%E6%B8%90%E5%8F%98/">Flutter-颜色渐变</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8(01)/">Flutter基础使用(01)</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/Flutter/flutter%E7%AE%80%E4%BB%8B/">Flutter简介</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            QT
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/QT/QT-Creator%E5%AE%89%E8%A3%85/">QT-Creator安装</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            svn配置及使用
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/svn%E9%85%8D%E7%BD%AE%E5%8F%8A%E4%BD%BF%E7%94%A8/svn%E4%B8%8B%E8%BD%BD%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/">Svn下载远程仓库</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/svn%E9%85%8D%E7%BD%AE%E5%8F%8A%E4%BD%BF%E7%94%A8/svn%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/">Svn客户端安装和配置</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/svn%E9%85%8D%E7%BD%AE%E5%8F%8A%E4%BD%BF%E7%94%A8/svn%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/">Svn服务端安装和配置</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/svn%E9%85%8D%E7%BD%AE%E5%8F%8A%E4%BD%BF%E7%94%A8/svn%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/">Svn的基本操作</a></li>  </ul> 
                    </li> 
                     <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/win11%E8%87%AA%E5%8A%A8%E5%85%B3%E6%9C%BA/">Win11自动关机</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/%E6%88%91%E7%9A%84%E7%AE%80%E5%8E%86/">我的简历</a></li>  <li class="file"><a href="/wiki/%E5%85%B6%E4%BB%96%E7%AC%94%E8%AE%B0/csdn%E6%96%87%E7%AB%A0%E5%AF%BC%E5%87%BAmarkdown/">Csdn文章导出到本地markdown</a></li>  </ul> 
                    </li> 
                     </ul> 
    </div>
    <script>
        $(document).ready(function() {
            var iconFolderOpenClass  = 'fa-folder-open';
            var iconFolderCloseClass = 'fa-folder';
            var iconAllExpandClass = 'fa-angle-double-down';
            var iconAllPackClass = 'fa-angle-double-up';
            // Handle directory-tree expansion:
            // 左键单独展开目录
            $(document).on('click', '#categories a[data-role="directory"]', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var subtree = $(this).siblings('ul');
                icon.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if (expanded) {
                    if (typeof subtree != 'undefined') {
                        subtree.slideUp({ duration: 100 });
                    }
                    icon.addClass(iconFolderCloseClass);
                } else {
                    if (typeof subtree != 'undefined') {
                        subtree.slideDown({ duration: 100 });
                    }
                    icon.addClass(iconFolderOpenClass);
                }
            });
            // 右键展开下属所有目录
            $('#categories a[data-role="directory"]').bind("contextmenu", function(event){
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var listNode = $(this).siblings('ul');
                var subtrees = $.merge(listNode.find('li ul'), listNode);
                var icons = $.merge(listNode.find('.fa'), icon);
                icons.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if(expanded) {
                    subtrees.slideUp({ duration: 100 });
                    icons.addClass(iconFolderCloseClass);
                } else {
                    subtrees.slideDown({ duration: 100 });
                    icons.addClass(iconFolderOpenClass);
                }
            })
            // 展开关闭所有目录按钮
            $(document).on('click', '#allExpand', function (event) {
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconAllExpandClass);
                icon.removeClass(iconAllExpandClass).removeClass(iconAllPackClass);
                if(expanded) {
                    $('#sidebar .fa.fa-folder').removeClass('fa-folder').addClass('fa-folder-open')
                    $('#categories li ul').slideDown({ duration: 100 });
                    icon.addClass(iconAllPackClass);
                } else {
                    $('#sidebar .fa.fa-folder-open').removeClass('fa-folder-open').addClass('fa-folder')
                    $('#categories li ul').slideUp({ duration: 100 });
                    icon.addClass(iconAllExpandClass);
                }
            });  
        });
    </script>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
            <section id="main">
        <article id="post-Android FrameWork/rc文件语法规则" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android-FrameWork/">Android FrameWork</a>
    </div>

                        
                        
  



                        
                        
                    </div>
                
                
   

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <h3 id="解析init-rc脚本"><a href="#解析init-rc脚本" class="headerlink" title="解析init.rc脚本"></a>解析init.rc脚本</h3><h3 id="Android-Init-Language"><a href="#Android-Init-Language" class="headerlink" title="Android Init Language"></a>Android Init Language</h3><p>rc文件，是用Android Init Language编写的特殊文件。用这种语法编写的文件，统一用”.rc”后缀</p>
<p>它的语法说明可以在aosp源码<code>system/core/init/README.md</code>中找到:</p>
<p>system&#x2F;core&#x2F;init&#x2F;README.md原文：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br></pre></td><td class="code"><pre><span class="line">Android Init Language</span><br><span class="line">---------------------</span><br><span class="line"></span><br><span class="line">The Android Init Language consists of five broad classes of statements:</span><br><span class="line">Actions, Commands, Services, Options, and Imports.</span><br><span class="line"></span><br><span class="line">All of these are line-oriented, consisting of tokens separated by</span><br><span class="line">whitespace.  The c-style backslash escapes may be used to insert</span><br><span class="line">whitespace into a token.  Double quotes may also be used to prevent</span><br><span class="line">whitespace from breaking text into multiple tokens.  The backslash,</span><br><span class="line">when it is the last character on a line, may be used for line-folding.</span><br><span class="line"></span><br><span class="line">Lines which start with a `#` (leading whitespace allowed) are comments.</span><br><span class="line"></span><br><span class="line">System properties can be expanded using the syntax</span><br><span class="line">`$&#123;property.name&#125;`. This also works in contexts where concatenation is</span><br><span class="line">required, such as `import /init.recovery.$&#123;ro.hardware&#125;.rc`.</span><br><span class="line"></span><br><span class="line">Actions and Services implicitly declare a new section.  All commands</span><br><span class="line">or options belong to the section most recently declared.  Commands</span><br><span class="line">or options before the first section are ignored.</span><br><span class="line"></span><br><span class="line">Services have unique names.  If a second Service is defined</span><br><span class="line">with the same name as an existing one, it is ignored and an error</span><br><span class="line">message is logged.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Init .rc Files</span><br><span class="line">--------------</span><br><span class="line">The init language is used in plain text files that take the .rc file</span><br><span class="line">extension.  There are typically multiple of these in multiple</span><br><span class="line">locations on the system, described below.</span><br><span class="line"></span><br><span class="line">`/system/etc/init/hw/init.rc` is the primary .rc file and is loaded by the init executable at the</span><br><span class="line">beginning of its execution.  It is responsible for the initial set up of the system.</span><br><span class="line"></span><br><span class="line">Init loads all of the files contained within the</span><br><span class="line">`/&#123;system,system_ext,vendor,odm,product&#125;/etc/init/` directories immediately after loading</span><br><span class="line">the primary `/system/etc/init/hw/init.rc`.  This is explained in more details in the</span><br><span class="line">[Imports](#imports) section of this file.</span><br><span class="line"></span><br><span class="line">Legacy devices without the first stage mount mechanism previously were</span><br><span class="line">able to import init scripts during mount_all, however that is deprecated</span><br><span class="line">and not allowed for devices launching after Q.</span><br><span class="line"></span><br><span class="line">The intention of these directories is:</span><br><span class="line"></span><br><span class="line">   1. /system/etc/init/ is for core system items such as</span><br><span class="line">      SurfaceFlinger, MediaService, and logd.</span><br><span class="line">   2. /vendor/etc/init/ is for SoC vendor items such as actions or</span><br><span class="line">      daemons needed for core SoC functionality.</span><br><span class="line">   3. /odm/etc/init/ is for device manufacturer items such as</span><br><span class="line">      actions or daemons needed for motion sensor or other peripheral</span><br><span class="line">      functionality.</span><br><span class="line"></span><br><span class="line">All services whose binaries reside on the system, vendor, or odm</span><br><span class="line">partitions should have their service entries placed into a</span><br><span class="line">corresponding init .rc file, located in the /etc/init/</span><br><span class="line">directory of the partition where they reside.  There is a build</span><br><span class="line">system macro, LOCAL\_INIT\_RC, that handles this for developers.  Each</span><br><span class="line">init .rc file should additionally contain any actions associated with</span><br><span class="line">its service.</span><br><span class="line"></span><br><span class="line">An example is the userdebug logcatd.rc and Android.mk files located in the</span><br><span class="line">system/core/logcat directory.  The LOCAL\_INIT\_RC macro in the</span><br><span class="line">Android.mk file places logcatd.rc in /system/etc/init/ during the</span><br><span class="line">build process.  Init loads logcatd.rc during the mount\_all command and</span><br><span class="line">allows the service to be run and the action to be queued when</span><br><span class="line">appropriate.</span><br><span class="line"></span><br><span class="line">This break up of init .rc files according to their daemon is preferred</span><br><span class="line">to the previously used monolithic init .rc files.  This approach</span><br><span class="line">ensures that the only service entries that init reads and the only</span><br><span class="line">actions that init performs correspond to services whose binaries are in</span><br><span class="line">fact present on the file system, which was not the case with the</span><br><span class="line">monolithic init .rc files.  This additionally will aid in merge</span><br><span class="line">conflict resolution when multiple services are added to the system, as</span><br><span class="line">each one will go into a separate file.</span><br><span class="line"></span><br><span class="line">Versioned RC files within APEXs</span><br><span class="line">-------------------------------</span><br><span class="line"></span><br><span class="line">With the arrival of mainline on Android Q, the individual mainline</span><br><span class="line">modules carry their own init.rc files within their boundaries. Init</span><br><span class="line">processes these files according to the naming pattern `/apex/*/etc/*rc`.</span><br><span class="line"></span><br><span class="line">Because APEX modules must run on more than one release of Android,</span><br><span class="line">they may require different parameters as part of the services they</span><br><span class="line">define. This is achieved, starting in Android T, by incorporating</span><br><span class="line">the SDK version information in the name of the init file.  The suffix</span><br><span class="line">is changed from `.rc` to `.#rc` where # is the first SDK where that</span><br><span class="line">RC file is accepted. An init file specific to SDK=31 might be named</span><br><span class="line">`init.31rc`. With this scheme, an APEX may include multiple init files. An</span><br><span class="line">example is appropriate.</span><br><span class="line"></span><br><span class="line">For an APEX module with the following files in /apex/sample-module/apex/etc/:</span><br><span class="line"></span><br><span class="line">   1. init.rc</span><br><span class="line">   2. init.32rc</span><br><span class="line">   4. init.35rc</span><br><span class="line"></span><br><span class="line">The selection rule chooses the highest `.#rc` value that does not</span><br><span class="line">exceed the SDK of the currently running system. The unadorned `.rc`</span><br><span class="line">is interpreted as sdk=0.</span><br><span class="line"></span><br><span class="line">When this APEX is installed on a device with SDK &lt;=31, the system will</span><br><span class="line">process init.rc.  When installed on a device running SDK 32, 33, or 34,</span><br><span class="line">it will use init.32rc.  When installed on a device running SDKs &gt;= 35,</span><br><span class="line">it will choose init.35rc</span><br><span class="line"></span><br><span class="line">This versioning scheme is used only for the init files within APEX</span><br><span class="line">modules; it does not apply to the init files stored in /system/etc/init,</span><br><span class="line">/vendor/etc/init, or other directories.</span><br><span class="line"></span><br><span class="line">This naming scheme is available after Android S.</span><br><span class="line"></span><br><span class="line">Actions</span><br><span class="line">-------</span><br><span class="line">Actions are named sequences of commands.  Actions have a trigger which</span><br><span class="line">is used to determine when the action is executed.  When an event</span><br><span class="line">occurs which matches an action&#x27;s trigger, that action is added to</span><br><span class="line">the tail of a to-be-executed queue (unless it is already on the</span><br><span class="line">queue).</span><br><span class="line"></span><br><span class="line">Each action in the queue is dequeued in sequence and each command in</span><br><span class="line">that action is executed in sequence.  Init handles other activities</span><br><span class="line">(device creation/destruction, property setting, process restarting)</span><br><span class="line">&quot;between&quot; the execution of the commands in activities.</span><br><span class="line"></span><br><span class="line">Actions take the form of:</span><br><span class="line"></span><br><span class="line">    on &lt;trigger&gt; [&amp;&amp; &lt;trigger&gt;]*</span><br><span class="line">       &lt;command&gt;</span><br><span class="line">       &lt;command&gt;</span><br><span class="line">       &lt;command&gt;</span><br><span class="line"></span><br><span class="line">Actions are added to the queue and executed based on the order that</span><br><span class="line">the file that contains them was parsed (see the Imports section), then</span><br><span class="line">sequentially within an individual file.</span><br><span class="line"></span><br><span class="line">For example if a file contains:</span><br><span class="line"></span><br><span class="line">    on boot</span><br><span class="line">       setprop a 1</span><br><span class="line">       setprop b 2</span><br><span class="line"></span><br><span class="line">    on boot &amp;&amp; property:true=true</span><br><span class="line">       setprop c 1</span><br><span class="line">       setprop d 2</span><br><span class="line"></span><br><span class="line">    on boot</span><br><span class="line">       setprop e 1</span><br><span class="line">       setprop f 2</span><br><span class="line"></span><br><span class="line">Then when the `boot` trigger occurs and assuming the property `true`</span><br><span class="line">equals `true`, then the order of the commands executed will be:</span><br><span class="line"></span><br><span class="line">    setprop a 1</span><br><span class="line">    setprop b 2</span><br><span class="line">    setprop c 1</span><br><span class="line">    setprop d 2</span><br><span class="line">    setprop e 1</span><br><span class="line">    setprop f 2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Services</span><br><span class="line">--------</span><br><span class="line">Services are programs which init launches and (optionally) restarts</span><br><span class="line">when they exit.  Services take the form of:</span><br><span class="line"></span><br><span class="line">    service &lt;name&gt; &lt;pathname&gt; [ &lt;argument&gt; ]*</span><br><span class="line">       &lt;option&gt;</span><br><span class="line">       &lt;option&gt;</span><br><span class="line">       ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Options</span><br><span class="line">-------</span><br><span class="line">Options are modifiers to services.  They affect how and when init</span><br><span class="line">runs the service.</span><br><span class="line"></span><br><span class="line">`capabilities [ &lt;capability&gt;\* ]`</span><br><span class="line">&gt; Set capabilities when exec&#x27;ing this service. &#x27;capability&#x27; should be a Linux</span><br><span class="line">  capability without the &quot;CAP\_&quot; prefix, like &quot;NET\_ADMIN&quot; or &quot;SETPCAP&quot;. See</span><br><span class="line">  http://man7.org/linux/man-pages/man7/capabilities.7.html for a list of Linux</span><br><span class="line">  capabilities.</span><br><span class="line">  If no capabilities are provided, then all capabilities are removed from this service, even if it</span><br><span class="line">  runs as root.</span><br><span class="line"></span><br><span class="line">`class &lt;name&gt; [ &lt;name&gt;\* ]`</span><br><span class="line">&gt; Specify class names for the service.  All services in a</span><br><span class="line">  named class may be started or stopped together.  A service</span><br><span class="line">  is in the class &quot;default&quot; if one is not specified via the</span><br><span class="line">  class option. Additional classnames beyond the (required) first</span><br><span class="line">  one are used to group services.</span><br><span class="line">  The `animation` class should include all services necessary for both</span><br><span class="line">  boot animation and shutdown animation. As these services can be</span><br><span class="line">  launched very early during bootup and can run until the last stage</span><br><span class="line">  of shutdown, access to /data partition is not guaranteed. These</span><br><span class="line">  services can check files under /data but it should not keep files opened</span><br><span class="line">  and should work when /data is not available.</span><br><span class="line"></span><br><span class="line">`console [&lt;console&gt;]`</span><br><span class="line">&gt; This service needs a console. The optional second parameter chooses a</span><br><span class="line">  specific console instead of the default. The default &quot;/dev/console&quot; can</span><br><span class="line">  be changed by setting the &quot;androidboot.console&quot; kernel parameter. In</span><br><span class="line">  all cases the leading &quot;/dev/&quot; should be omitted, so &quot;/dev/tty0&quot; would be</span><br><span class="line">  specified as just &quot;console tty0&quot;.</span><br><span class="line">  This option connects stdin, stdout, and stderr to the console. It is mutually exclusive with the</span><br><span class="line">  stdio_to_kmsg option, which only connects stdout and stderr to kmsg.</span><br><span class="line"></span><br><span class="line">`critical [window=&lt;fatal crash window mins&gt;] [target=&lt;fatal reboot target&gt;]`</span><br><span class="line">&gt; This is a device-critical service. If it exits more than four times in</span><br><span class="line">  _fatal crash window mins_ minutes or before boot completes, the device</span><br><span class="line">  will reboot into _fatal reboot target_.</span><br><span class="line">  The default value of _fatal crash window mins_ is 4, and default value</span><br><span class="line">  of _fatal reboot target_ is &#x27;bootloader&#x27;.</span><br><span class="line">  For tests, the fatal reboot can be skipped by setting property</span><br><span class="line">  `init.svc_debug.no_fatal.&lt;service-name&gt;` to `true` for specified critical service.</span><br><span class="line"></span><br><span class="line">`disabled`</span><br><span class="line">&gt; This service will not automatically start with its class.</span><br><span class="line">  It must be explicitly started by name or by interface name.</span><br><span class="line"></span><br><span class="line">`enter_namespace &lt;type&gt; &lt;path&gt;`</span><br><span class="line">&gt; Enters the namespace of type _type_ located at _path_. Only network namespaces are supported with</span><br><span class="line">  _type_ set to &quot;net&quot;. Note that only one namespace of a given _type_ may be entered.</span><br><span class="line"></span><br><span class="line">`file &lt;path&gt; &lt;type&gt;`</span><br><span class="line">&gt; Open a file path and pass its fd to the launched process. _type_ must be</span><br><span class="line">  &quot;r&quot;, &quot;w&quot; or &quot;rw&quot;.  For native executables see libcutils</span><br><span class="line">  android\_get\_control\_file().</span><br><span class="line"></span><br><span class="line">`group &lt;groupname&gt; [ &lt;groupname&gt;\* ]`</span><br><span class="line">&gt; Change to &#x27;groupname&#x27; before exec&#x27;ing this service.  Additional</span><br><span class="line">  groupnames beyond the (required) first one are used to set the</span><br><span class="line">  supplemental groups of the process (via setgroups()).</span><br><span class="line">  Currently defaults to root.  (??? probably should default to nobody)</span><br><span class="line"></span><br><span class="line">`interface &lt;interface name&gt; &lt;instance name&gt;`</span><br><span class="line">&gt; Associates this service with a list of the AIDL or HIDL services that it provides. The interface</span><br><span class="line">  name must be a fully-qualified name and not a value name. For instance, this is used to allow</span><br><span class="line">  servicemanager or hwservicemanager to lazily start services. When multiple interfaces are served,</span><br><span class="line">  this tag should be used multiple times. An example of an entry for a HIDL</span><br><span class="line">  interface is `interface vendor.foo.bar@1.0::IBaz default`. For an AIDL interface, use</span><br><span class="line">  `interface aidl &lt;instance name&gt;`. The instance name for an AIDL interface is</span><br><span class="line">  whatever is registered with servicemanager, and these can be listed with `adb</span><br><span class="line">  shell dumpsys -l`.</span><br><span class="line"></span><br><span class="line">`ioprio &lt;class&gt; &lt;priority&gt;`</span><br><span class="line">&gt; Sets the IO priority and IO priority class for this service via the SYS_ioprio_set syscall.</span><br><span class="line">  _class_ must be one of &quot;rt&quot;, &quot;be&quot;, or &quot;idle&quot;. _priority_ must be an integer in the range 0 - 7.</span><br><span class="line"></span><br><span class="line">`keycodes &lt;keycode&gt; [ &lt;keycode&gt;\* ]`</span><br><span class="line">&gt; Sets the keycodes that will trigger this service. If all of the keys corresponding to the passed</span><br><span class="line">  keycodes are pressed at once, the service will start. This is typically used to start the</span><br><span class="line">  bugreport service.</span><br><span class="line"></span><br><span class="line">&gt; This option may take a property instead of a list of keycodes. In this case, only one option is</span><br><span class="line">  provided: the property name in the typical property expansion format. The property must contain</span><br><span class="line">  a comma separated list of keycode values or the text &#x27;none&#x27; to indicate that</span><br><span class="line">  this service does not respond to keycodes.</span><br><span class="line"></span><br><span class="line">&gt; For example, `keycodes $&#123;some.property.name:-none&#125;` where some.property.name expands</span><br><span class="line">  to &quot;123,124,125&quot;. Since keycodes are handled very early in init,</span><br><span class="line">  only PRODUCT_DEFAULT_PROPERTY_OVERRIDES properties can be used.</span><br><span class="line"></span><br><span class="line">`memcg.limit_in_bytes &lt;value&gt;` and `memcg.limit_percent &lt;value&gt;`</span><br><span class="line">&gt; Sets the child&#x27;s memory.limit_in_bytes to the minimum of `limit_in_bytes`</span><br><span class="line">  bytes and `limit_percent` which is interpreted as a percentage of the size</span><br><span class="line">  of the device&#x27;s physical memory (only if memcg is mounted).</span><br><span class="line">  Values must be equal or greater than 0.</span><br><span class="line"></span><br><span class="line">`memcg.limit_property &lt;value&gt;`</span><br><span class="line">&gt; Sets the child&#x27;s memory.limit_in_bytes to the value of the specified property</span><br><span class="line">  (only if memcg is mounted). This property will override the values specified</span><br><span class="line">  via `memcg.limit_in_bytes` and `memcg.limit_percent`.</span><br><span class="line"></span><br><span class="line">`memcg.soft_limit_in_bytes &lt;value&gt;`</span><br><span class="line">&gt; Sets the child&#x27;s memory.soft_limit_in_bytes to the specified value (only if memcg is mounted),</span><br><span class="line">  which must be equal or greater than 0.</span><br><span class="line"></span><br><span class="line">`memcg.swappiness &lt;value&gt;`</span><br><span class="line">&gt; Sets the child&#x27;s memory.swappiness to the specified value (only if memcg is mounted),</span><br><span class="line">  which must be equal or greater than 0.</span><br><span class="line"></span><br><span class="line">`namespace &lt;pid|mnt&gt;`</span><br><span class="line">&gt; Enter a new PID or mount namespace when forking the service.</span><br><span class="line"></span><br><span class="line">`oneshot`</span><br><span class="line">&gt; Do not restart the service when it exits.</span><br><span class="line"></span><br><span class="line">`onrestart`</span><br><span class="line">&gt; Execute a Command (see below) when service restarts.</span><br><span class="line"></span><br><span class="line">`oom_score_adjust &lt;value&gt;`</span><br><span class="line">&gt; Sets the child&#x27;s /proc/self/oom\_score\_adj to the specified value,</span><br><span class="line">  which must range from -1000 to 1000.</span><br><span class="line"></span><br><span class="line">`override`</span><br><span class="line">&gt; Indicates that this service definition is meant to override a previous definition for a service</span><br><span class="line">  with the same name. This is typically meant for services on /odm to override those defined on</span><br><span class="line">  /vendor. The last service definition that init parses with this keyword is the service definition</span><br><span class="line">  will use for this service. Pay close attention to the order in which init.rc files are parsed,</span><br><span class="line">  since it has some peculiarities for backwards compatibility reasons. The &#x27;imports&#x27; section of</span><br><span class="line">  this file has more details on the order.</span><br><span class="line"></span><br><span class="line">`priority &lt;priority&gt;`</span><br><span class="line">&gt; Scheduling priority of the service process. This value has to be in range</span><br><span class="line">  -20 to 19. Default priority is 0. Priority is set via setpriority().</span><br><span class="line"></span><br><span class="line">`reboot_on_failure &lt;target&gt;`</span><br><span class="line">&gt; If this process cannot be started or if the process terminates with an exit code other than</span><br><span class="line">  CLD_EXITED or an status other than &#x27;0&#x27;, reboot the system with the target specified in</span><br><span class="line">  _target_. _target_ takes the same format as the parameter to sys.powerctl. This is particularly</span><br><span class="line">  intended to be used with the `exec_start` builtin for any must-have checks during boot.</span><br><span class="line"></span><br><span class="line">`restart_period &lt;seconds&gt;`</span><br><span class="line">&gt; If a non-oneshot service exits, it will be restarted at its start time plus</span><br><span class="line">  this period. It defaults to 5s to rate limit crashing services.</span><br><span class="line">  This can be increased for services that are meant to run periodically. For</span><br><span class="line">  example, it may be set to 3600 to indicate that the service should run every hour</span><br><span class="line">  or 86400 to indicate that the service should run every day.</span><br><span class="line"></span><br><span class="line">`rlimit &lt;resource&gt; &lt;cur&gt; &lt;max&gt;`</span><br><span class="line">&gt; This applies the given rlimit to the service. rlimits are inherited by child</span><br><span class="line">  processes, so this effectively applies the given rlimit to the process tree</span><br><span class="line">  started by this service.</span><br><span class="line">  It is parsed similarly to the setrlimit command specified below.</span><br><span class="line"></span><br><span class="line">`seclabel &lt;seclabel&gt;`</span><br><span class="line">&gt; Change to &#x27;seclabel&#x27; before exec&#x27;ing this service.</span><br><span class="line">  Primarily for use by services run from the rootfs, e.g. ueventd, adbd.</span><br><span class="line">  Services on the system partition can instead use policy-defined transitions</span><br><span class="line">  based on their file security context.</span><br><span class="line">  If not specified and no transition is defined in policy, defaults to the init context.</span><br><span class="line"></span><br><span class="line">`setenv &lt;name&gt; &lt;value&gt;`</span><br><span class="line">&gt; Set the environment variable _name_ to _value_ in the launched process.</span><br><span class="line"></span><br><span class="line">`shutdown &lt;shutdown_behavior&gt;`</span><br><span class="line">&gt; Set shutdown behavior of the service process. When this is not specified,</span><br><span class="line">  the service is killed during shutdown process by using SIGTERM and SIGKILL.</span><br><span class="line">  The service with shutdown_behavior of &quot;critical&quot; is not killed during shutdown</span><br><span class="line">  until shutdown times out. When shutdown times out, even services tagged with</span><br><span class="line">  &quot;shutdown critical&quot; will be killed. When the service tagged with &quot;shutdown critical&quot;</span><br><span class="line">  is not running when shut down starts, it will be started.</span><br><span class="line"></span><br><span class="line">`sigstop`</span><br><span class="line">&gt; Send SIGSTOP to the service immediately before exec is called. This is intended for debugging.</span><br><span class="line">  See the below section on debugging for how this can be used.</span><br><span class="line"></span><br><span class="line">`socket &lt;name&gt; &lt;type&gt; &lt;perm&gt; [ &lt;user&gt; [ &lt;group&gt; [ &lt;seclabel&gt; ] ] ]`</span><br><span class="line">&gt; Create a UNIX domain socket named /dev/socket/_name_ and pass its fd to the</span><br><span class="line">  launched process.  _type_ must be &quot;dgram&quot;, &quot;stream&quot; or &quot;seqpacket&quot;.  _type_</span><br><span class="line">  may end with &quot;+passcred&quot; to enable SO_PASSCRED on the socket. User and</span><br><span class="line">  group default to 0.  &#x27;seclabel&#x27; is the SELinux security context for the</span><br><span class="line">  socket.  It defaults to the service security context, as specified by</span><br><span class="line">  seclabel or computed based on the service executable file security context.</span><br><span class="line">  For native executables see libcutils android\_get\_control\_socket().</span><br><span class="line"></span><br><span class="line">`stdio_to_kmsg`</span><br><span class="line">&gt; Redirect stdout and stderr to /dev/kmsg_debug. This is useful for services that do not use native</span><br><span class="line">  Android logging during early boot and whose logs messages we want to capture. This is only enabled</span><br><span class="line">  when /dev/kmsg_debug is enabled, which is only enabled on userdebug and eng builds.</span><br><span class="line">  This is mutually exclusive with the console option, which additionally connects stdin to the</span><br><span class="line">  given console.</span><br><span class="line"></span><br><span class="line">`task_profiles &lt;profile&gt; [ &lt;profile&gt;\* ]`</span><br><span class="line">&gt; Set task profiles for the process when it forks. This is designed to replace the use of</span><br><span class="line">  writepid option for moving a process into a cgroup.</span><br><span class="line"></span><br><span class="line">`timeout_period &lt;seconds&gt;`</span><br><span class="line">&gt; Provide a timeout after which point the service will be killed. The oneshot keyword is respected</span><br><span class="line">  here, so oneshot services do not automatically restart, however all other services will.</span><br><span class="line">  This is particularly useful for creating a periodic service combined with the restart_period</span><br><span class="line">  option described above.</span><br><span class="line"></span><br><span class="line">`updatable`</span><br><span class="line">&gt; Mark that the service can be overridden (via the &#x27;override&#x27; option) later in</span><br><span class="line">  the boot sequence by APEXes. When a service with updatable option is started</span><br><span class="line">  before APEXes are all activated, the execution is delayed until the activation</span><br><span class="line">  is finished. A service that is not marked as updatable cannot be overridden by</span><br><span class="line">  APEXes.</span><br><span class="line"></span><br><span class="line">`user &lt;username&gt;`</span><br><span class="line">&gt; Change to &#x27;username&#x27; before exec&#x27;ing this service.</span><br><span class="line">  Currently defaults to root.  (??? probably should default to nobody)</span><br><span class="line">  As of Android M, processes should use this option even if they</span><br><span class="line">  require Linux capabilities.  Previously, to acquire Linux</span><br><span class="line">  capabilities, a process would need to run as root, request the</span><br><span class="line">  capabilities, then drop to its desired uid.  There is a new</span><br><span class="line">  mechanism through fs\_config that allows device manufacturers to add</span><br><span class="line">  Linux capabilities to specific binaries on a file system that should</span><br><span class="line">  be used instead. This mechanism is described on</span><br><span class="line">  &lt;http://source.android.com/devices/tech/config/filesystem.html&gt;.  When</span><br><span class="line">  using this new mechanism, processes can use the user option to</span><br><span class="line">  select their desired uid without ever running as root.</span><br><span class="line">  As of Android O, processes can also request capabilities directly in their .rc</span><br><span class="line">  files. See the &quot;capabilities&quot; option below.</span><br><span class="line"></span><br><span class="line">`writepid &lt;file&gt; [ &lt;file&gt;\* ]`</span><br><span class="line">&gt; Write the child&#x27;s pid to the given files when it forks. Meant for</span><br><span class="line">  cgroup/cpuset usage. If no files under /dev/cpuset/ are specified, but the</span><br><span class="line">  system property &#x27;ro.cpuset.default&#x27; is set to a non-empty cpuset name (e.g.</span><br><span class="line">  &#x27;/foreground&#x27;), then the pid is written to file /dev/cpuset/_cpuset\_name_/tasks.</span><br><span class="line">  The use of this option for moving a process into a cgroup is obsolete. Please</span><br><span class="line">  use task_profiles option instead.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Triggers</span><br><span class="line">--------</span><br><span class="line">Triggers are strings which can be used to match certain kinds of</span><br><span class="line">events and used to cause an action to occur.</span><br><span class="line"></span><br><span class="line">Triggers are subdivided into event triggers and property triggers.</span><br><span class="line"></span><br><span class="line">Event triggers are strings triggered by the &#x27;trigger&#x27; command or by</span><br><span class="line">the QueueEventTrigger() function within the init executable.  These</span><br><span class="line">take the form of a simple string such as &#x27;boot&#x27; or &#x27;late-init&#x27;.</span><br><span class="line"></span><br><span class="line">Property triggers are strings triggered when a named property changes</span><br><span class="line">value to a given new value or when a named property changes value to</span><br><span class="line">any new value.  These take the form of &#x27;property:&lt;name&gt;=&lt;value&gt;&#x27; and</span><br><span class="line">&#x27;property:&lt;name&gt;=\*&#x27; respectively.  Property triggers are additionally</span><br><span class="line">evaluated and triggered accordingly during the initial boot phase of</span><br><span class="line">init.</span><br><span class="line"></span><br><span class="line">An Action can have multiple property triggers but may only have one</span><br><span class="line">event trigger.</span><br><span class="line"></span><br><span class="line">For example:</span><br><span class="line">`on boot &amp;&amp; property:a=b` defines an action that is only executed when</span><br><span class="line">the &#x27;boot&#x27; event trigger happens and the property a equals b.</span><br><span class="line"></span><br><span class="line">`on property:a=b &amp;&amp; property:c=d` defines an action that is executed</span><br><span class="line">at three times:</span><br><span class="line"></span><br><span class="line">   1. During initial boot if property a=b and property c=d.</span><br><span class="line">   2. Any time that property a transitions to value b, while property c already equals d.</span><br><span class="line">   3. Any time that property c transitions to value d, while property a already equals b.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Trigger Sequence</span><br><span class="line">----------------</span><br><span class="line"></span><br><span class="line">Init uses the following sequence of triggers during early boot. These are the</span><br><span class="line">built-in triggers defined in init.cpp.</span><br><span class="line"></span><br><span class="line">   1. `early-init` - The first in the sequence, triggered after cgroups has been configured</span><br><span class="line">      but before ueventd&#x27;s coldboot is complete.</span><br><span class="line">   2. `init` - Triggered after coldboot is complete.</span><br><span class="line">   3. `charger` - Triggered if `ro.bootmode == &quot;charger&quot;`.</span><br><span class="line">   4. `late-init` - Triggered if `ro.bootmode != &quot;charger&quot;`, or via healthd triggering a boot</span><br><span class="line">      from charging mode.</span><br><span class="line"></span><br><span class="line">Remaining triggers are configured in `init.rc` and are not built-in. The default sequence for</span><br><span class="line">these is specified under the &quot;on late-init&quot; event in `init.rc`. Actions internal to `init.rc`</span><br><span class="line">have been omitted.</span><br><span class="line"></span><br><span class="line">   1. `early-fs` - Start vold.</span><br><span class="line">   2. `fs` - Vold is up. Mount partitions not marked as first-stage or latemounted.</span><br><span class="line">   3. `post-fs` - Configure anything dependent on early mounts.</span><br><span class="line">   4. `late-fs` - Mount partitions marked as latemounted.</span><br><span class="line">   5. `post-fs-data` - Mount and configure `/data`; set up encryption. `/metadata` is</span><br><span class="line">      reformatted here if it couldn&#x27;t mount in first-stage init.</span><br><span class="line">   6. `zygote-start` - Start the zygote.</span><br><span class="line">   7. `early-boot` - After zygote has started.</span><br><span class="line">   8. `boot` - After `early-boot` actions have completed.</span><br><span class="line"></span><br><span class="line">Commands</span><br><span class="line">--------</span><br><span class="line"></span><br><span class="line">`bootchart [start|stop]`</span><br><span class="line">&gt; Start/stop bootcharting. These are present in the default init.rc files,</span><br><span class="line">  but bootcharting is only active if the file /data/bootchart/enabled exists;</span><br><span class="line">  otherwise bootchart start/stop are no-ops.</span><br><span class="line"></span><br><span class="line">`chmod &lt;octal-mode&gt; &lt;path&gt;`</span><br><span class="line">&gt; Change file access permissions.</span><br><span class="line"></span><br><span class="line">`chown &lt;owner&gt; &lt;group&gt; &lt;path&gt;`</span><br><span class="line">&gt; Change file owner and group.</span><br><span class="line"></span><br><span class="line">`class_start &lt;serviceclass&gt;`</span><br><span class="line">&gt; Start all services of the specified class if they are</span><br><span class="line">  not already running.  See the start entry for more information on</span><br><span class="line">  starting services.</span><br><span class="line"></span><br><span class="line">`class_stop &lt;serviceclass&gt;`</span><br><span class="line">&gt; Stop and disable all services of the specified class if they are</span><br><span class="line">  currently running.</span><br><span class="line"></span><br><span class="line">`class_reset &lt;serviceclass&gt;`</span><br><span class="line">&gt; Stop all services of the specified class if they are</span><br><span class="line">  currently running, without disabling them. They can be restarted</span><br><span class="line">  later using `class_start`.</span><br><span class="line"></span><br><span class="line">`class_restart [--only-enabled] &lt;serviceclass&gt;`</span><br><span class="line">&gt; Restarts all services of the specified class. If `--only-enabled` is</span><br><span class="line">  specified, then disabled services are skipped.</span><br><span class="line"></span><br><span class="line">`copy &lt;src&gt; &lt;dst&gt;`</span><br><span class="line">&gt; Copies a file. Similar to write, but useful for binary/large</span><br><span class="line">  amounts of data.</span><br><span class="line">  Regarding to the src file, copying from symbolic link file and world-writable</span><br><span class="line">  or group-writable files are not allowed.</span><br><span class="line">  Regarding to the dst file, the default mode created is 0600 if it does not</span><br><span class="line">  exist. And it will be truncated if dst file is a normal regular file and</span><br><span class="line">  already exists.</span><br><span class="line"></span><br><span class="line">`copy_per_line &lt;src&gt; &lt;dst&gt;`</span><br><span class="line">&gt; Copies a file line by line. Similar to copy, but useful for dst is a sysfs node</span><br><span class="line">  that doesn&#x27;t handle multiple lines of data.</span><br><span class="line"></span><br><span class="line">`domainname &lt;name&gt;`</span><br><span class="line">&gt; Set the domain name.</span><br><span class="line"></span><br><span class="line">`enable &lt;servicename&gt;`</span><br><span class="line">&gt; Turns a disabled service into an enabled one as if the service did not</span><br><span class="line">  specify disabled.</span><br><span class="line">  If the service is supposed to be running, it will be started now.</span><br><span class="line">  Typically used when the bootloader sets a variable that indicates a specific</span><br><span class="line">  service should be started when needed. E.g.</span><br><span class="line"></span><br><span class="line">    on property:ro.boot.myfancyhardware=1</span><br><span class="line">        enable my_fancy_service_for_my_fancy_hardware</span><br><span class="line"></span><br><span class="line">`exec [ &lt;seclabel&gt; [ &lt;user&gt; [ &lt;group&gt;\* ] ] ] -- &lt;command&gt; [ &lt;argument&gt;\* ]`</span><br><span class="line">&gt; Fork and execute command with the given arguments. The command starts</span><br><span class="line">  after &quot;--&quot; so that an optional security context, user, and supplementary</span><br><span class="line">  groups can be provided. No other commands will be run until this one</span><br><span class="line">  finishes. _seclabel_ can be a - to denote default. Properties are expanded</span><br><span class="line">  within _argument_.</span><br><span class="line">  Init halts executing commands until the forked process exits.</span><br><span class="line"></span><br><span class="line">`exec_background [ &lt;seclabel&gt; [ &lt;user&gt; [ &lt;group&gt;\* ] ] ] -- &lt;command&gt; [ &lt;argument&gt;\* ]`</span><br><span class="line">&gt; Fork and execute command with the given arguments. This is handled similarly</span><br><span class="line">  to the `exec` command. The difference is that init does not halt executing</span><br><span class="line">  commands until the process exits for `exec_background`.</span><br><span class="line"></span><br><span class="line">`exec_start &lt;service&gt;`</span><br><span class="line">&gt; Start a given service and halt the processing of additional init commands</span><br><span class="line">  until it returns.  The command functions similarly to the `exec` command,</span><br><span class="line">  but uses an existing service definition in place of the exec argument vector.</span><br><span class="line"></span><br><span class="line">`export &lt;name&gt; &lt;value&gt;`</span><br><span class="line">&gt; Set the environment variable _name_ equal to _value_ in the</span><br><span class="line">  global environment (which will be inherited by all processes</span><br><span class="line">  started after this command is executed)</span><br><span class="line"></span><br><span class="line">`hostname &lt;name&gt;`</span><br><span class="line">&gt; Set the host name.</span><br><span class="line"></span><br><span class="line">`ifup &lt;interface&gt;`</span><br><span class="line">&gt; Bring the network interface _interface_ online.</span><br><span class="line"></span><br><span class="line">`insmod [-f] &lt;path&gt; [&lt;options&gt;]`</span><br><span class="line">&gt; Install the module at _path_ with the specified options.</span><br><span class="line">  -f: force installation of the module even if the version of the running kernel</span><br><span class="line">  and the version of the kernel for which the module was compiled do not match.</span><br><span class="line"></span><br><span class="line">`interface_start &lt;name&gt;` \</span><br><span class="line">`interface_restart &lt;name&gt;` \</span><br><span class="line">`interface_stop &lt;name&gt;`</span><br><span class="line">&gt; Find the service that provides the interface _name_ if it exists and run the `start`, `restart`,</span><br><span class="line">or `stop` commands on it respectively.  _name_ may be either a fully qualified HIDL name, in which</span><br><span class="line">case it is specified as `&lt;interface&gt;/&lt;instance&gt;`, or an AIDL name, in which case it is specified as</span><br><span class="line">`aidl/&lt;interface&gt;` for example `android.hardware.secure_element@1.1::ISecureElement/eSE1` or</span><br><span class="line">`aidl/aidl_lazy_test_1`.</span><br><span class="line"></span><br><span class="line">&gt; Note that these commands only act on interfaces specified by the `interface` service option, not</span><br><span class="line">on interfaces registered at runtime.</span><br><span class="line"></span><br><span class="line">&gt; Example usage of these commands: \</span><br><span class="line">`interface_start android.hardware.secure_element@1.1::ISecureElement/eSE1`</span><br><span class="line">will start the HIDL Service that provides the `android.hardware.secure_element@1.1` and `eSI1`</span><br><span class="line">instance. \</span><br><span class="line">`interface_start aidl/aidl_lazy_test_1` will start the AIDL service that</span><br><span class="line">provides the `aidl_lazy_test_1` interface.</span><br><span class="line"></span><br><span class="line">`load_exports &lt;path&gt;`</span><br><span class="line">&gt; Open the file at _path_ and export global environment variables declared</span><br><span class="line">  there. Each line must be in the format `export &lt;name&gt; &lt;value&gt;`, as described</span><br><span class="line">  above.</span><br><span class="line"></span><br><span class="line">`load_system_props`</span><br><span class="line">&gt; (This action is deprecated and no-op.)</span><br><span class="line"></span><br><span class="line">`load_persist_props`</span><br><span class="line">&gt; Loads persistent properties when /data has been decrypted.</span><br><span class="line">  This is included in the default init.rc.</span><br><span class="line"></span><br><span class="line">`loglevel &lt;level&gt;`</span><br><span class="line">&gt; Sets init&#x27;s log level to the integer level, from 7 (all logging) to 0</span><br><span class="line">  (fatal logging only). The numeric values correspond to the kernel log</span><br><span class="line">  levels, but this command does not affect the kernel log level. Use the</span><br><span class="line">  `write` command to write to `/proc/sys/kernel/printk` to change that.</span><br><span class="line">  Properties are expanded within _level_.</span><br><span class="line"></span><br><span class="line">`mark_post_data`</span><br><span class="line">&gt; Used to mark the point right after /data is mounted.</span><br><span class="line"></span><br><span class="line">`mkdir &lt;path&gt; [&lt;mode&gt;] [&lt;owner&gt;] [&lt;group&gt;] [encryption=&lt;action&gt;] [key=&lt;key&gt;]`</span><br><span class="line">&gt; Create a directory at _path_, optionally with the given mode, owner, and</span><br><span class="line">  group. If not provided, the directory is created with permissions 755 and</span><br><span class="line">  owned by the root user and root group. If provided, the mode, owner and group</span><br><span class="line">  will be updated if the directory exists already.</span><br><span class="line"></span><br><span class="line"> &gt; _action_ can be one of:</span><br><span class="line">  * `None`: take no encryption action; directory will be encrypted if parent is.</span><br><span class="line">  * `Require`: encrypt directory, abort boot process if encryption fails</span><br><span class="line">  * `Attempt`: try to set an encryption policy, but continue if it fails</span><br><span class="line">  * `DeleteIfNecessary`: recursively delete directory if necessary to set</span><br><span class="line">  encryption policy.</span><br><span class="line"></span><br><span class="line">  &gt; _key_ can be one of:</span><br><span class="line">  * `ref`: use the systemwide DE key</span><br><span class="line">  * `per_boot_ref`: use the key freshly generated on each boot.</span><br><span class="line"></span><br><span class="line">`mount_all [ &lt;fstab&gt; ] [--&lt;option&gt;]`</span><br><span class="line">&gt; Calls fs\_mgr\_mount\_all on the given fs\_mgr-format fstab with optional</span><br><span class="line">  options &quot;early&quot; and &quot;late&quot;.</span><br><span class="line">  With &quot;--early&quot; set, the init executable will skip mounting entries with</span><br><span class="line">  &quot;latemount&quot; flag and triggering fs encryption state event. With &quot;--late&quot; set,</span><br><span class="line">  init executable will only mount entries with &quot;latemount&quot; flag. By default,</span><br><span class="line">  no option is set, and mount\_all will process all entries in the given fstab.</span><br><span class="line">  If the fstab parameter is not specified, fstab.$&#123;ro.boot.fstab_suffix&#125;,</span><br><span class="line">  fstab.$&#123;ro.hardware&#125; or fstab.$&#123;ro.hardware.platform&#125; will be scanned for</span><br><span class="line">  under /odm/etc, /vendor/etc, or / at runtime, in that order.</span><br><span class="line"></span><br><span class="line">`mount &lt;type&gt; &lt;device&gt; &lt;dir&gt; [ &lt;flag&gt;\* ] [&lt;options&gt;]`</span><br><span class="line">&gt; Attempt to mount the named device at the directory _dir_</span><br><span class="line">  _flag_s include &quot;ro&quot;, &quot;rw&quot;, &quot;remount&quot;, &quot;noatime&quot;, ...</span><br><span class="line">  _options_ include &quot;barrier=1&quot;, &quot;noauto\_da\_alloc&quot;, &quot;discard&quot;, ... as</span><br><span class="line">  a comma separated string, e.g. barrier=1,noauto\_da\_alloc</span><br><span class="line"></span><br><span class="line">`perform_apex_config`</span><br><span class="line">&gt; Performs tasks after APEXes are mounted. For example, creates data directories</span><br><span class="line">  for the mounted APEXes, parses config file(s) from them, and updates linker</span><br><span class="line">  configurations. Intended to be used only once when apexd notifies the mount</span><br><span class="line">  event by setting `apexd.status` to ready.</span><br><span class="line"></span><br><span class="line">`restart [--only-if-running] &lt;service&gt;`</span><br><span class="line">&gt; Stops and restarts a running service, does nothing if the service is currently</span><br><span class="line">  restarting, otherwise, it just starts the service. If &quot;--only-if-running&quot; is</span><br><span class="line">  specified, the service is only restarted if it is already running.</span><br><span class="line"></span><br><span class="line">`restorecon &lt;path&gt; [ &lt;path&gt;\* ]`</span><br><span class="line">&gt; Restore the file named by _path_ to the security context specified</span><br><span class="line">  in the file\_contexts configuration.</span><br><span class="line">  Not required for directories created by the init.rc as these are</span><br><span class="line">  automatically labeled correctly by init.</span><br><span class="line"></span><br><span class="line">`restorecon_recursive &lt;path&gt; [ &lt;path&gt;\* ]`</span><br><span class="line">&gt; Recursively restore the directory tree named by _path_ to the</span><br><span class="line">  security contexts specified in the file\_contexts configuration.</span><br><span class="line"></span><br><span class="line">`rm &lt;path&gt;`</span><br><span class="line">&gt; Calls unlink(2) on the given path. You might want to</span><br><span class="line">  use &quot;exec -- rm ...&quot; instead (provided the system partition is</span><br><span class="line">  already mounted).</span><br><span class="line"></span><br><span class="line">`rmdir &lt;path&gt;`</span><br><span class="line">&gt; Calls rmdir(2) on the given path.</span><br><span class="line"></span><br><span class="line">`readahead &lt;file|dir&gt; [--fully]`</span><br><span class="line">&gt; Calls readahead(2) on the file or files within given directory.</span><br><span class="line">  Use option --fully to read the full file content.</span><br><span class="line"></span><br><span class="line">`setprop &lt;name&gt; &lt;value&gt;`</span><br><span class="line">&gt; Set system property _name_ to _value_. Properties are expanded</span><br><span class="line">  within _value_.</span><br><span class="line"></span><br><span class="line">`setrlimit &lt;resource&gt; &lt;cur&gt; &lt;max&gt;`</span><br><span class="line">&gt; Set the rlimit for a resource. This applies to all processes launched after</span><br><span class="line">  the limit is set. It is intended to be set early in init and applied globally.</span><br><span class="line">  _resource_ is best specified using its text representation (&#x27;cpu&#x27;, &#x27;rtio&#x27;, etc</span><br><span class="line">  or &#x27;RLIM_CPU&#x27;, &#x27;RLIM_RTIO&#x27;, etc). It also may be specified as the int value</span><br><span class="line">  that the resource enum corresponds to.</span><br><span class="line">  _cur_ and _max_ can be &#x27;unlimited&#x27; or &#x27;-1&#x27; to indicate an infinite rlimit.</span><br><span class="line"></span><br><span class="line">`start &lt;service&gt;`</span><br><span class="line">&gt; Start a service running if it is not already running.</span><br><span class="line">  Note that this is _not_ synchronous, and even if it were, there is</span><br><span class="line">  no guarantee that the operating system&#x27;s scheduler will execute the</span><br><span class="line">  service sufficiently to guarantee anything about the service&#x27;s status.</span><br><span class="line">  See the `exec_start` command for a synchronous version of `start`.</span><br><span class="line"></span><br><span class="line">&gt; This creates an important consequence that if the service offers</span><br><span class="line">  functionality to other services, such as providing a</span><br><span class="line">  communication channel, simply starting this service before those</span><br><span class="line">  services is _not_ sufficient to guarantee that the channel has</span><br><span class="line">  been set up before those services ask for it.  There must be a</span><br><span class="line">  separate mechanism to make any such guarantees.</span><br><span class="line"></span><br><span class="line">`stop &lt;service&gt;`</span><br><span class="line">&gt; Stop a service from running if it is currently running.</span><br><span class="line"></span><br><span class="line">`swapon_all [ &lt;fstab&gt; ]`</span><br><span class="line">&gt; Calls fs\_mgr\_swapon\_all on the given fstab file.</span><br><span class="line">  If the fstab parameter is not specified, fstab.$&#123;ro.boot.fstab_suffix&#125;,</span><br><span class="line">  fstab.$&#123;ro.hardware&#125; or fstab.$&#123;ro.hardware.platform&#125; will be scanned for</span><br><span class="line">  under /odm/etc, /vendor/etc, or / at runtime, in that order.</span><br><span class="line"></span><br><span class="line">`symlink &lt;target&gt; &lt;path&gt;`</span><br><span class="line">&gt; Create a symbolic link at _path_ with the value _target_</span><br><span class="line"></span><br><span class="line">`sysclktz &lt;minutes_west_of_gmt&gt;`</span><br><span class="line">&gt; Set the system clock base (0 if system clock ticks in GMT)</span><br><span class="line"></span><br><span class="line">`trigger &lt;event&gt;`</span><br><span class="line">&gt; Trigger an event.  Used to queue an action from another</span><br><span class="line">  action.</span><br><span class="line"></span><br><span class="line">`umount &lt;path&gt;`</span><br><span class="line">&gt; Unmount the filesystem mounted at that path.</span><br><span class="line"></span><br><span class="line">`umount_all [ &lt;fstab&gt; ]`</span><br><span class="line">&gt; Calls fs\_mgr\_umount\_all on the given fstab file.</span><br><span class="line">  If the fstab parameter is not specified, fstab.$&#123;ro.boot.fstab_suffix&#125;,</span><br><span class="line">  fstab.$&#123;ro.hardware&#125; or fstab.$&#123;ro.hardware.platform&#125; will be scanned for</span><br><span class="line">  under /odm/etc, /vendor/etc, or / at runtime, in that order.</span><br><span class="line"></span><br><span class="line">`verity_update_state`</span><br><span class="line">&gt; Internal implementation detail used to update dm-verity state and</span><br><span class="line">  set the partition._mount-point_.verified properties used by adb remount</span><br><span class="line">  because fs\_mgr can&#x27;t set them directly itself. This is required since</span><br><span class="line">  Android 12, because CtsNativeVerifiedBootTestCases will read property</span><br><span class="line">  &quot;partition.$&#123;partition&#125;.verified.hash_alg&quot; to check that sha1 is not used.</span><br><span class="line">  See https://r.android.com/1546980 for more details.</span><br><span class="line"></span><br><span class="line">`wait &lt;path&gt; [ &lt;timeout&gt; ]`</span><br><span class="line">&gt; Poll for the existence of the given file and return when found,</span><br><span class="line">  or the timeout has been reached. If timeout is not specified it</span><br><span class="line">  currently defaults to five seconds. The timeout value can be</span><br><span class="line">  fractional seconds, specified in floating point notation.</span><br><span class="line"></span><br><span class="line">`wait_for_prop &lt;name&gt; &lt;value&gt;`</span><br><span class="line">&gt; Wait for system property _name_ to be _value_. Properties are expanded</span><br><span class="line">  within _value_. If property _name_ is already set to _value_, continue</span><br><span class="line">  immediately.</span><br><span class="line"></span><br><span class="line">`write &lt;path&gt; &lt;content&gt;`</span><br><span class="line">&gt; Open the file at _path_ and write a string to it with write(2).</span><br><span class="line">  If the file does not exist, it will be created. If it does exist,</span><br><span class="line">  it will be truncated. Properties are expanded within _content_.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Imports</span><br><span class="line">-------</span><br><span class="line">`import &lt;path&gt;`</span><br><span class="line">&gt; Parse an init config file, extending the current configuration.</span><br><span class="line">  If _path_ is a directory, each file in the directory is parsed as</span><br><span class="line">  a config file. It is not recursive, nested directories will</span><br><span class="line">  not be parsed.</span><br><span class="line"></span><br><span class="line">The import keyword is not a command, but rather its own section,</span><br><span class="line">meaning that it does not happen as part of an Action, but rather,</span><br><span class="line">imports are handled as a file is being parsed and follow the below logic.</span><br><span class="line"></span><br><span class="line">There are only three times where the init executable imports .rc files:</span><br><span class="line"></span><br><span class="line">   1. When it imports `/system/etc/init/hw/init.rc` or the script indicated by the property</span><br><span class="line">      `ro.boot.init_rc` during initial boot.</span><br><span class="line">   2. When it imports `/&#123;system,system_ext,vendor,odm,product&#125;/etc/init/` immediately after</span><br><span class="line">      importing `/system/etc/init/hw/init.rc`.</span><br><span class="line">   3. (Deprecated) When it imports /&#123;system,vendor,odm&#125;/etc/init/ or .rc files</span><br><span class="line">      at specified paths during mount_all, not allowed for devices launching</span><br><span class="line">      after Q.</span><br><span class="line"></span><br><span class="line">The order that files are imported is a bit complex for legacy reasons.  The below is guaranteed:</span><br><span class="line"></span><br><span class="line">1. `/system/etc/init/hw/init.rc` is parsed then recursively each of its imports are</span><br><span class="line">   parsed.</span><br><span class="line">2. The contents of `/system/etc/init/` are alphabetized and parsed sequentially, with imports</span><br><span class="line">   happening recursively after each file is parsed.</span><br><span class="line">3. Step 2 is repeated for `/system_ext/etc/init`, `/vendor/etc/init`, `/odm/etc/init`,</span><br><span class="line">   `/product/etc/init`</span><br><span class="line"></span><br><span class="line">The below pseudocode may explain this more clearly:</span><br><span class="line"></span><br><span class="line">    fn Import(file)</span><br><span class="line">      Parse(file)</span><br><span class="line">      for (import : file.imports)</span><br><span class="line">        Import(import)</span><br><span class="line"></span><br><span class="line">    Import(/system/etc/init/hw/init.rc)</span><br><span class="line">    Directories = [/system/etc/init, /system_ext/etc/init, /vendor/etc/init, /odm/etc/init, /product/etc/init]</span><br><span class="line">    for (directory : Directories)</span><br><span class="line">      files = &lt;Alphabetical order of directory&#x27;s contents&gt;</span><br><span class="line">      for (file : files)</span><br><span class="line">        Import(file)</span><br><span class="line"></span><br><span class="line">Actions are executed in the order that they are parsed.  For example the `post-fs-data` action(s)</span><br><span class="line">in `/system/etc/init/hw/init.rc` are always the first `post-fs-data` action(s) to be executed in</span><br><span class="line">order of how they appear in that file.  Then the `post-fs-data` actions of the imports of</span><br><span class="line">`/system/etc/init/hw/init.rc` in the order that they&#x27;re imported, etc.</span><br><span class="line"></span><br><span class="line">Properties</span><br><span class="line">----------</span><br><span class="line">Init provides state information with the following properties.</span><br><span class="line"></span><br><span class="line">`init.svc.&lt;name&gt;`</span><br><span class="line">&gt; State of a named service (&quot;stopped&quot;, &quot;stopping&quot;, &quot;running&quot;, &quot;restarting&quot;)</span><br><span class="line"></span><br><span class="line">`dev.mnt.dev.&lt;mount_point&gt;`, `dev.mnt.blk.&lt;mount_point&gt;`, `dev.mnt.rootdisk.&lt;mount_point&gt;`</span><br><span class="line">&gt; Block device base name associated with a *mount_point*.</span><br><span class="line">  The *mount_point* has / replaced by . and if referencing the root mount point</span><br><span class="line">  &quot;/&quot;, it will use &quot;/root&quot;.</span><br><span class="line">  `dev.mnt.dev.&lt;mount_point&gt;` indicates a block device attached to filesystems.</span><br><span class="line">    (e.g., dm-N or sdaN/mmcblk0pN to access `/sys/fs/ext4/$&#123;dev.mnt.dev.&lt;mount_point&gt;&#125;/`)</span><br><span class="line"></span><br><span class="line">  `dev.mnt.blk.&lt;mount_point&gt;` indicates the disk partition to the above block device.</span><br><span class="line">    (e.g., sdaN / mmcblk0pN to access `/sys/class/block/$&#123;dev.mnt.blk.&lt;mount_point&gt;&#125;/`)</span><br><span class="line"></span><br><span class="line">  `dev.mnt.rootdisk.&lt;mount_point&gt;` indicates the root disk to contain the above disk partition.</span><br><span class="line">    (e.g., sda / mmcblk0 to access `/sys/class/block/$&#123;dev.mnt.rootdisk.&lt;mount_point&gt;&#125;/queue`)</span><br><span class="line"></span><br><span class="line">Init responds to properties that begin with `ctl.`.  These properties take the format of</span><br><span class="line">`ctl.[&lt;target&gt;_]&lt;command&gt;` and the _value_ of the system property is used as a parameter.  The</span><br><span class="line">_target_ is optional and specifies the service option that _value_ is meant to match with.  There is</span><br><span class="line">only one option for _target_, `interface` which indicates that _value_ will refer to an interface</span><br><span class="line">that a service provides and not the service name itself.</span><br><span class="line"></span><br><span class="line">For example:</span><br><span class="line"></span><br><span class="line">`SetProperty(&quot;ctl.start&quot;, &quot;logd&quot;)` will run the `start` command on `logd`.</span><br><span class="line"></span><br><span class="line">`SetProperty(&quot;ctl.interface_start&quot;, &quot;aidl/aidl_lazy_test_1&quot;)` will run the `start` command on the</span><br><span class="line">service that exposes the `aidl aidl_lazy_test_1` interface.</span><br><span class="line"></span><br><span class="line">Note that these</span><br><span class="line">properties are only settable; they will have no value when read.</span><br><span class="line"></span><br><span class="line">The _commands_ are listed below.</span><br><span class="line"></span><br><span class="line">`start` \</span><br><span class="line">`restart` \</span><br><span class="line">`stop` \</span><br><span class="line">These are equivalent to using the `start`, `restart`, and `stop` commands on the service specified</span><br><span class="line">by the _value_ of the property.</span><br><span class="line"></span><br><span class="line">`oneshot_on` and `oneshot_off` will turn on or off the _oneshot_</span><br><span class="line">flag for the service specified by the _value_ of the property.  This is</span><br><span class="line">particularly intended for services that are conditionally lazy HALs.  When</span><br><span class="line">they are lazy HALs, oneshot must be on, otherwise oneshot should be off.</span><br><span class="line"></span><br><span class="line">`sigstop_on` and `sigstop_off` will turn on or off the _sigstop_ feature for the service</span><br><span class="line">specified by the _value_ of the property.  See the _Debugging init_ section below for more details</span><br><span class="line">about this feature.</span><br><span class="line"></span><br><span class="line">Boot timing</span><br><span class="line">-----------</span><br><span class="line">Init records some boot timing information in system properties.</span><br><span class="line"></span><br><span class="line">`ro.boottime.init`</span><br><span class="line">&gt; Time after boot in ns (via the CLOCK\_BOOTTIME clock) at which the first</span><br><span class="line">  stage of init started.</span><br><span class="line"></span><br><span class="line">`ro.boottime.init.first_stage`</span><br><span class="line">&gt; How long in ns it took to run first stage.</span><br><span class="line"></span><br><span class="line">`ro.boottime.init.selinux`</span><br><span class="line">&gt; How long in ns it took to run SELinux stage.</span><br><span class="line"></span><br><span class="line">`ro.boottime.init.modules`</span><br><span class="line">&gt; How long in ms it took to load kernel modules.</span><br><span class="line"></span><br><span class="line">`ro.boottime.init.cold_boot_wait`</span><br><span class="line">&gt; How long init waited for ueventd&#x27;s coldboot phase to end.</span><br><span class="line"></span><br><span class="line">`ro.boottime.&lt;service-name&gt;`</span><br><span class="line">&gt; Time after boot in ns (via the CLOCK\_BOOTTIME clock) that the service was</span><br><span class="line">  first started.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Bootcharting</span><br><span class="line">------------</span><br><span class="line">This version of init contains code to perform &quot;bootcharting&quot;: generating log</span><br><span class="line">files that can be later processed by the tools provided by &lt;http://www.bootchart.org/&gt;.</span><br><span class="line"></span><br><span class="line">On the emulator, use the -bootchart _timeout_ option to boot with bootcharting</span><br><span class="line">activated for _timeout_ seconds.</span><br><span class="line"></span><br><span class="line">On a device:</span><br><span class="line"></span><br><span class="line">    adb shell &#x27;touch /data/bootchart/enabled&#x27;</span><br><span class="line"></span><br><span class="line">Don&#x27;t forget to delete this file when you&#x27;re done collecting data!</span><br><span class="line"></span><br><span class="line">The log files are written to /data/bootchart/. A script is provided to</span><br><span class="line">retrieve them and create a bootchart.tgz file that can be used with the</span><br><span class="line">bootchart command-line utility:</span><br><span class="line"></span><br><span class="line">    sudo apt-get install pybootchartgui</span><br><span class="line">    # grab-bootchart.sh uses $ANDROID_SERIAL.</span><br><span class="line">    $ANDROID_BUILD_TOP/system/core/init/grab-bootchart.sh</span><br><span class="line"></span><br><span class="line">One thing to watch for is that the bootchart will show init as if it started</span><br><span class="line">running at 0s. You&#x27;ll have to look at dmesg to work out when the kernel</span><br><span class="line">actually started init.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Comparing two bootcharts</span><br><span class="line">------------------------</span><br><span class="line">A handy script named compare-bootcharts.py can be used to compare the</span><br><span class="line">start/end time of selected processes. The aforementioned grab-bootchart.sh</span><br><span class="line">will leave a bootchart tarball named bootchart.tgz at /tmp/android-bootchart.</span><br><span class="line">If two such tarballs are preserved on the host machine under different</span><br><span class="line">directories, the script can list the timestamps differences. For example:</span><br><span class="line"></span><br><span class="line">Usage: system/core/init/compare-bootcharts.py _base-bootchart-dir_ _exp-bootchart-dir_</span><br><span class="line"></span><br><span class="line">    process: baseline experiment (delta) - Unit is ms (a jiffy is 10 ms on the system)</span><br><span class="line">    ------------------------------------</span><br><span class="line">    /init: 50 40 (-10)</span><br><span class="line">    /system/bin/surfaceflinger: 4320 4470 (+150)</span><br><span class="line">    /system/bin/bootanimation: 6980 6990 (+10)</span><br><span class="line">    zygote64: 10410 10640 (+230)</span><br><span class="line">    zygote: 10410 10640 (+230)</span><br><span class="line">    system_server: 15350 15150 (-200)</span><br><span class="line">    bootanimation ends at: 33790 31230 (-2560)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Systrace</span><br><span class="line">--------</span><br><span class="line">Systrace (&lt;http://developer.android.com/tools/help/systrace.html&gt;) can be</span><br><span class="line">used for obtaining performance analysis reports during boot</span><br><span class="line">time on userdebug or eng builds.</span><br><span class="line"></span><br><span class="line">Here is an example of trace events of &quot;wm&quot; and &quot;am&quot; categories:</span><br><span class="line"></span><br><span class="line">    $ANDROID_BUILD_TOP/external/chromium-trace/systrace.py \</span><br><span class="line">          wm am --boot</span><br><span class="line"></span><br><span class="line">This command will cause the device to reboot. After the device is rebooted and</span><br><span class="line">the boot sequence has finished, the trace report is obtained from the device</span><br><span class="line">and written as trace.html on the host by hitting Ctrl+C.</span><br><span class="line"></span><br><span class="line">Limitation: recording trace events is started after persistent properties are loaded, so</span><br><span class="line">the trace events that are emitted before that are not recorded. Several</span><br><span class="line">services such as vold, surfaceflinger, and servicemanager are affected by this</span><br><span class="line">limitation since they are started before persistent properties are loaded.</span><br><span class="line">Zygote initialization and the processes that are forked from the zygote are not</span><br><span class="line">affected.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Debugging init</span><br><span class="line">--------------</span><br><span class="line">When a service starts from init, it may fail to `execv()` the service. This is not typical, and may</span><br><span class="line">point to an error happening in the linker as the new service is started. The linker in Android</span><br><span class="line">prints its logs to `logd` and `stderr`, so they are visible in `logcat`. If the error is encountered</span><br><span class="line">before it is possible to access `logcat`, the `stdio_to_kmsg` service option may be used to direct</span><br><span class="line">the logs that the linker prints to `stderr` to `kmsg`, where they can be read via a serial port.</span><br><span class="line"></span><br><span class="line">Launching init services without init is not recommended as init sets up a significant amount of</span><br><span class="line">environment (user, groups, security label, capabilities, etc) that is hard to replicate manually.</span><br><span class="line"></span><br><span class="line">If it is required to debug a service from its very start, the `sigstop` service option is added.</span><br><span class="line">This option will send SIGSTOP to a service immediately before calling exec. This gives a window</span><br><span class="line">where developers can attach a debugger, strace, etc before continuing the service with SIGCONT.</span><br><span class="line"></span><br><span class="line">This flag can also be dynamically controlled via the ctl.sigstop_on and ctl.sigstop_off properties.</span><br><span class="line"></span><br><span class="line">Below is an example of dynamically debugging logd via the above:</span><br><span class="line"></span><br><span class="line">    stop logd</span><br><span class="line">    setprop ctl.sigstop_on logd</span><br><span class="line">    start logd</span><br><span class="line">    ps -e | grep logd</span><br><span class="line">    &gt; logd          4343     1   18156   1684 do_signal_stop 538280 T init</span><br><span class="line">    gdbclient.py -p 4343</span><br><span class="line">    b main</span><br><span class="line">    c</span><br><span class="line">    c</span><br><span class="line">    c</span><br><span class="line">    &gt; Breakpoint 1, main (argc=1, argv=0x7ff8c9a488) at system/core/logd/main.cpp:427</span><br><span class="line"></span><br><span class="line">Below is an example of doing the same but with strace</span><br><span class="line"></span><br><span class="line">    stop logd</span><br><span class="line">    setprop ctl.sigstop_on logd</span><br><span class="line">    start logd</span><br><span class="line">    ps -e | grep logd</span><br><span class="line">    &gt; logd          4343     1   18156   1684 do_signal_stop 538280 T init</span><br><span class="line">    strace -p 4343</span><br><span class="line"></span><br><span class="line">    (From a different shell)</span><br><span class="line">    kill -SIGCONT 4343</span><br><span class="line"></span><br><span class="line">    &gt; strace runs</span><br><span class="line"></span><br><span class="line">Host Init Script Verification</span><br><span class="line">-----------------------------</span><br><span class="line"></span><br><span class="line">Init scripts are checked for correctness during build time. Specifically the below is checked.</span><br><span class="line"></span><br><span class="line">1) Well formatted action, service and import sections, e.g. no actions without a preceding &#x27;on&#x27;</span><br><span class="line">line, and no extraneous lines after an &#x27;import&#x27; statement.</span><br><span class="line">2) All commands map to a valid keyword and the argument count is within the correct range.</span><br><span class="line">3) All service options are valid. This is stricter than how commands are checked as the service</span><br><span class="line">options&#x27; arguments are fully parsed, e.g. UIDs and GIDs must resolve.</span><br><span class="line"></span><br><span class="line">There are other parts of init scripts that are only parsed at runtime and therefore not checked</span><br><span class="line">during build time, among them are the below.</span><br><span class="line"></span><br><span class="line">1) The validity of the arguments of commands, e.g. no checking if file paths actually exist, if</span><br><span class="line">SELinux would permit the operation, or if the UIDs and GIDs resolve.</span><br><span class="line">2) No checking if a service exists or has a valid SELinux domain defined</span><br><span class="line">3) No checking if a service has not been previously defined in a different init script.</span><br><span class="line"></span><br><span class="line">Early Init Boot Sequence</span><br><span class="line">------------------------</span><br><span class="line">The early init boot sequence is broken up into three stages: first stage init, SELinux setup, and</span><br><span class="line">second stage init.</span><br><span class="line"></span><br><span class="line">First stage init is responsible for setting up the bare minimum requirements to load the rest of the</span><br><span class="line">system. Specifically this includes mounting /dev, /proc, mounting &#x27;early mount&#x27; partitions (which</span><br><span class="line">needs to include all partitions that contain system code, for example system and vendor), and moving</span><br><span class="line">the system.img mount to / for devices with a ramdisk.</span><br><span class="line"></span><br><span class="line">Note that in Android Q, system.img always contains TARGET_ROOT_OUT and always is mounted at / by the</span><br><span class="line">time first stage init finishes. Android Q will also require dynamic partitions and therefore will</span><br><span class="line">require using a ramdisk to boot Android. The recovery ramdisk can be used to boot to Android instead</span><br><span class="line">of a dedicated ramdisk as well.</span><br><span class="line"></span><br><span class="line">First stage init has three variations depending on the device configuration:</span><br><span class="line">1) For system-as-root devices, first stage init is part of /system/bin/init and a symlink at /init</span><br><span class="line">points to /system/bin/init for backwards compatibility. These devices do not need to do anything to</span><br><span class="line">mount system.img, since it is by definition already mounted as the rootfs by the kernel.</span><br><span class="line"></span><br><span class="line">2) For devices with a ramdisk, first stage init is a static executable located at /init. These</span><br><span class="line">devices mount system.img as /system then perform a switch root operation to move the mount at</span><br><span class="line">/system to /. The contents of the ramdisk are freed after mounting has completed.</span><br><span class="line"></span><br><span class="line">3) For devices that use recovery as a ramdisk, first stage init it contained within the shared init</span><br><span class="line">located at /init within the recovery ramdisk. These devices first switch root to</span><br><span class="line">/first_stage_ramdisk to remove the recovery components from the environment, then proceed the same</span><br><span class="line">as 2). Note that the decision to boot normally into Android instead of booting</span><br><span class="line">into recovery mode is made if androidboot.force_normal_boot=1 is present in the</span><br><span class="line">kernel commandline, or in bootconfig with Android S and later.</span><br><span class="line"></span><br><span class="line">Once first stage init finishes it execs /system/bin/init with the &quot;selinux_setup&quot; argument. This</span><br><span class="line">phase is where SELinux is optionally compiled and loaded onto the system. selinux.cpp contains more</span><br><span class="line">information on the specifics of this process.</span><br><span class="line"></span><br><span class="line">Lastly once that phase finishes, it execs /system/bin/init again with the &quot;second_stage&quot;</span><br><span class="line">argument. At this point the main phase of init runs and continues the boot process via the init.rc</span><br><span class="line">scripts.</span><br></pre></td></tr></table></figure>

<p>chatgpt译文：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br></pre></td><td class="code"><pre><span class="line">Android Init Language</span><br><span class="line">---------------------</span><br><span class="line"></span><br><span class="line">Android Init语言由五个宽泛的语句类别组成：Actions（动作）、Commands（命令）、Services（服务）、Options（选项）和</span><br><span class="line">Imports（导入）。</span><br><span class="line"></span><br><span class="line">所有这些语句以行为单位，由空格分隔的标记组成。可以使用C风格的反斜杠转义将空格插入标记中。双引号也可以用于防止空格破坏文本形成</span><br><span class="line">多个标记。当反斜杠是行末字符时，可以用于行折叠。</span><br><span class="line"></span><br><span class="line">以`#`开头的行（允许前置空格）是注释。</span><br><span class="line"></span><br><span class="line">可以使用`$&#123;property.name&#125;`的语法扩展系统属性。这在需要连接的上下文中也适用，例如`import /init.recovery.$&#123;ro.hardware&#125;.rc`。</span><br><span class="line"></span><br><span class="line">Actions和Services隐式声明了一个新的区块。所有的命令或选项都属于最近声明的区块。在第一个区块之前的命令或选项将被忽略。</span><br><span class="line"></span><br><span class="line">Services具有唯一的名称。如果定义了第二个名称与现有Service相同的Service，则会被忽略并记录错误消息。</span><br><span class="line"></span><br><span class="line">Init .rc文件</span><br><span class="line">--------------</span><br><span class="line"></span><br><span class="line">Init语言用于采用.rc文件扩展的纯文本文件中。通常在系统中有多个这样的文件，如下所述。</span><br><span class="line"></span><br><span class="line">`/system/etc/init/hw/init.rc`是主要的.rc文件，由init可执行文件在其启动时加载。它负责系统的初始设置。</span><br><span class="line"></span><br><span class="line">在加载主要的`/system/etc/init/hw/init.rc`之后，Init会立即加载`/&#123;system,system_ext,vendor,odm,product&#125;/etc/init/`目录</span><br><span class="line">中包含的所有文件。这在本文件的[Imports](#imports)部分中有更详细的解释。</span><br><span class="line"></span><br><span class="line">在Q之后启动的设备不再支持在mount_all期间导入init脚本。</span><br><span class="line"></span><br><span class="line">这些目录的目的是：</span><br><span class="line"></span><br><span class="line">   1. /system/etc/init/ 用于核心系统项，如SurfaceFlinger、MediaService和logd。</span><br><span class="line">   2. /vendor/etc/init/ 用于SoC供应商项，如用于核心SoC功能的动作或守护进程。</span><br><span class="line">   3. /odm/etc/init/ 用于设备制造商项，如用于运动传感器或其他外围设备功能的动作或守护进程。</span><br><span class="line"></span><br><span class="line">所有二进制文件位于系统、供应商或odm分区的服务应将其服务条目放置在相应的init .rc文件中，位于它们所在分区的/etc/init/目录中。</span><br><span class="line">开发人员可以使用构建系统宏LOCAL_INIT_RC来处理此问题。每个init .rc文件还应包含与其服务关联的任何操作。</span><br><span class="line"></span><br><span class="line">一个例子是位于system/core/logcat目录中的userdebug logcatd.rc和Android.mk文件。Android.mk文件中的LOCAL_INIT_RC宏在构建</span><br><span class="line">过程中将logcatd.rc放置在/system/etc/init/中。Init在执行mount_all命令时加载logcatd.rc，并在适当时运行服务和排队操作。</span><br><span class="line"></span><br><span class="line">将init .rc文件按照它们的守护进程进行拆分比以前使用的大型init .rc文件更可取。这种方法确保init读取的只有存在于文件系统上的二</span><br><span class="line">进制文件对应的服务条目，而在大型init .rc文件中并非如此。此外，当向系统添加多个服务时，这样分拆将有助于解决合并冲突，因为每个</span><br><span class="line">服务都将进入单独的文件。</span><br><span class="line"></span><br><span class="line">APEXs中的带版本的RC文件</span><br><span class="line">---------------------------</span><br><span class="line">随着在Android Q上的主线开始，各个主线模块在其范围内携带自己的init.rc文件。Init根据命名模式`/apex/*/etc/*rc`来处理这些文件。</span><br><span class="line"></span><br><span class="line">由于APEX模块必须在多个Android版本上运行，它们可能需要不同的参数作为其定义的服务的一部分。从Android T开始，通过在init文件名</span><br><span class="line">中加入SDK版本信息来实现。后缀从`.rc`变为`.#rc`，其中#是该RC文件被接受的第一个SDK版本。一个特定于SDK=31的init文件可以被命名</span><br><span class="line">为`init.31rc`。使用这种方案，一个APEX可以包含多个init文件。下面是一个示例。</span><br><span class="line"></span><br><span class="line">对于/apex/sample-module/apex/etc/目录下拥有以下文件的APEX模块：</span><br><span class="line"></span><br><span class="line">   1. init.rc</span><br><span class="line">   2. init.32rc</span><br><span class="line">   4. init.35rc</span><br><span class="line"></span><br><span class="line">选择规则选择不超过当前运行系统的SDK的最高`.#rc`值。不带后缀的`.rc`表示sdk=0。</span><br><span class="line"></span><br><span class="line">当此APEX安装在SDK &lt;=31的设备上时，系统会处理init.rc。当安装在运行SDK 32、33或34的设备上时，它将使用init.32rc。当安装在运</span><br><span class="line">行SDK &gt;= 35的设备上时，它将选择init.35rc。</span><br><span class="line"></span><br><span class="line">此版本方案仅适用于APEX模块中的init文件，不适用于存储在/system/etc/init、/vendor/etc/init或其他目录中的init文件。</span><br><span class="line"></span><br><span class="line">此命名方案在Android S之后提供。</span><br><span class="line"></span><br><span class="line">动作</span><br><span class="line">-------</span><br><span class="line">动作是命令的命名序列。动作有一个触发器，用于确定何时执行该动作。当发生与动作的触发器匹配的事件时，该动作将被添加到待执行队列</span><br><span class="line">的末尾（除非它已经在队列中）。</span><br><span class="line"></span><br><span class="line">队列中的每个动作都按顺序出队，并执行该动作中的每个命令。在执行活动命令期间，Init处理其他活动（设备创建/销毁、属性设置、进程</span><br><span class="line">重启）。</span><br><span class="line"></span><br><span class="line">动作的形式如下：</span><br><span class="line"></span><br><span class="line">    on &lt;trigger&gt; [&amp;&amp; &lt;trigger&gt;]*</span><br><span class="line">       &lt;command&gt;</span><br><span class="line">       &lt;command&gt;</span><br><span class="line">       &lt;command&gt;</span><br><span class="line"></span><br><span class="line">根据包含它们的文件的解析顺序（请参阅导入部分），动作按顺序添加到队列并执行，然后在单个文件内顺序执行。</span><br><span class="line"></span><br><span class="line">例如，如果一个文件包含：</span><br><span class="line"></span><br><span class="line">    on boot</span><br><span class="line">       setprop a 1</span><br><span class="line">       setprop b 2</span><br><span class="line"></span><br><span class="line">    on boot &amp;&amp; property:true=true</span><br><span class="line">       setprop c 1</span><br><span class="line">       setprop d 2</span><br><span class="line"></span><br><span class="line">    on boot</span><br><span class="line">       setprop e 1</span><br><span class="line">       setprop f 2</span><br><span class="line"></span><br><span class="line">那么当`boot`触发器发生并且假设属性`true`等于`true`时，执行命令的顺序将是：</span><br><span class="line"></span><br><span class="line">    setprop a 1</span><br><span class="line">    setprop b 2</span><br><span class="line">    setprop c 1</span><br><span class="line">    setprop d 2</span><br><span class="line">    setprop e 1</span><br><span class="line">    setprop f 2</span><br><span class="line">    </span><br><span class="line">    服务</span><br><span class="line">--------</span><br><span class="line">服务是在init启动和（可选地）重新启动时运行的程序。服务的形式如下：</span><br><span class="line"></span><br><span class="line">    service &lt;名称&gt; &lt;路径&gt; [ &lt;参数&gt; ]*</span><br><span class="line">       &lt;选项&gt;</span><br><span class="line">       &lt;选项&gt;</span><br><span class="line">       ...</span><br><span class="line">       </span><br><span class="line"> 选项</span><br><span class="line">--------</span><br><span class="line">选项是对服务的修改器。它们会影响到init运行服务的方式和时间。</span><br><span class="line"></span><br><span class="line">`capabilities [ &lt;capability&gt;\* ]`</span><br><span class="line">&gt; 在执行该服务时设置能力（capabilities）。&#x27;capability&#x27;应为一个Linux能力（capability），没有&quot;CAP_&quot;前缀，比如&quot;NET_ADMIN&quot;</span><br><span class="line">或&quot;SETPCAP&quot;。请参考http://man7.org/linux/man-pages/man7/capabilities.7.html 获取Linux能力的列表。</span><br><span class="line">  如果未提供任何能力，则该服务将被移除所有能力，即使它以root用户运行。</span><br><span class="line"></span><br><span class="line">`class &lt;name&gt; [ &lt;name&gt;\* ]`</span><br><span class="line">&gt; 为该服务指定类名（class names）。一个指定类的所有服务可以一起启动或停止。如果没有通过class选项指定类名，则该服务默认为</span><br><span class="line">&quot;default&quot;类。除了（必需的）第一个类名外，额外的类名用于分组服务。</span><br><span class="line">  &quot;animation&quot;类应包括所有启动动画和关机动画所需的服务。由于这些服务可以在启动过程的非常早期被启动，并且可能一直运行到关机</span><br><span class="line">  的最后阶段，因此不能保证可以访问/data分区。这些服务可以检查/data下的文件，但不能保持文件处于打开状态，且在/data不可用时应该正常工作。</span><br><span class="line"></span><br><span class="line">`console [&lt;console&gt;]`</span><br><span class="line">&gt; 该服务需要一个控制台。可选的第二个参数选择一个特定的控制台，而不使用默认规定的控制台。默认的&quot;/dev/console&quot;可以通过设置</span><br><span class="line">&quot;androidboot.console&quot;内核参数来更改。在所有情况下，应省略&quot;/dev/&quot;前缀，所以&quot;/dev/tty0&quot;可以指定为&quot;console tty0&quot;。</span><br><span class="line">  此选项将标准输入、标准输出和标准错误连接到控制台。它与stdio_to_kmsg选项互斥，后者只将标准输出和标准错误连接到kmsg。</span><br><span class="line"></span><br><span class="line">`critical [window=&lt;fatal crash window分钟&gt;] [target=&lt;fatal reboot目标&gt;]`</span><br><span class="line">&gt; 这是一个设备关键的服务。如果在_fatal crash window分钟_内它退出了超过四次，或者在启动完成之前退出，设备将重新启动到</span><br><span class="line">_fatal reboot目标_。</span><br><span class="line">  _fatal crash window分钟_的默认值为4，_fatal reboot目标_的默认值为&#x27;bootloader&#x27;。</span><br><span class="line">  可以通过将属性`init.svc_debug.no_fatal.&lt;service-name&gt;`设置为`true`来跳过对指定关键服务的致命重启，以进行测试。</span><br><span class="line">  </span><br><span class="line">  `disabled`</span><br><span class="line">&gt; 这个服务不会随其类一起自动启动。</span><br><span class="line">  必须通过名称或接口名称显式启动。</span><br><span class="line"></span><br><span class="line">`enter_namespace &lt;type&gt; &lt;path&gt;`</span><br><span class="line">&gt; 进入位于 _path_ 的 _type_ 类型的命名空间。仅支持网络命名空间，_type_ 设置为 &quot;net&quot;。请注意，每种 _type_ 类型只能进入一</span><br><span class="line">个命名空间。</span><br><span class="line"></span><br><span class="line">`file &lt;path&gt; &lt;type&gt;`</span><br><span class="line">&gt; 打开文件路径并将其文件描述符传递给启动的进程。_type_ 必须为</span><br><span class="line">  &quot;r&quot;、&quot;w&quot; 或 &quot;rw&quot;。对于原生可执行文件，请参阅 libcutils</span><br><span class="line">  android\_get\_control\_file()。</span><br><span class="line"></span><br><span class="line">`group &lt;groupname&gt; [ &lt;groupname&gt;\* ]`</span><br><span class="line">&gt; 在执行此服务之前切换到“groupname”。除了（必需的）第一个 groupname 之外的其他 groupname 用于设置进程的附加组（通过 </span><br><span class="line">	setgroups()）。</span><br><span class="line">  当前默认为 root。 （？？？应该默认为 nobody）</span><br><span class="line"></span><br><span class="line">`interface &lt;interface name&gt; &lt;instance name&gt;`</span><br><span class="line">&gt; 将此服务与其提供的一组 AIDL 或 HIDL 服务关联起来。接口名称必须是完全限定的名称而不是值名称。例如，这用于允许 servicemanager</span><br><span class="line">	或 hwservicemanager 惰性启动服务。</span><br><span class="line">  当提供多个接口时，此标记应多次使用。HIDL 接口的示例条目是 `interface vendor.foo.bar@1.0::IBaz default`。对于 AIDL 接口，</span><br><span class="line">  请使用`interface aidl &lt;instance name&gt;`。AIDL 接口的实例名称是</span><br><span class="line">  与 servicemanager 注册的实例名称一致，可以使用 `adb</span><br><span class="line">  shell dumpsys -l` 列出它们。</span><br><span class="line"></span><br><span class="line">`ioprio &lt;class&gt; &lt;priority&gt;`</span><br><span class="line">&gt; 通过 SYS_ioprio_set 系统调用设置此服务的 IO 优先级和 IO 优先级类。</span><br><span class="line">  _class_ 必须是 &quot;rt&quot;、&quot;be&quot; 或 &quot;idle&quot; 中的一个。_priority_ 必须是 0 - 7 范围内的整数。</span><br><span class="line"></span><br><span class="line">`keycodes &lt;keycode&gt; [ &lt;keycode&gt;\* ]`</span><br><span class="line">&gt; 设置触发该服务的按键代码。如果同时按下与传递的按键代码对应的所有按键，则服务将启动。这通常用于启动 bugreport 服务。</span><br><span class="line"></span><br><span class="line">&gt; 此选项可以接受属性而不是按键代码列表。在这种情况下，提供一个选项：按典型属性扩展格式的属性名。属性必须包含逗号分隔的按键代</span><br><span class="line">码值列表或文本 &#x27;none&#x27;，表示该服务不响应按键代码。</span><br><span class="line"></span><br><span class="line">&gt; 例如，`keycodes $&#123;some.property.name:-none&#125;`，其中 some.property.name 扩展</span><br><span class="line">  为 &quot;123,124,125&quot;。由于按键代码在 init 非常早期处理，</span><br><span class="line">  只能使用 PRODUCT_DEFAULT_PROPERTY_OVERRIDES 属性。</span><br><span class="line"></span><br><span class="line">`memcg.limit_in_bytes &lt;value&gt;` 和 `memcg.limit_percent &lt;value&gt;`</span><br><span class="line">&gt; 将子进程的 memory.limit_in_bytes 设置为 `limit_in_bytes`</span><br><span class="line">  字节和 `limit_percent` 中较小的一个，`limit_percent` 表示设备物理内存大小的百分比（仅在 memcg 挂载时）。</span><br><span class="line">  值必须大于等于 0。</span><br><span class="line"></span><br><span class="line">`memcg.limit_property &lt;value&gt;`</span><br><span class="line">&gt; 将子进程的 memory.limit_in_bytes 设置为指定属性的值（仅在 memcg 挂载时）。此属性将覆盖通过 `memcg.limit_in_bytes` </span><br><span class="line">和 `memcg.limit_percent` 指定的值。</span><br><span class="line"></span><br><span class="line">`memcg.soft_limit_in_bytes &lt;value&gt;`</span><br><span class="line">&gt; 将子进程的 memory.soft_limit_in_bytes 设置为指定值（仅在 memcg 挂载时），该值必须大于等于 0。</span><br><span class="line"></span><br><span class="line">`memcg.swappiness &lt;value&gt;`</span><br><span class="line">&gt; 将子进程的 memory.swappiness 设置为指定值（仅在 memcg 挂载时），该值必须大于等于 0。</span><br><span class="line"></span><br><span class="line">`namespace &lt;pid|mnt&gt;`</span><br><span class="line">&gt; 在 fork 服务时进入新的 PID 或挂载命名空间。</span><br><span class="line"></span><br><span class="line">`oneshot`</span><br><span class="line">&gt; 当服务退出时不重新启动。</span><br><span class="line"></span><br><span class="line">`onrestart`</span><br><span class="line">&gt; 在服务重新启动时执行命令（参见下文）。</span><br><span class="line"></span><br><span class="line">`oom_score_adjust &lt;value&gt;`</span><br><span class="line">&gt; 将子进程的 /proc/self/oom\_score\_adj 设置为指定值，</span><br><span class="line">  该值必须在 -1000 到 1000 范围内。</span><br><span class="line"></span><br><span class="line">`override`</span><br><span class="line">&gt; 表示此服务定义旨在覆盖先前定义的具有相同名称的服务。这通常用于在 /odm 上覆盖在 /vendor 上定义的服务。init 解析的具有此关</span><br><span class="line">	键字的最后一个服务定义将用于此服务。</span><br><span class="line">  请注意 init.rc 文件解析的顺序，因为出于向后兼容性原因，它具有一些特殊性。此文件的 &#x27;imports&#x27; 部分详细介绍了顺序。</span><br><span class="line"></span><br><span class="line">`priority &lt;priority&gt;`</span><br><span class="line">&gt; 服务进程的调度优先级。该值必须在</span><br><span class="line">  -20 到 19 的范围内。默认优先级为 0。优先级通过 setpriority() 设置。</span><br><span class="line">  </span><br><span class="line">  `reboot_on_failure &lt;目标&gt;`</span><br><span class="line">&gt; 如果该进程无法启动，或者进程以CLD_EXITED以外的退出代码或非0的状态码终止，则重新启动带有指定目标的系统。_target_ 的格式与</span><br><span class="line">sys.powerctl的参数相同。这主要用于在启动期间进行一些必要的检查。</span><br><span class="line"></span><br><span class="line">`restart_period &lt;秒数&gt;`</span><br><span class="line">&gt; 如果非一次性服务退出，则在其启动时间加上此持续时间后重新启动。默认为5秒，用于限制崩溃服务的速率。可以增加此值以适应定期运行</span><br><span class="line">的服务。例如，可以将其设置为3600表示服务应每小时运行一次，或者设置为86400表示服务应每天运行一次。</span><br><span class="line"></span><br><span class="line">`rlimit &lt;资源&gt; &lt;当前值&gt; &lt;最大值&gt;`</span><br><span class="line">&gt; 将给定的rlimit应用于服务。rlimit会被子进程继承，因此这实际上将给定的rlimit应用于由此服务启动的进程树。解析方式与下面的</span><br><span class="line">setrlimit命令类似。</span><br><span class="line"></span><br><span class="line">`seclabel &lt;安全标签&gt;`</span><br><span class="line">&gt; 在执行此服务之前切换到“seclabel”。主要用于从根文件系统运行的服务，例如ueventd、adbd。位于系统分区上的服务可以根据其文件</span><br><span class="line">安全上下文使用策略定义的转换代替。如果未指定，并且策略中未定义转换，则默认为init上下文。</span><br><span class="line"></span><br><span class="line">`setenv &lt;变量名&gt; &lt;值&gt;`</span><br><span class="line">&gt; 在启动的进程中将环境变量_name_设置为_value_。</span><br><span class="line"></span><br><span class="line">`shutdown &lt;关机行为&gt;`</span><br><span class="line">&gt; 设置服务进程的关机行为。如果未指定，则在关机过程中使用SIGTERM和SIGKILL终止服务。使用&quot;critical&quot;关机行为的服务在关机期间不</span><br><span class="line">会被终止，直到关机超时。当关机超时时，即使标记为&quot;shutdown critical&quot;的服务也会被终止。如果在关机开始时标记为</span><br><span class="line">&quot;shutdown critical&quot;的服务未运行，则会启动该服务。</span><br><span class="line"></span><br><span class="line">`sigstop`</span><br><span class="line">&gt; 在调用exec之前立即向服务发送SIGSTOP信号。这用于调试。关于如何使用该选项的更多信息，请参见下面有关调试的部分。</span><br><span class="line"></span><br><span class="line">`socket &lt;名称&gt; &lt;类型&gt; &lt;权限&gt; [ &lt;用户&gt; [ &lt;组&gt; [ &lt;安全标签&gt; ] ] ]`</span><br><span class="line">&gt; 创建名为/dev/socket/_name_的UNIX域套接字，并将其文件描述符传递给启动的进程。_type_必须是&quot;dgram&quot;、&quot;stream&quot;或&quot;seqpacket&quot;。</span><br><span class="line">_type_可以以&quot;+passcred&quot;结尾，以启用套接字上的SO_PASSCRED选项。用户和组默认为0。&#x27;seclabel&#x27;是套接字的SELinux安全上下文。它默</span><br><span class="line">认为服务的安全上下文，如seclabel中指定的，或根据服务可执行文件的安全上下文计算得出。对于原生可执行文件，请参见</span><br><span class="line">libcutils android\_get\_control\_socket()。</span><br><span class="line"></span><br><span class="line">`stdio_to_kmsg`</span><br><span class="line">&gt; 将stdout和stderr重定向到/dev/kmsg_debug。这对于在早期启动期间不使用本机Android日志记录且我们希望捕获其日志消息的服务非常</span><br><span class="line">有用。仅当启用/dev/kmsg_debug时，即仅在userdebug和eng构建上启用时，才会启用此功能。这与console选项互斥，console选项还会将</span><br><span class="line">stdin连接到给定的控制台。</span><br><span class="line"></span><br><span class="line">`task_profiles &lt;配置文件&gt; [ &lt;配置文件&gt;* ]`</span><br><span class="line">&gt; 在进程分叉时为进程设置任务配置文件。这旨在取代使用writepid选项将进程移动到cgroup的方法。</span><br><span class="line"></span><br><span class="line">`timeout_period &lt;秒数&gt;`</span><br><span class="line">&gt; 提供超时时间，在该时间之后，服务将被终止。在这里，将尊重oneshot关键字，因此一次性服务不会自动重新启动，但其他所有服务都会</span><br><span class="line">重新启动。这对于创建与上面描述的restart_period选项结合使用的周期性服务特别有用。</span><br><span class="line"></span><br><span class="line">`updatable`</span><br><span class="line">&gt; 标记服务可以后续被APEX覆盖（通过&#x27;override&#x27;选项）。具有可更新选项的服务在APEX全部激活之前启动时，执行将会延迟，直到激活完</span><br><span class="line">成。不标记为可更新的服务无法被APEX覆盖。</span><br><span class="line"></span><br><span class="line">`user &lt;用户名&gt;`</span><br><span class="line">&gt; 在执行此服务之前切换到&#x27;username&#x27;。当前默认为root。（？？？可能应默认为nobody）从Android M版本开始，即使进程需要Linux特</span><br><span class="line">权，也应使用此选项。以前，为了获取Linux特权，进程需要以root身份运行，请求特权，然后切换到所需的uid。这里有一种新的机制，通</span><br><span class="line">过fs\_config允许设备厂商向特定文件系统上的特定二进制文件添加Linux特权。该机制在</span><br><span class="line">&lt;http://source.android.com/devices/tech/config/filesystem.html&gt;上进行了描述。使用此新机制时，进程可以使用user选项选择其</span><br><span class="line">所需的uid，而无需以root身份运行。从Android O开始，进程还可以在其.rc文件中直接请求特权。参见下面的&quot;capabilities&quot;选项。</span><br><span class="line"></span><br><span class="line">`writepid &lt;文件&gt; [ &lt;文件&gt;* ]`</span><br><span class="line">&gt; 当进程分叉时，将子进程的pid写入给定的文件。用于cgroup/cpuset。如果未指定/dev/cpuset/下的文件，但系统属性</span><br><span class="line">&#x27;ro.cpuset.default&#x27;设置为非空的cpuset名称（例如&#x27;/foreground&#x27;），则pid将写入文件/dev/cpuset/_cpuset\_name_/tasks。</span><br><span class="line">对于将进程移动到cgroup，此选项的使用已过时。请改用task_profiles选项。</span><br><span class="line"></span><br><span class="line">触发器</span><br><span class="line">--------</span><br><span class="line">触发器是用来匹配特定类型事件并引发某个动作的字符串。</span><br><span class="line"></span><br><span class="line">触发器被分为事件触发器和属性触发器。</span><br><span class="line"></span><br><span class="line">事件触发器是由&#x27;trigger&#x27;命令或在init可执行文件中使用QueueEventTrigger()函数引发的字符串。它们采用简单的字符串形式，比</span><br><span class="line">如&#x27;boot&#x27;或&#x27;late-init&#x27;。</span><br><span class="line"></span><br><span class="line">属性触发器是在命名属性的值变为给定新值或命名属性的值变为任意新值时引发的字符串。它们采用&#x27;property:&lt;name&gt;=&lt;value&gt;&#x27;</span><br><span class="line">和&#x27;property:&lt;name&gt;=\*&#x27;的形式。在init的初始引导阶段，属性触发器还会进行评估并相应地引发。</span><br><span class="line"></span><br><span class="line">一个动作可以有多个属性触发器，但只能有一个事件触发器。</span><br><span class="line"></span><br><span class="line">例如：</span><br><span class="line">`on boot &amp;&amp; property:a=b`定义了一个只有在&#x27;boot&#x27;事件触发发生且属性a等于b时才执行的动作。</span><br><span class="line"></span><br><span class="line">`on property:a=b &amp;&amp; property:c=d`定义了一个在以下三种情况下执行的动作：</span><br><span class="line"></span><br><span class="line">   1. 在初始引导期间，如果属性a=b且属性c=d。</span><br><span class="line">   2. 每当属性a从其他值过渡到值b时，而属性c已经等于d。</span><br><span class="line">   3. 每当属性c从其他值过渡到值d时，而属性a已经等于b。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">触发器顺序</span><br><span class="line">----------------</span><br><span class="line"></span><br><span class="line">在早期引导过程中，init使用以下一系列触发器。这些是在init.cpp中定义的内置触发器。</span><br><span class="line"></span><br><span class="line">   1. `early-init` - 首个触发器，在cgroups被配置之后、ueventd的冷启动完成之前触发。</span><br><span class="line">   2. `init` - 冷启动完成后触发。</span><br><span class="line">   3. `charger` - 如果`ro.bootmode == &quot;charger&quot;`，则触发。</span><br><span class="line">   4. `late-init` - 如果`ro.bootmode != &quot;charger&quot;`，或者通过healthd从充电模式启动，则触发。</span><br><span class="line"></span><br><span class="line">剩余的触发器由`init.rc`中配置，并非内置的。这些触发器的默认顺序在`init.rc`的&quot;on late-init&quot;事件下指定。在`init.rc`内部的</span><br><span class="line">动作被省略。</span><br><span class="line"></span><br><span class="line">   1. `early-fs` - 启动vold。</span><br><span class="line">   2. `fs` - Vold已启动。将未标记为first-stage或latemounted的分区挂载。</span><br><span class="line">   3. `post-fs` - 配置任何依赖早期挂载的内容。</span><br><span class="line">   4. `late-fs` - 挂载被标记为latemounted的分区。</span><br><span class="line">   5. `post-fs-data` - 挂载和配置`/data`；设置加密。如果在第一阶段init中无法挂载`/metadata`，则在这里重新格式化。</span><br><span class="line">   6. `zygote-start` - 启动Zygote。</span><br><span class="line">   7. `early-boot` - 在Zygote启动后。</span><br><span class="line">   8. `boot` - 在`early-boot`动作完成后。</span><br><span class="line">   </span><br><span class="line">   命令</span><br><span class="line">----</span><br><span class="line"></span><br><span class="line">`bootchart [start|stop]`</span><br><span class="line">&gt; 启动/停止启动图表记录。这些命令在默认的init.rc文件中存在，但仅当文件/data/bootchart/enabled存在时，启动图表记录才会生</span><br><span class="line">效；否则，启动图表记录的start/stop命令不起作用。</span><br><span class="line"></span><br><span class="line">`chmod &lt;octal-mode&gt; &lt;path&gt;`</span><br><span class="line">&gt; 更改文件访问权限。</span><br><span class="line"></span><br><span class="line">`chown &lt;owner&gt; &lt;group&gt; &lt;path&gt;`</span><br><span class="line">&gt; 更改文件所有者和组。</span><br><span class="line"></span><br><span class="line">`class_start &lt;serviceclass&gt;`</span><br><span class="line">&gt; 如果指定类别的所有服务尚未运行，则启动它们。有关启动服务的更多信息，请参阅启动条目。</span><br><span class="line"></span><br><span class="line">`class_stop &lt;serviceclass&gt;`</span><br><span class="line">&gt; 如果指定类别的所有服务当前正在运行，则停止并禁用它们。</span><br><span class="line"></span><br><span class="line">`class_reset &lt;serviceclass&gt;`</span><br><span class="line">&gt; 如果指定类别的所有服务当前正在运行，则停止它们，但不禁用。稍后可以使用`class_start`命令重新启动它们。</span><br><span class="line"></span><br><span class="line">`class_restart [--only-enabled] &lt;serviceclass&gt;`</span><br><span class="line">&gt; 重新启动指定类别的所有服务。如果指定了`--only-enabled`选项，则跳过已禁用的服务。</span><br><span class="line"></span><br><span class="line">`copy &lt;src&gt; &lt;dst&gt;`</span><br><span class="line">&gt; 复制文件。与write类似，但适用于二进制/大量数据。关于src文件，不允许从符号链接文件和world-writable或group-writable文件</span><br><span class="line">复制。关于dst文件，如果文件不存在，则创建的默认模式是0600。如果dst文件是一个普通常规文件并且已经存在，则会被截断。</span><br><span class="line"></span><br><span class="line">`copy_per_line &lt;src&gt; &lt;dst&gt;`</span><br><span class="line">&gt; 逐行复制文件。与copy类似，但适用于dst是不能处理多行数据的sysfs节点。</span><br><span class="line"></span><br><span class="line">`domainname &lt;name&gt;`</span><br><span class="line">&gt; 设置域名。</span><br><span class="line"></span><br><span class="line">`enable &lt;servicename&gt;`</span><br><span class="line">&gt; 将禁用的服务变为启用状态，就好像该服务未指定禁用一样。</span><br><span class="line">  如果该服务应该在运行，则现在它将被启动。</span><br><span class="line">  通常在引导加载程序设置指定特定服务在需要时启动的变量时使用。例如：</span><br><span class="line"></span><br><span class="line">    on property:ro.boot.myfancyhardware=1</span><br><span class="line">        enable my_fancy_service_for_my_fancy_hardware</span><br><span class="line"></span><br><span class="line">`exec [ &lt;seclabel&gt; [ &lt;user&gt; [ &lt;group&gt;\* ] ] ] -- &lt;command&gt; [ &lt;argument&gt;\* ]`</span><br><span class="line">&gt; 分支并以给定的参数执行命令。命令在“--”之后开始，以便可以提供可选的安全上下文、用户和辅助组。在此命令完成之前，不会执行其他</span><br><span class="line">命令。_seclabel_可以是“-”表示默认值。属性会在_argument_中展开。</span><br><span class="line">  Init会等待分支的进程退出后再继续执行命令。</span><br><span class="line"></span><br><span class="line">`exec_background [ &lt;seclabel&gt; [ &lt;user&gt; [ &lt;group&gt;\* ] ] ] -- &lt;command&gt; [ &lt;argument&gt;\* ]`</span><br><span class="line">&gt; 分支并以给定的参数执行命令。这与“exec”命令类似处理。</span><br><span class="line">  不同之处在于，对于`exec_background`，init不会在该进程退出之前停止执行命令。</span><br><span class="line"></span><br><span class="line">`exec_start &lt;service&gt;`</span><br><span class="line">&gt; 启动给定的服务，并暂停处理其他init命令，直到该服务返回。该命令的功能类似于“exec”命令，但使用现有的服务定义替代exec参数向量。</span><br><span class="line"></span><br><span class="line">`export &lt;name&gt; &lt;value&gt;`</span><br><span class="line">&gt; 在全局环境中将环境变量_name_设置为_value_（该变量将被所有在执行此命令后启动的进程继承）</span><br><span class="line"></span><br><span class="line">`hostname &lt;name&gt;`</span><br><span class="line">&gt; 设置主机名。</span><br><span class="line"></span><br><span class="line">`ifup &lt;interface&gt;`</span><br><span class="line">&gt; 将网络接口_interface_上线。</span><br><span class="line"></span><br><span class="line">`insmod [-f] &lt;path&gt; [&lt;options&gt;]`</span><br><span class="line">&gt; 使用指定选项安装_path_处的模块。</span><br><span class="line">  -f: 强制安装模块，即使运行的内核版本和编译该模块的内核版本不匹配。</span><br><span class="line"></span><br><span class="line">`interface_start &lt;name&gt;`</span><br><span class="line">`interface_restart &lt;name&gt;`</span><br><span class="line">`interface_stop &lt;name&gt;`</span><br><span class="line">&gt; 查找提供接口_name_的服务（如果存在），并在其上分别运行`start`、`restart`或`stop`命令。_name_可以是完全限定的HIDL名称，</span><br><span class="line">格式为`&lt;interface&gt;/&lt;instance&gt;`，也可以是AIDL名称，格式为`aidl/&lt;interface&gt;`，例</span><br><span class="line">如`android.hardware.secure_element@1.1::ISecureElement/eSE1`或`aidl/aidl_lazy_test_1`。</span><br><span class="line"></span><br><span class="line">&gt; 注意，这些命令只作用于由`interface`服务选项指定的接口，而不作用于动态注册的接口。</span><br><span class="line"></span><br><span class="line">&gt; 这些命令的示例用法：\</span><br><span class="line">`interface_start android.hardware.secure_element@1.1::ISecureElement/eSE1`将启动</span><br><span class="line">提供`android.hardware.secure_element@1.1`和`eSI1`实例的HIDL服务。\</span><br><span class="line">`interface_start aidl/aidl_lazy_test_1`将启动提供`aidl_lazy_test_1`接口的AIDL服务。</span><br><span class="line"></span><br><span class="line">`load_exports &lt;path&gt;`</span><br><span class="line">&gt; 打开_path_处的文件，并导出其中声明的全局环境变量。每一行必须按照上述格式`export &lt;name&gt; &lt;value&gt;`。</span><br><span class="line"></span><br><span class="line">`load_system_props`</span><br><span class="line">&gt; （此操作已弃用，并且不会执行任何操作。）</span><br><span class="line"></span><br><span class="line">`load_persist_props`</span><br><span class="line">&gt; 在/data被解密后加载持久属性。</span><br><span class="line">  这在默认的init.rc中包含。</span><br><span class="line"></span><br><span class="line">`loglevel &lt;level&gt;`</span><br><span class="line">&gt; 将init的日志级别设置为整数级别，从7（所有日志）到0（仅致命日志）。数字值对应于内核日志级别，但此命令不会影响内核日志级别。</span><br><span class="line">使用`write`命令写入`/proc/sys/kernel/printk`以更改内核日志级别。属性在_level_中展开。</span><br><span class="line"></span><br><span class="line">`mark_post_data`</span><br><span class="line">&gt; 用于标记/data挂载后的点。</span><br><span class="line"></span><br><span class="line">`mkdir &lt;path&gt; [&lt;mode&gt;] [&lt;owner&gt;] [&lt;group&gt;] [encryption=&lt;action&gt;] [key=&lt;key&gt;]`</span><br><span class="line">&gt; 在_path_处创建目录，可选择使用给定的模式、所有者和组。如果未提供，目录将以权限755创建，并由root用户和root组拥有。如果提供</span><br><span class="line">了该参数，将在目录已存在时更新模式、所有者和组。</span><br><span class="line"></span><br><span class="line">&gt; _action_可以是以下之一：</span><br><span class="line">  * `None`：不采取加密操作；如果父目录已加密，则目录将被加密。</span><br><span class="line">  * `Require`：加密目录，如果加密失败，则中止引导过程。</span><br><span class="line">  * `Attempt`：尝试设置加密策略，如果失败继续执行。</span><br><span class="line">  * `DeleteIfNecessary`：递归删除必要的目录以设置加密策略。</span><br><span class="line"></span><br><span class="line">&gt; _key_可以是以下之一：</span><br><span class="line">  * `ref`：使用系统范围的DE密钥</span><br><span class="line">  * `per_boot_ref`：使用每次启动时新生成的密钥。</span><br><span class="line"></span><br><span class="line">`mount_all [ &lt;fstab&gt; ] [--&lt;option&gt;]`</span><br><span class="line">&gt; 在给定的fs\_mgr格式fstab上调用fs\_mgr\_mount\_all，可选使用选项&quot;early&quot;和&quot;late&quot;。</span><br><span class="line">  如果设置了“--early”，init可执行文件将跳过具有“latemount”标志的挂载条目，并触发fs加密状态事件。如果设置了“--late”，init</span><br><span class="line">  可执行文件将仅挂载具有“latemount”标志的条目。默认情况下，未设置选项，并且mount\_all将处理给定fstab中的所有条目。</span><br><span class="line">  如果未指定fstab参数，则在运行时将扫描fstab.$&#123;ro.boot.fstab_suffix&#125;、fstab.$&#123;ro.hardware&#125;</span><br><span class="line">  或fstab.$&#123;ro.hardware.platform&#125;，按照/odm/etc、/vendor/etc或/的顺序。</span><br><span class="line">  </span><br><span class="line">  `mount &lt;类型&gt; &lt;设备&gt; &lt;目录&gt; [ &lt;标志&gt;\*] [&lt;选项&gt;]`</span><br><span class="line">&gt; 尝试将指定的设备挂载到目录_dir_上。</span><br><span class="line">  _标志_包括&quot;ro&quot;、&quot;rw&quot;、&quot;remount&quot;、&quot;noatime&quot;，...</span><br><span class="line">  _选项_是一个逗号分隔的字符串，例如，barrier=1,noauto\_da\_alloc</span><br><span class="line"></span><br><span class="line">`perform_apex_config`</span><br><span class="line">&gt; 在APEX挂载后执行任务。例如，为已挂载的APEX创建数据目录、解析其配置文件，并更新链接器配置。仅在apexd将`apexd.status`设</span><br><span class="line">置为ready时通知挂载事件时使用。</span><br><span class="line"></span><br><span class="line">`restart [--only-if-running] &lt;服务&gt;`</span><br><span class="line">&gt; 停止并重启正在运行的服务，如果服务当前正在重新启动，则不执行任何操作，否则，仅启动服务。如果指定了&quot;--only-if-running&quot;，</span><br><span class="line">则只有在服务已经运行时才会重启服务。</span><br><span class="line"></span><br><span class="line">`restorecon &lt;路径&gt; [ &lt;路径&gt;\* ]`</span><br><span class="line">&gt; 将名为_path_的文件恢复为文件上指定的安全上下文中的状态。</span><br><span class="line">  对于由init.rc创建的目录不需要此操作，因为它们会自动进行正确的标记。</span><br><span class="line"></span><br><span class="line">`restorecon_recursive &lt;路径&gt; [ &lt;路径&gt;\* ]`</span><br><span class="line">&gt; 递归地将名为_path_的目录树恢复为文件上指定的安全上下文中的状态。</span><br><span class="line"></span><br><span class="line">`rm &lt;路径&gt;`</span><br><span class="line">&gt; 对给定路径调用unlink(2)。如果系统分区已经挂载，可能应该使用</span><br><span class="line">&quot;exec -- rm ...&quot; (provided the system partition is already mounted)。</span><br><span class="line"></span><br><span class="line">`rmdir &lt;路径&gt;`</span><br><span class="line">&gt; 对给定路径调用rmdir(2)。</span><br><span class="line"></span><br><span class="line">`readahead &lt;文件|目录&gt; [--fully]`</span><br><span class="line">&gt; 对给定的文件或指定目录中的文件调用readahead(2)。使用选项--fully以读取完整的文件内容。</span><br><span class="line"></span><br><span class="line">`setprop &lt;名称&gt; &lt;值&gt;`</span><br><span class="line">&gt; 将系统属性_name_的值设置为_value_。属性将在_value_中进行扩展。</span><br><span class="line"></span><br><span class="line">`setrlimit &lt;资源&gt; &lt;当前值&gt; &lt;最大值&gt;`</span><br><span class="line">&gt; 设置资源的rlimit。此设置将应用于在限制设置后启动的所有进程。它旨在在init早期进行设置，并应用于全局。</span><br><span class="line">  _资源_最好使用其文本表示（&#x27;cpu&#x27;、&#x27;rtio&#x27;等）或&#x27;RLIM_CPU&#x27;、&#x27;RLIM_RTIO&#x27;等表示。也可以将其指定为资源枚举对应的整数值。</span><br><span class="line">  _当前值_和_最大值_可以设置为&#x27;unlimited&#x27;或&#x27;-1&#x27;，表示无限制的rlimit。</span><br><span class="line">  </span><br><span class="line">  开始&lt;service&gt;</span><br><span class="line">通过启动服务来运行，如果服务尚未运行。</span><br><span class="line">请注意，这不是同步的，即使是同步的，也不能保证操作系统的调度程序会执行足够的次数来保证服务的状态。</span><br><span class="line">有关同步版本的&quot;start&quot;命令，请参阅&quot;exec_start&quot;命令。</span><br><span class="line"></span><br><span class="line">这带来了一个重要的结果，如果服务向其他服务提供功能，例如提供通信通道，那么仅仅在那些服务之前启动此服务是不足以保证在那些服务</span><br><span class="line">请求它之前已经建立了通道的。必须有一种单独的机制来做出任何这样的保证。</span><br><span class="line"></span><br><span class="line">停止&lt;service&gt;</span><br><span class="line">如果服务当前正在运行，则停止运行。</span><br><span class="line"></span><br><span class="line">swapon_all [&lt;fstab&gt;]</span><br><span class="line">在给定的fstab文件上调用fs_mgr_swapon_all命令。</span><br><span class="line">如果没有指定fstab参数，则会在/odm/etc、/vendor/etc或/根目录下以fstab.$&#123;ro.boot.fstab_suffix&#125;、fstab.$&#123;ro.hardware&#125;</span><br><span class="line">或fstab.$&#123;ro.hardware.platform&#125;的顺序进行扫描。</span><br><span class="line"></span><br><span class="line">symlink &lt;target&gt; &lt;path&gt;</span><br><span class="line">在路径_path_上创建一个带有值_target_的符号链接。</span><br><span class="line"></span><br><span class="line">sysclktz &lt;minutes_west_of_gmt&gt;</span><br><span class="line">设置系统时钟基准（如果系统时钟在GMT中嘀嗒，则为0）</span><br><span class="line"></span><br><span class="line">trigger &lt;event&gt;</span><br><span class="line">触发一个事件。用于将一个动作排队从另一个动作中执行。</span><br><span class="line"></span><br><span class="line">umount &lt;path&gt;</span><br><span class="line">卸载位于该路径的文件系统。</span><br><span class="line"></span><br><span class="line">umount_all [&lt;fstab&gt;]</span><br><span class="line">在给定的fstab文件上调用fs_mgr_umount_all命令。</span><br><span class="line">如果没有指定fstab参数，则会在/odm/etc、/vendor/etc或/根目录下以fstab.$&#123;ro.boot.fstab_suffix&#125;、fstab.$&#123;ro.hardware&#125;</span><br><span class="line">或fstab.$&#123;ro.hardware.platform&#125;的顺序进行扫描。</span><br><span class="line"></span><br><span class="line">verity_update_state</span><br><span class="line">用于更新dm-verity状态并设置由adb remount使用的partition._mount-point_.verified属性的内部实现细节，因为fs_mgr不能直接设</span><br><span class="line">置这些属性。这是自Android 12以来所需的，因为CtsNativeVerifiedBootTestCases将读取属性</span><br><span class="line">&quot;partition.$&#123;partition&#125;.verified.hash_alg&quot;以检查是否使用了sha1。有关更多详情，请参见https://r.android.com/1546980。</span><br><span class="line"></span><br><span class="line">wait &lt;path&gt; [&lt;timeout&gt;]</span><br><span class="line">轮询给定文件的存在，直到找到为止，或者超时已达到。如果未指定超时时间，默认为五秒。超时值可以是小数秒，以浮点数表示法指定。</span><br><span class="line"></span><br><span class="line">wait_for_prop &lt;name&gt; &lt;value&gt;</span><br><span class="line">等待系统属性_name_的值为_value_。_value_中的属性将被展开。如果属性_name_已经设置为_value_，则立即继续。</span><br><span class="line"></span><br><span class="line">write &lt;path&gt; &lt;content&gt;</span><br><span class="line">打开位于路径_path_的文件，并使用write(2)将字符串写入其中。</span><br><span class="line">如果文件不存在，则会创建文件。如果文件已存在，则会将其截断。_content_中的属性将被展开。</span><br><span class="line"></span><br><span class="line">导入</span><br><span class="line">-------</span><br><span class="line">`import &lt;路径&gt;`</span><br><span class="line">&gt; 解析一个init配置文件，扩展当前的配置。</span><br><span class="line">  如果`路径`是一个目录，则会解析目录中的每个文件作为配置文件。这是非递归的，嵌套目录不会被解析。</span><br><span class="line"></span><br><span class="line">import关键字不是一个命令，而是它自己的部分，即它不会作为一个动作的一部分发生，而是在解析文件时处理导入，并遵循以下逻辑。</span><br><span class="line"></span><br><span class="line">只有三种情况下，init可执行程序会导入.rc文件：</span><br><span class="line"></span><br><span class="line">   1. 当它在初始启动时导入`/system/etc/init/hw/init.rc`或由属性`ro.boot.init_rc`指示的脚本时。</span><br><span class="line">   2. 当它在导入`/system/etc/init/hw/init.rc`之后立即导入`/&#123;system,system_ext,vendor,odm,product&#125;/etc/init/`。</span><br><span class="line">   3. （不推荐使用）当它在mount_all期间导入/&#123;system,vendor,odm&#125;/etc/init/或.rc文件时，</span><br><span class="line">      不允许在Q之后启动的设备使用。</span><br><span class="line"></span><br><span class="line">文件的导入顺序因遗留原因而稍微复杂。以下是保证的：</span><br><span class="line"></span><br><span class="line">1. 首先，解析`/system/etc/init/hw/init.rc`，然后递归解析它的每个导入文件。</span><br><span class="line">2. `/system/etc/init/`的内容按字母顺序排序并顺序解析，每个文件解析后递归进行导入。</span><br><span class="line">3. 对`/system_ext/etc/init`，`/vendor/etc/init`，`/odm/etc/init`，`/product/etc/init`执行步骤2。</span><br><span class="line"></span><br><span class="line">下面的伪代码可以更清楚地解释这个问题：</span><br><span class="line"></span><br><span class="line">    fn Import(文件)</span><br><span class="line">      解析(文件)</span><br><span class="line">      for (导入 : 文件.导入)</span><br><span class="line">        导入(导入)</span><br><span class="line"></span><br><span class="line">    导入(/system/etc/init/hw/init.rc)</span><br><span class="line">    目录 = [/system/etc/init, /system_ext/etc/init, /vendor/etc/init, /odm/etc/init, /product/etc/init]</span><br><span class="line">    for (目录 : 目录)</span><br><span class="line">      文件 = &lt;按目录内容的字母顺序排序&gt;</span><br><span class="line">      for (文件 : 文件)</span><br><span class="line">        导入(文件)</span><br><span class="line"></span><br><span class="line">动作按照解析顺序执行。例如，在`/system/etc/init/hw/init.rc`中的`post-fs-data`动作总是按照它们在文件中出现的顺序执行。</span><br><span class="line">然后，按导入的顺序执行`/system/etc/init/hw/init.rc`的导入中的`post-fs-data`动作，依此类推。</span><br><span class="line"></span><br><span class="line">属性</span><br><span class="line">------</span><br><span class="line">Init提供以下属性的状态信息。</span><br><span class="line"></span><br><span class="line">`init.svc.&lt;名称&gt;`</span><br><span class="line">&gt; 一个命名服务的状态（&quot;stopped&quot;，&quot;stopping&quot;，&quot;running&quot;，&quot;restarting&quot;）</span><br><span class="line"></span><br><span class="line">`dev.mnt.dev.&lt;挂载点&gt;`，`dev.mnt.blk.&lt;挂载点&gt;`，`dev.mnt.rootdisk.&lt;挂载点&gt;`</span><br><span class="line">&gt; 与*挂载点*关联的块设备基本名称。</span><br><span class="line">  *挂载点*将/替换为.，如果引用根挂载点&quot;/&quot;，则使用&quot;/root&quot;。</span><br><span class="line">  `dev.mnt.dev.&lt;挂载点&gt;`表示附加到文件系统的块设备。</span><br><span class="line">    （例如，使用`$&#123;dev.mnt.dev.&lt;挂载点&gt;&#125;`/sys/fs/ext4/来访问）</span><br><span class="line"></span><br><span class="line">  `dev.mnt.blk.&lt;挂载点&gt;`表示上述块设备的磁盘分区。</span><br><span class="line">    （例如，使用`/sys/class/block/$&#123;dev.mnt.blk.&lt;挂载点&gt;&#125;`来访问）</span><br><span class="line"></span><br><span class="line">  `dev.mnt.rootdisk.&lt;挂载点&gt;`表示包含上述磁盘分区的根磁盘。</span><br><span class="line">    （例如，使用`/sys/class/block/$&#123;dev.mnt.rootdisk.&lt;挂载点&gt;&#125;/queue`来访问）</span><br><span class="line"></span><br><span class="line">Init会响应以`ctl.`开头的属性。这些属性的格式为`ctl.[&lt;target&gt;_]&lt;command&gt;`，系统属性的_value_将用作参数。</span><br><span class="line">_target_是可选的，指定_value_应与哪个服务选项匹配。_target_只有一个选项，即`interface`，表示_value_将引用服务提供的接口，</span><br><span class="line">而不是服务名称本身。</span><br><span class="line"></span><br><span class="line">例如：</span><br><span class="line"></span><br><span class="line">`SetProperty(&quot;ctl.start&quot;, &quot;logd&quot;)` 将在 `logd` 上运行 `start` 命令。</span><br><span class="line"></span><br><span class="line">`SetProperty(&quot;ctl.interface_start&quot;, &quot;aidl/aidl_lazy_test_1&quot;)` 将在公开 `aidl aidl_lazy_test_1` 接口的服务上运行</span><br><span class="line">`start` 命令。</span><br><span class="line"></span><br><span class="line">请注意，这些属性只是可设置的，当读取时它们没有值。</span><br><span class="line"></span><br><span class="line">以下是 _commands_。</span><br><span class="line"></span><br><span class="line">`start` \</span><br><span class="line">`restart` \</span><br><span class="line">`stop` \</span><br><span class="line">这等效于在由属性的 _value_ 指定的服务上使用 `start`、`restart` 和 `stop` 命令。</span><br><span class="line"></span><br><span class="line">`oneshot_on` 和 `oneshot_off` 将打开或关闭由属性的 _value_ 指定的服务的 _oneshot_ 标志。这特别适用于条件上懒加载硬件抽</span><br><span class="line">象层 (HAL) 的服务。当它们是懒加载 HAL 时，oneshot 必须开启，否则 oneshot 应该关闭。</span><br><span class="line"></span><br><span class="line">`sigstop_on` 和 `sigstop_off` 将打开或关闭由属性的 _value_ 指定的服务的 _sigstop_ 功能。有关此功能的更多详细信息，请参阅</span><br><span class="line">下面的 _Debugging init_ 部分。</span><br><span class="line"></span><br><span class="line">引导时间</span><br><span class="line">-----------</span><br><span class="line">Init 在系统属性中记录了一些引导时间信息。</span><br><span class="line"></span><br><span class="line">`ro.boottime.init`</span><br><span class="line">&gt; 使用 CLOCK_BOOTTIME 时钟以纳秒为单位记录的启动后阶段 init 开始的时间。</span><br><span class="line"></span><br><span class="line">`ro.boottime.init.first_stage`</span><br><span class="line">&gt; 运行第一阶段所需的时间，以纳秒为单位。</span><br><span class="line"></span><br><span class="line">`ro.boottime.init.selinux`</span><br><span class="line">&gt; 运行 SELinux 阶段所需的时间，以纳秒为单位。</span><br><span class="line"></span><br><span class="line">`ro.boottime.init.modules`</span><br><span class="line">&gt; 加载内核模块所需的时间，以毫秒为单位。</span><br><span class="line"></span><br><span class="line">`ro.boottime.init.cold_boot_wait`</span><br><span class="line">&gt; init 等待 ueventd 的冷启动阶段结束的时间，以毫秒为单位。</span><br><span class="line"></span><br><span class="line">`ro.boottime.&lt;service-name&gt;`</span><br><span class="line">&gt; 服务首次启动后的时间，以 CLOCK_BOOTTIME 时钟为单位，以纳秒表示。</span><br><span class="line"></span><br><span class="line">Bootcharting</span><br><span class="line">------------</span><br><span class="line">这个版本的init包含有执行“bootcharting”的代码：生成日志文件，可以在之后使用&lt;http://www.bootchart.org/&gt;提供的工具进行处理。</span><br><span class="line"></span><br><span class="line">在模拟器上，使用-bootchart _timeout_选项激活bootcharting功能，持续_timeout_秒。</span><br><span class="line"></span><br><span class="line">在设备上：</span><br><span class="line"></span><br><span class="line">    adb shell &#x27;touch /data/bootchart/enabled&#x27;</span><br><span class="line"></span><br><span class="line">完成数据收集后，请不要忘记删除此文件！</span><br><span class="line"></span><br><span class="line">日志文件将被写入到/data/bootchart/。提供了一个脚本来检索这些文件并创建一个可以与bootchart命令行工具一起使用的bootchart.tgz</span><br><span class="line">文件：</span><br><span class="line"></span><br><span class="line">    sudo apt-get install pybootchartgui</span><br><span class="line">    # grab-bootchart.sh使用$ANDROID_SERIAL。</span><br><span class="line">    $ANDROID_BUILD_TOP/system/core/init/grab-bootchart.sh</span><br><span class="line"></span><br><span class="line">需要注意的一点是，bootchart将显示init从0秒开始运行。您需要查看dmesg来确定内核实际上何时启动init。</span><br><span class="line"></span><br><span class="line">比较两个bootchart</span><br><span class="line">------------------------</span><br><span class="line">一个方便的脚本名为compare-bootcharts.py用于比较所选进程的开始/结束时间。上述的grab-bootchart.sh将</span><br><span class="line">在/tmp/android-bootchart下留下一个名为bootchart.tgz的bootchart tarball。如果在主机上的不同目录下保存了两个这</span><br><span class="line">样的tarballs，脚本可以列出时间戳的差异。例如：</span><br><span class="line"></span><br><span class="line">用法：system/core/init/compare-bootcharts.py _base-bootchart-dir_ _exp-bootchart-dir_</span><br><span class="line"></span><br><span class="line">    进程：基准 实验 (增量) - 单位为ms（系统上的jiffy是10ms）</span><br><span class="line">    ------------------------------------</span><br><span class="line">    /init: 50 40 (-10)</span><br><span class="line">    /system/bin/surfaceflinger: 4320 4470 (+150)</span><br><span class="line">    /system/bin/bootanimation: 6980 6990 (+10)</span><br><span class="line">    zygote64: 10410 10640 (+230)</span><br><span class="line">    zygote: 10410 10640 (+230)</span><br><span class="line">    system_server: 15350 15150 (-200)</span><br><span class="line">    bootanimation ends at: 33790 31230 (-2560)</span><br><span class="line"></span><br><span class="line">Systrace</span><br><span class="line">--------</span><br><span class="line">在userdebug或eng构建上，可以使用Systrace (&lt;http://developer.android.com/tools/help/systrace.html&gt;) 获取在启动过程中</span><br><span class="line">的性能分析报告。</span><br><span class="line"></span><br><span class="line">以下是“wm”和“am”类别的示例跟踪事件：</span><br><span class="line"></span><br><span class="line">    $ANDROID_BUILD_TOP/external/chromium-trace/systrace.py \</span><br><span class="line">          wm am --boot</span><br><span class="line"></span><br><span class="line">该命令将导致设备重新启动。设备重新启动并完成启动顺序后，通过按Ctrl+C从设备获取跟踪报告，并将其作为trace.html写入主机。</span><br><span class="line"></span><br><span class="line">限制：记录跟踪事件是在加载持久属性之后开始的，因此不记录在那之前发出的跟踪事件。一些服务，如vold、surfaceflinger和</span><br><span class="line">servicemanager受到此限制的影响，因为它们在加载持久属性之前启动。Zygote初始化和从Zygote派生的进程不受影响。</span><br><span class="line"></span><br><span class="line">调试初始化</span><br><span class="line">--------------</span><br><span class="line">当一个服务从init启动时，可能会无法`execv()`该服务。这种情况并不常见，可能是由于新服务启动时链接器发生错误引起的。Android中的</span><br><span class="line">链接器将其日志打印到`logd`和`stderr`中，因此它们可以在`logcat`中看到。如果在访问`logcat`之前遇到错误，可以使</span><br><span class="line">用`stdio_to_kmsg`服务选项将链接器打印到`stderr`中的日志导向到`kmsg`，然后可以通过串口读取这些日志。</span><br><span class="line"></span><br><span class="line">不建议在没有init的情况下启动init服务，因为init设置了大量环境（用户、组、安全标签、能力等），很难手动复制。</span><br><span class="line"></span><br><span class="line">如果需要从服务的起始位置开始调试，可以添加`sigstop`服务选项。该选项将在调用exec之前立即发送SIGSTOP给服务。在继续使用SIGCONT</span><br><span class="line">继续服务之前，开发者可以通过附加调试器、strace等进行调试。</span><br><span class="line"></span><br><span class="line">该标志也可以通过ctl.sigstop_on和ctl.sigstop_off属性动态控制。</span><br><span class="line"></span><br><span class="line">以下是通过上述方法动态调试logd的示例：</span><br><span class="line"></span><br><span class="line">    stop logd</span><br><span class="line">    setprop ctl.sigstop_on logd</span><br><span class="line">    start logd</span><br><span class="line">    ps -e | grep logd</span><br><span class="line">    &gt; logd          4343     1   18156   1684 do_signal_stop 538280 T init</span><br><span class="line">    gdbclient.py -p 4343</span><br><span class="line">    b main</span><br><span class="line">    c</span><br><span class="line">    c</span><br><span class="line">    c</span><br><span class="line">    &gt; Breakpoint 1, main (argc=1, argv=0x7ff8c9a488) at system/core/logd/main.cpp:427</span><br><span class="line"></span><br><span class="line">以下是使用strace进行相同操作的示例：</span><br><span class="line"></span><br><span class="line">    stop logd</span><br><span class="line">    setprop ctl.sigstop_on logd</span><br><span class="line">    start logd</span><br><span class="line">    ps -e | grep logd</span><br><span class="line">    &gt; logd          4343     1   18156   1684 do_signal_stop 538280 T init</span><br><span class="line">    strace -p 4343</span><br><span class="line"></span><br><span class="line">    （从另一个Shell执行）</span><br><span class="line">    kill -SIGCONT 4343</span><br><span class="line"></span><br><span class="line">    &gt; strace运行</span><br><span class="line"></span><br><span class="line">主机Init脚本验证</span><br><span class="line">-----------------------------</span><br><span class="line">在构建时会检查Init脚本的正确性。具体检查如下所示。</span><br><span class="line"></span><br><span class="line">1) 格式良好的action、service和import部分，例如没有在&#x27;import&#x27;语句之后多余的行，没有在&#x27;on&#x27;行之前的动作。</span><br><span class="line">2) 所有命令都映射到有效的关键词，并且参数计数在正确范围内。</span><br><span class="line">3) 所有服务选项都是有效的。这比命令检查更严格，因为服务选项的参数会完全解析，例如需要解析UID和GID。</span><br><span class="line"></span><br><span class="line">还有一些Init脚本的其他部分是仅在运行时解析的，因此在构建时不会进行检查，其中包括以下内容。</span><br><span class="line"></span><br><span class="line">1) 命令的参数的有效性，例如不会检查文件路径是否存在，SELinux是否允许操作，以及UID和GID是否可解析。</span><br><span class="line">2) 不会检查服务是否存在或是否定义了有效的SELinux域。</span><br><span class="line">3) 不会检查服务是否在其他Init脚本中已经定义。</span><br><span class="line"></span><br><span class="line">早期Init引导顺序</span><br><span class="line">------------------------</span><br><span class="line">早期Init引导顺序分为三个阶段：第一阶段init、SELinux设置、第二阶段init。</span><br><span class="line"></span><br><span class="line">第一阶段init负责设置加载系统的最低要求。具体包括挂载/dev、/proc，挂载&#x27;early mount&#x27;分区（需要包括包含系统代码的所有分区，</span><br><span class="line">例如system和vendor），并将system.img挂载到/（对于使用ramdisk的设备）。</span><br><span class="line"></span><br><span class="line">需要注意的是，在Android Q中，system.img始终包含TARGET_ROOT_OUT，并且总是在第一阶段init完成时挂载到/。Android Q还需要动态</span><br><span class="line">分区，因此需要使用ramdisk引导Android。还可以使用恢复ramdisk来引导到Android，而不是使用专用的ramdisk。</span><br><span class="line"></span><br><span class="line">根据设备配置的不同，第一阶段init有三个变种：</span><br><span class="line">1) 对于system-as-root设备，第一阶段init是/system/bin/init的一部分，而/init是一个指向/system/bin/init的符号链接，以向后兼</span><br><span class="line">容。这些设备不需要执行任何操作来挂载system.img，因为根据定义，它已经被内核作为根文件系统挂载。</span><br><span class="line"></span><br><span class="line">2) 对于具有ramdisk的设备，第一阶段init是位于/init的静态可执行文件。这些设备将system.img挂载为/system，然后通过切换根操作将</span><br><span class="line">挂载点从/system移动到/。挂载完成后，ramdisk的内容被释放。</span><br><span class="line"></span><br><span class="line">3) 对于使用恢复模式作为ramdisk的设备，在恢复ramdisk中的/shared init中包含了第一阶段init。这些设备首先切换根目录到</span><br><span class="line">/first_stage_ramdisk，以从环境中删除恢复组件，然后像第二种情况一样继续处理。注意，决定正常启动到Android而不是启动到恢复模</span><br><span class="line">式时，是通过内核命令行中是否存在androidboot.force_normal_boot=1或在Android S及更高版本中的bootconfig中指定。</span><br><span class="line"></span><br><span class="line">第一阶段init完成后，它会使用&quot;selinux_setup&quot;参数执行/system/bin/init。此阶段是可选地编译和加载SELinux到系统上。有关此过程</span><br><span class="line">的详细信息，请参阅selinux.cpp。</span><br><span class="line"></span><br><span class="line">最后，一旦该阶段完成，它会再次使用&quot;second_stage&quot;参数执行/system/bin/init。此时，主要的init阶段运行，并通过init.rc脚本继续</span><br><span class="line">引导过程。</span><br><span class="line"></span><br></pre></td></tr></table></figure>


            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <article id="post-Android进阶/NDK/蒋超大佬扫盲/10.线程" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/">NDK</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/">蒋超大佬扫盲</a>
    </div>

                        
                        
  



                        
                        
                    </div>
                
                
   

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <p><strong>一. 什么是线程？</strong></p>
<p>这个基本不用多说了吧，学过编程的都知道，但还是简单介绍以下。线程是CPU调度的最小单位，被包含在进程之中，拥有自己的栈空间，和进程共享堆等其他资源，所以在多线程环境中存在线程同步，互斥等问题。</p>
<p><strong>小知识点</strong></p>
<p>其实在Linux中，新建的线程并不是在原先的进程中，而是系统通过一个系统调用clone( )。该系统调用copy了一个和原先进程完全一样的进程，并在这个进程中执行线程函数。不过这个copy过程和fork不一样。 copy后的进程和原先的进程共享了所有的变量，运行环境。这样，原先进程中的变量变动在copy后的进程中便能体现出来。</p>
<p> <strong>提示</strong></p>
<p>本次课程使用ubuntu 环境 、vim编辑器</p>
<p>编译命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">man xx linux方法使用说明</span></span><br><span class="line">man pthread_create</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">编译c文件  编译线程加-lpthread</span></span><br><span class="line">gcc xxx.c -lpthread</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行</span></span><br><span class="line">./a.out</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">strerror(xx)将错误码翻译成字符串</span></span><br><span class="line">strerror(ret)or(xx)</span><br></pre></td></tr></table></figure>

<p> <strong>二. 线程的创建函数pthread_create</strong></p>
<p>用于创建一个线程，对应进程中就是fork函数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#man xx linux查询xx方法使用说明</span></span><br><span class="line">man pthread_create</span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">pthread_create</span><span class="params">(<span class="type">pthread_t</span> *tidp,<span class="type">const</span> <span class="type">pthread_attr_t</span> *attr, <span class="type">void</span> *(*start_rtn)(<span class="type">void</span>*),<span class="type">void</span> *arg)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 若线程创建成功，则返回0。若线程创建失败，则返回出错编号，并且*thread中的内容是未定义的。</span></span><br><span class="line"><span class="comment">// 返回成功时，由tidp指向的内存单元被设置为新创建线程的线程ID.attr参数用于指定各种不同的线程属性。新创建的线程从start_rtn函</span></span><br><span class="line"><span class="comment">//数的地址开始运行，该函数只有一个万能指针参数arg，如果需要向start_rtn函数传递的参数不止一个，那么需要把这些参数放到一个结构</span></span><br><span class="line"><span class="comment">//中，然后把这个结构的地址作为arg的参数传入。</span></span><br><span class="line"><span class="comment">// 失败返回errno</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数</span></span><br><span class="line"><span class="comment">// 第一个参数为指向线程标识符的指针。</span></span><br><span class="line"><span class="comment">// 第二个参数用来设置线程属性。</span></span><br><span class="line"><span class="comment">// 第三个参数是线程运行函数的起始地址。</span></span><br><span class="line"><span class="comment">// 最后一个参数是运行函数的参数。</span></span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> *<span class="title function_">func</span><span class="params">(<span class="type">void</span> *arg)</span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;func------------------\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line">    <span class="type">int</span> ret = pthread_create(&amp;tid, <span class="literal">NULL</span>, func, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)&#123;</span><br><span class="line">      <span class="comment">//fprintf打印</span></span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_create error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">      <span class="comment">//不加休眠就直接运行结束了，不会显示打印的日志                                                                                    </span></span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;   </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>三. 线程ID获取函数pthread_self</strong></p>
<p>进程有进程ID，用getpid()。线程同样也有线程ID，对应的函数就是pthread_self函数,用来获取当前线程ID</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="comment">// 返回值：成功线程ID；失败:其他</span></span><br><span class="line"><span class="type">pthread_t</span> <span class="title function_">pthread_self</span><span class="params">()</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">func</span><span class="params">(<span class="type">void</span> *arg)</span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;child pthread: pid = %d tid = %ld\n&quot;</span>, getpid(), pthread_self());</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;func------------------\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line">    <span class="type">int</span> ret = pthread_create(&amp;tid, <span class="literal">NULL</span>, func, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_create error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;main thread: pid = %d   tid = %ld\n&quot;</span>, getpid(), pthread_self());</span><br><span class="line"></span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;                                                                                             </span><br><span class="line">&#125;   </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>四. 线程退出函数pthread_exit函数</strong></p>
<p>线程通过调用pthread_exit函数终止执行，就如同进程在结束时调用exit函数一样。这个函数的作用是，终止调用它的线程并返回一个指向某个对象的指针。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">pthread_exit</span><span class="params">(<span class="type">void</span>* retval)</span>;</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">testxxx</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;need exit.............  [%s][%d] \n&quot;</span>, __func__, __LINE__);</span><br><span class="line">    pthread_exit((<span class="type">void</span> *)<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">test_return</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;need exit ...........................[%s][%d]\n&quot;</span>, __func__, __LINE__);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">func</span><span class="params">(<span class="type">void</span> *arg)</span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;child pthread: pid = %d tid = %ld\n&quot;</span>, getpid(), pthread_self());</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;func------------------\n&quot;</span>);</span><br><span class="line">    test_return();</span><br><span class="line">    testxxx();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line">    <span class="type">int</span> ret = pthread_create(&amp;tid, <span class="literal">NULL</span>, func, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_create error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;main thread: pid = %d   tid = %ld\n&quot;</span>, getpid(), pthread_self());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sleep(3);</span></span><br><span class="line"></span><br><span class="line">    pthread_exit((<span class="type">void</span> *)<span class="number">0</span>);                                                                    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;                                                                 </span><br></pre></td></tr></table></figure>

<p><strong>五. pthread_join函数</strong></p>
<p>等待线程的结束，线程间同步的操作。以阻塞的方式等待thread指定的线程结束。当函数返回时，被等待线程的资源被收回。如果线程已经结束，那么该函数会立即返回。并且thread指定的线程必须是joinable的。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">int</span> <span class="title function_">pthread_join</span><span class="params">(<span class="type">pthread_t</span> thread, <span class="type">void</span> **retval)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数 ：thread: 线程标识符，即线程ID，标识唯一线程。</span></span><br><span class="line"><span class="comment">// retval: 用户定义的指针，用来存储被等待线程的返回值。</span></span><br><span class="line"><span class="comment">// 返回值 ： 0代表成功。 失败，返回的则是errno。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">testxxx</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;need exit.............  [%s][%d] \n&quot;</span>, __func__, __LINE__);</span><br><span class="line">    pthread_exit((<span class="type">void</span> *)<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">test_return</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;need exit ...........................[%s][%d]\n&quot;</span>, __func__, __LINE__);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">func</span><span class="params">(<span class="type">void</span> *arg)</span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;child pthread: pid = %d tid = %ld\n&quot;</span>, getpid(), pthread_self());</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;func------------------\n&quot;</span>);</span><br><span class="line">    test_return();</span><br><span class="line">    testxxx();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line">    <span class="type">int</span> ret = pthread_create(&amp;tid, <span class="literal">NULL</span>, func, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_create error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;main thread: pid = %d   tid = %ld\n&quot;</span>, getpid(), pthread_self());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sleep(3);</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> r;</span><br><span class="line">    ret = pthread_join(tid, &amp;r);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != ret)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_join error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;r = %d\n&quot;</span>, (<span class="type">int</span>)r);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;main end\n&quot;</span>);                                                                          </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>六. pthread_cancel函数</strong></p>
<p>终止一个线程</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">pthread_cancel</span><span class="params">(<span class="type">pthread_t</span> thread)</span>;</span><br><span class="line"><span class="comment">// 参数：线程标识符，即线程ID，标识唯一线程。</span></span><br><span class="line"><span class="comment">// 返回值：0代表成功。 失败，返回的则是errno。</span></span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">func</span><span class="params">(<span class="type">void</span> *arg)</span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;child pthread: pid = %d tid = %ld\n&quot;</span>, getpid(), pthread_self());</span><br><span class="line"></span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">fun_1</span><span class="params">(<span class="type">void</span> *arg)</span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        pthread_testcancel();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">void</span> *)<span class="number">111</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> *argv[])</span>                                                            </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line"><span class="comment">// int ret = pthread_create(&amp;tid, NULL, func, NULL);</span></span><br><span class="line">    <span class="type">int</span> ret = pthread_create(&amp;tid, <span class="literal">NULL</span>, fun_1, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_create error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;   </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;main thread: pid = %d   tid = %ld\n&quot;</span>, getpid(), pthread_self());</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    ret = pthread_cancel(tid);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != ret)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_cancel error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">    &#125;   </span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> r;</span><br><span class="line">    ret = pthread_join(tid, &amp;r);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != ret)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_join error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;r = %d\n&quot;</span>, r);</span><br><span class="line">    &#125;   </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;main end\n&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<p><strong>小提示</strong></p>
<p>必须要有系统调用，线程必须到达一个取消点才可以杀死线程。可以主动添加一个取消点：pthread_testcancel();</p>
<p><strong>七. pthread_detach函数</strong></p>
<p>线程分离函数，线程结束后，直接自动释放，不用主动回收。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">pthread_detach</span><span class="params">(<span class="type">pthread_t</span> thread)</span>;</span><br><span class="line"><span class="comment">// 参数：线程标识符，即线程ID，标识唯一线程。</span></span><br><span class="line"><span class="comment">// 返回值：0代表成功。 失败，返回的则是errno。</span></span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">func</span><span class="params">(<span class="type">void</span> *arg)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (count == <span class="number">10</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;-----------------------------------\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;child pthread: pid = %d tid = %ld\n&quot;</span>, getpid(), pthread_self());</span><br><span class="line"></span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        count ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line">    <span class="type">int</span> ret = pthread_create(&amp;tid, <span class="literal">NULL</span>, func, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_create error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ret = pthread_detach(tid);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_detach error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ret = pthread_join(tid, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_join error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;main thread: pid = %d   tid = %ld\n&quot;</span>, getpid(), pthread_self());</span><br><span class="line"></span><br><span class="line">    pthread_exit((<span class="type">void</span> *)<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;                                                                                                     </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>八. 线程属性pthread_attr_t</strong></p>
<p>做简单了解：通过线程属性设置线程分离</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">	<span class="type">int</span>                        etachstate;            <span class="comment">// 线程的分离状态</span></span><br><span class="line">	<span class="type">int</span>                        schedpolicy;           <span class="comment">// 线程的调度策略</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sched_param</span>         <span class="title">schedparam</span>;</span>            <span class="comment">// 线程的调度参数</span></span><br><span class="line">	<span class="type">int</span>                        inheritsched;          <span class="comment">// 线程的继承性</span></span><br><span class="line">	<span class="type">int</span>                        scope;                 <span class="comment">// 线程的作用域</span></span><br><span class="line">	<span class="type">size_t</span>                     guardsize;             <span class="comment">// 线程栈末尾的警戒缓冲区大小</span></span><br><span class="line">	<span class="type">int</span>                        stackaddr_set;         <span class="comment">// 线程的栈设置</span></span><br><span class="line">	<span class="type">void</span> *                     stackaddr;             <span class="comment">// 线程栈的位置</span></span><br><span class="line">	<span class="type">size_t</span>                     stacksize;             <span class="comment">// 线程栈大小</span></span><br><span class="line">&#125;<span class="type">pthread_attr_t</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 线程属性初始化: 成功：0  失败：errno</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">pthread_attr_init</span><span class="params">(<span class="type">pthread_attr_t</span> *attr)</span>;</span><br><span class="line"><span class="comment">// 销毁线程属性所占用的资源: 成功0  失败：errno</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">pthread_attr_destroy</span><span class="params">(<span class="type">pthread_attr_t</span> *attr)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置线程属性：是否分离</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">pthread_attr_setdetachstate</span><span class="params">(<span class="type">pthread_attr_t</span> *attr, <span class="type">int</span> detachstate)</span>;</span><br><span class="line"><span class="comment">// 获取线程属性：是否分离</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">pthread_attr_getdetachstate</span><span class="params">(<span class="type">pthread_attr_t</span> *attr, <span class="type">int</span> *detachstate)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// detachstate:</span></span><br><span class="line"><span class="comment">// PTHREAD_CREATE_DETACHED: 分离线程</span></span><br><span class="line"><span class="comment">// PTHREAD_CREATE_JOINABLE： 非分离线程</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">func</span><span class="params">(<span class="type">void</span> *arg)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (count == <span class="number">10</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;-----------------------------------\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;child pthread: pid = %d tid = %ld\n&quot;</span>, getpid(), pthread_self());</span><br><span class="line"></span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        count ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret;</span><br><span class="line">    <span class="type">pthread_attr_t</span> attr;</span><br><span class="line">    ret = pthread_attr_init(&amp;attr);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_attr_init error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ret = pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_DETACHED);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_attr_setdetachstate error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ret = pthread_create(&amp;tid, &amp;attr, func, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_create error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ret = pthread_detach(tid);                                                                 </span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_detach error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ret = pthread_join(tid, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pthread_join error: %s\n&quot;</span>, strerror(ret));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;main thread: pid = %d   tid = %ld\n&quot;</span>, getpid(), pthread_self());</span><br><span class="line"></span><br><span class="line">    pthread_exit((<span class="type">void</span> *)<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">                                                                                               </span><br></pre></td></tr></table></figure>




            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <article id="post-Android进阶/NDK/Android进阶之旅/20.jni方法大全及使用示例" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/">NDK</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/Android%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%97%85/">Android进阶之旅</a>
    </div>

                        
                        
  



                        
                        
                    </div>
                
                
   

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <p><strong>一、说明</strong><br>这里介绍的函数大多是 NDK 开发中常用的函数，但并不是全部，内容稍多，基本可以满足我们的开发需求了，建议通过目录索引来找需要了解的。<br>这里的函数都是 JNIEnv 操作的相关函数，JNI_OnLoad 等 JavaVM 的方法不在这里介绍。<br>JNI 有 C、C++ 两种代码风格，即：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C风格：(*env)-&gt;NewStringUTF(env, &quot;Hellow World!&quot;);</span><br><span class="line">C++风格：env-&gt;NewStringUTF(&quot;Hellow World!&quot;);</span><br></pre></td></tr></table></figure>

<p>这里我们使用 C++ 风格作为示例。</p>
<p><strong>二、获取版本</strong></p>
<ol>
<li>jint GetVersion()<br>说明：获取当前 JNI 的版本号<br>返回值：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#define JNI_VERSION_1_1 0x00010001</span><br><span class="line">#define JNI_VERSION_1_2 0x00010002</span><br><span class="line">#define JNI_VERSION_1_4 0x00010004</span><br><span class="line">#define JNI_VERSION_1_6 0x00010006</span><br></pre></td></tr></table></figure>

<p><strong>三、类操作</strong></p>
<ol>
<li><code>jclass FindClass(const char* name)</code><br>说明：根据类的全路径找到相应的 jclass 对象<br>参数：</li>
</ol>
<ul>
<li>name：类的全路径，例如 “Ljava&#x2F;lang&#x2F;String;”<br>示例：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jclass mStringClass = env-&gt;FindClass(&quot;Ljava/lang/String;&quot;);</span><br></pre></td></tr></table></figure>


<ol start="2">
<li><code>jclass GetSuperclass(jclass clazz)</code><br>说明：返回一个类的父类，如果 clazz 是 Object 类，没有父类，那么将返回 NULL<br>参数：</li>
</ol>
<ul>
<li>jclazz：当前类对象<br>示例：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jclass clazz = env-&gt;GetSuperclass(mStringClass); // clazz is Ljava/lang/Object;</span><br></pre></td></tr></table></figure>


<ol start="3">
<li><code>jboolean IsAssignableFrom(jclass clazz1, jclass clazz2)</code><br>说明：判断类1是否可以安全的强制转换类2<br>参数：</li>
</ol>
<ul>
<li>clazz1：类1</li>
<li>clazz2：类2</li>
</ul>
<p><strong>四、对象操作</strong></p>
<ol>
<li><code>jobject AllocObject(jclass clazz)</code><br>说明：不调用构造方法创建实例<br>参数：</li>
</ol>
<ul>
<li>clazz：指定对象的类</li>
</ul>
<ol start="2">
<li><code>jobject NewObject(jclass clazz, jmethodID methodID, …)</code></li>
<li><code>jobject NewObjectA(jclass clazz, jmethodID methodID, jvalue* args)</code></li>
<li><code>jobject NewObjectV(jclass clazz, jmethodID methodID, va_list args)</code><br>说明：使用指定的构造方法创建类的实例，唯一不同的是输入参数的传入形式不同<br>参数：</li>
</ol>
<ul>
<li><p>clazz：指定对象的类</p>
</li>
<li><p>methodID：指定的构造方法</p>
</li>
<li><p>args：输入参数列表</p>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jclass rect_clazz = env-&gt;FindClass(&quot;android/graphics/Rect&quot;);</span><br><span class="line">jmethodID rect_constructor = env-&gt;GetMethodID(rect_clazz, &quot;&lt;init&gt;&quot;, &quot;()V&quot;);</span><br><span class="line">jobject rect = env-&gt;NewObject(rect_clazz, rect_constructor);</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="5">
<li><code>jclass GetObjectClass(jobject obj)</code><br>说明：根据对象获取所属类<br>参数：</li>
</ol>
<ul>
<li>obj：某个 Java 对象实例，不能为 NULL</li>
</ul>
<ol start="6">
<li><code>jobjectRefType GetObjectRefType(jobject obj)</code><br>说明：获取到对象的引用类型，JNI 1.6 新增的方法</li>
</ol>
<p>参数：</p>
<ul>
<li><p>obj：某个 Java 对象实例<br>返回：</p>
<p>  JNIInvalidRefType &#x3D; 0 &#x2F;&#x2F; 该 obj 是个无效的引用<br>  JNILocalRefType &#x3D; 1 &#x2F;&#x2F; 该 obj 是个局部引用<br>  JNIGlobalRefType &#x3D; 2 &#x2F;&#x2F; 该 obj 是个全局引用<br>  JNIWeakGlobalRefType &#x3D; 3 &#x2F;&#x2F; 该 obj 是个全局的弱引用</p>
</li>
</ul>
<ol start="7">
<li><code>jboolean IsInstanceOf(jobject obj, jclass clazz)</code><br>说明：判断某个对象是否是指定类的实例<br>参数：</li>
</ol>
<ul>
<li>obj：某个 Java 对象实例</li>
<li>clazz：指定的类对象</li>
</ul>
<ol start="8">
<li><code>jboolean IsSameObject(jobject ref1, jobject ref2)</code><br>说明：判断两个对象的引用是否指向的是相同的 Java 对象<br>参数：</li>
</ol>
<ul>
<li>ref1：某个 Java 对象的引用1</li>
<li>ref2：某个 Java 对象的引用2</li>
</ul>
<p><strong>五、域操作</strong></p>
<ol>
<li><code>jfieldID GetFieldID(jclass clazz, const char name, const char sig)</code><br>说明：获取类中某个非静态成员变量的ID（域ID）<br>参数：</li>
</ol>
<ul>
<li><p>clazz：指定对象的类</p>
</li>
<li><p>name：这个域（Field）在 Java 类中定义的名字</p>
</li>
<li><p>sig：这个域（Field）的类型描述符<br>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jclass clazz = env-&gt;FindClass(&quot;android/graphics/Rect&quot;);</span><br><span class="line">jfieldID left_field = env-&gt;GetFieldID(clazz, &quot;left&quot;, &quot;I&quot;);</span><br><span class="line">jfieldID top_field = env-&gt;GetFieldID(clazz, &quot;top&quot;, &quot;I&quot;);</span><br><span class="line">jfieldID right_field = env-&gt;GetFieldID(clazz, &quot;right&quot;, &quot;I&quot;);</span><br><span class="line">jfieldID bottom_field = env-&gt;GetFieldID(clazz, &quot;bottom&quot;, &quot;I&quot;);</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><code>NativeType Get&lt;type&gt;Field(jobject obj, jfieldID fieldID)</code><br>  说明：获取实例域的变量值，这里 type 表示的是一系列方法，如下：</li>
</ol>
<table>
<thead>
<tr>
<th>Get<type>Field Routine Name</th>
<th>Native Type</th>
</tr>
</thead>
<tbody><tr>
<td>GetObjectField()</td>
<td>jobject</td>
</tr>
<tr>
<td>GetBooleanField()</td>
<td>jboolean</td>
</tr>
<tr>
<td>GetByteField()</td>
<td>jbyte</td>
</tr>
<tr>
<td>GetCharField()</td>
<td>jchar</td>
</tr>
<tr>
<td>GetShortField()</td>
<td>jshort</td>
</tr>
<tr>
<td>GetIntField()</td>
<td>jint</td>
</tr>
<tr>
<td>GetLongField()</td>
<td>jlong</td>
</tr>
<tr>
<td>GetFloatField()</td>
<td>jfloat</td>
</tr>
<tr>
<td>GetDoubleField()</td>
<td>jdouble</td>
</tr>
</tbody></table>
<p>参数：</p>
<ul>
<li><p>obj：某个 Java 对象实例</p>
</li>
<li><p>fieldID：这个变量的域ID<br>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jobject rect; // 初始化过程省略</span><br><span class="line">jclass clazz = env-&gt;FindClass(&quot;android/graphics/Rect&quot;);</span><br><span class="line">jfieldID left_field = env-&gt;GetFieldID(clazz, &quot;left&quot;, &quot;I&quot;);</span><br><span class="line">jint left = env-&gt;GetIntField(rect, left_field);</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li><code>void Set&lt;type&gt;Field(jobject obj, jfieldID fieldID, NativeType value)</code><br>说明：修改实例域的变量值，这里 type 对应上面的 Get 方法，不再累述<br>参数：</li>
</ol>
<ul>
<li><p>obj：需要修改的 Java 对象实例</p>
</li>
<li><p>fieldID：这个变量的域ID</p>
</li>
<li><p>value：需要设置的值<br>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jobject rect; // 初始化过程省略</span><br><span class="line">jclass clazz = env-&gt;FindClass(&quot;android/graphics/Rect&quot;);</span><br><span class="line">jfieldID left_field = env-&gt;GetFieldID(clazz, &quot;left&quot;, &quot;I&quot;);</span><br><span class="line">env-&gt;SetIntField(rect, left_field, 1);</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="4">
<li><p><code>jfieldID GetStaticFieldID(jclass clazz, const char name, const char sig)</code><br>说明：同 GetFieldID，只不过这里操作的是静态的域（Filed）</p>
</li>
<li><p><code>NativeType GetStaticField(jobject obj, jfieldID fieldID)</code><br>说明：同 GetField，只不过这里操作的是静态的域（Filed）</p>
</li>
<li><p><code>void SetStaticField(jobject obj, jfieldID fieldID, NativeType value)</code><br>说明：同 SetField，只不过这里操作的是静态的域（Filed）</p>
</li>
</ol>
<p><strong>六、方法操作</strong></p>
<ol>
<li><code>jmethodID GetMethodID(jclass clazz, const char name, const char sig)</code><br>说明：获取类中某个非静态方法的ID</li>
</ol>
<p>参数：</p>
<ul>
<li>clazz：指定对象的类</li>
<li>name：这个方法在 Java 类中定义的名称，构造方法为 ““</li>
<li>sig：这个方法的类型描述符，例如 “()V”，其中括号内是方法的参数，括号后是返回值类型<br>示例：</li>
</ul>
<p>Java 的类定义如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package com.afei.jnidemo;</span><br><span class="line"></span><br><span class="line">class Test &#123;</span><br><span class="line">    public Test()&#123;&#125;</span><br><span class="line">    public int show(String msg, int number) &#123;</span><br><span class="line">        System.out.println(&quot;msg: &quot; + msg);</span><br><span class="line">        System.out.println(&quot;number: &quot; + number);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>JNI 调用如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jclass clazz = env-&gt;FindClass(&quot;com/afei/jnidemo/Test&quot;);</span><br><span class="line">jmethodID constructor_method = env-&gt;GetMethodID(clazz, &quot;&lt;init&gt;&quot;, &quot;()V&quot;);</span><br><span class="line">jmethodID show_method = env-&gt;GetMethodID(clazz, &quot;show&quot;, &quot;(Ljava/lang/String;I)I&quot;);</span><br></pre></td></tr></table></figure>

<p>​    签名时其中括号内是方法的参数，括号后是返回值类型。例如 show 方法，第一个参数是 String 类，对应 Ljava&#x2F;lang&#x2F;String;（注意后面有一个分号），第二个参数是 int 基本类型，对应的类型描述符是 I，返回值也是 int，同样是 I，所以最终该方法的签名为 “(Ljava&#x2F;lang&#x2F;String;I)I”。</p>
<ol start="2">
<li><code>NativeType CallMethod(jobject obj, jmethodID methodID, …)</code></li>
<li><code>NativeType CallMethodA(jobject obj, jmethodID methodID, jvalue* args)</code></li>
<li><code>NativeType CallMethodV(jobject obj, jmethodID methodID, va_list args)</code><br>说明：调用对象的某个方法，唯一不同的是输入参数的传入形式不同，这里 type 表示的是一系列方法，如下：</li>
</ol>
<p><img src="/../../../../images/image-20231123153835482.png" alt="image-20231123153835482"></p>
<p>参数：</p>
<ul>
<li><p>obj：某个 Java 对象实例</p>
</li>
<li><p>methodID：指定方法的ID</p>
</li>
<li><p>args：输入参数列表<br>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jclass clazz = env-&gt;FindClass(&quot;com/afei/jnidemo/Test&quot;);</span><br><span class="line">jmethodID show_method = env-&gt;GetMethodID(clazz, &quot;show&quot;, &quot;(Ljava/lang/String;I)I&quot;);</span><br><span class="line">jint result = env-&gt;CallIntMethod(clazz, show_method, &quot;Hello JNI!&quot;, 0);</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="5">
<li><p><code>jmethodID GetStaticMethodID(jclass clazz, const char name, const char sig)</code><br>说明：同 GetMethodID，只不过操作的是静态方法</p>
</li>
<li><p><code>NativeType CallStaticMethod(jclass clazz, jmethodID methodID, …)</code></p>
</li>
<li><p><code>NativeType CallStaticMethodA(jclass clazz, jmethodID methodID, jvalue* args)</code></p>
</li>
<li><p><code>NativeType CallStaticMethodV(jclass clazz, jmethodID methodID, va_list args)</code><br>说明：同 NativeType CallMethod，只不过操作的是静态方法，参数也由 jobject 变成了 jclass。</p>
</li>
</ol>
<p><strong>七、全局引用和局部引用</strong></p>
<ol>
<li><code>jobject NewGlobalRef(jobject obj)</code><br>说明：创建一个全局引用，不用时必须调用 DeleteGlobalRef() 方法释放。<br>参数：</li>
</ol>
<ul>
<li><p>obj：某个 Java 对象实例，可以是局部引用或全局引用<br>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jclass mPointFClass;  // global reference to PointF class</span><br><span class="line"> </span><br><span class="line">...</span><br><span class="line">jclass clazz = env-&gt;FindClass(&quot;android/graphics/PointF&quot;);</span><br><span class="line">mPointFClass = (jclass) env-&gt;NewGlobalRef(clazz);</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><code>void DeleteGlobalRef(jobject globalRef)</code><br>说明：释放某个全局引用<br>参数：</li>
</ol>
<ul>
<li>globalRef：某全局引用</li>
</ul>
<ol start="3">
<li><code>jobject NewLocalRef(jobject ref)</code><br>说明：创建一个局部引用。这个方法一般很少用。<br>参数：</li>
</ol>
<ul>
<li>ref：某个引用，可以是全局引用或者局部引用</li>
</ul>
<ol start="4">
<li><code>void DeleteLocalRef(jobject localRef)</code><br>说明：释放某个局部引用<br>参数：</li>
</ol>
<ul>
<li><p>localRef：某局部引用</p>
<p>注意：<br>局部引用在方法执行完后也会自动释放，不过当你在执行一个很大的循环时，里面会产生大量临时的局部引用，那么建议的做法是手动的调用该方法去释放这个局部引用。</p>
</li>
</ul>
<ol start="5">
<li><code>jweak NewWeakGlobalRef(jobject obj)</code><br>说明：创建一个全局的弱引用<br>参数：</li>
</ol>
<ul>
<li><p>obj：某个 Java 对象实例</p>
<p>注意：<br>弱引用不会阻止 GC 回收它引用的对象，在内存不足时，弱引用的对象往往会被回收掉，使用时一定要多加小心。</p>
</li>
</ul>
<ol start="6">
<li><code>void DeleteWeakGlobalRef(jweak obj)</code><br>说明：释放某个全局的弱引用<br>参数：</li>
</ol>
<ul>
<li>obj：某个全局弱引用</li>
</ul>
<p><strong>八、字符串操作</strong></p>
<ol>
<li><code>jstring NewString(const jchar* unicodeChars, jsize len)</code><br>说明：以 UTF-16 的编码方式创建一个 Java 的字符串（jchar 的定义为 uint16_t）<br>参数：</li>
</ol>
<ul>
<li>unicodeChars：指向字符数组的指针</li>
<li>len：字符数组的长度</li>
</ul>
<ol start="2">
<li><code>jstring NewStringUTF(const char* bytes)</code><br>说明：以 UTF-8 的编码方式创建一个 Java 的字符串<br>参数：</li>
</ol>
<ul>
<li>bytes：指向字符数组的指针</li>
</ul>
<ol start="3">
<li><code>jsize GetStringLength(jstring string)</code></li>
<li><code>jsize GetStringUTFLength(jstring string)</code><br>说明：获取字符串的长度，GetStringLength 是 UTF-16 编码，GetStringUTFLength 是 UTF-8 编码<br>参数：</li>
</ol>
<ul>
<li>string：字符串</li>
</ul>
<ol start="5">
<li><code>const jchar GetStringChars(jstring string, jboolean isCopy)</code></li>
<li><code>const char GetStringUTFChars(jstring string, jboolean isCopy)</code><br>说明：将 Java 风格的 jstring 对象转换成 C 风格的字符串，同上一个是 UTF-16 编码，一个是 UTF-8 编码<br>参数：</li>
</ol>
<ul>
<li>string：Java 风格的字符串</li>
<li>isCopy：是否进行拷贝操作，0 为不拷贝</li>
</ul>
<ol start="7">
<li><code>void ReleaseStringChars(jstring string, const jchar* chars)</code></li>
<li><code>void ReleaseStringUTFChars(jstring string, const char* utf)</code><br>说明：释放指定的字符串指针，通常来说，Get 和 Release 是成对出现的<br>参数：</li>
</ol>
<ul>
<li><p>string：Java 风格的字符串</p>
</li>
<li><p>chars&#x2F;utf：对应的 C 风格的字符串<br>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">JNIEXPORT void JNICALL</span><br><span class="line">Java_com_afei_jnidemo_MainActivity_test(JNIEnv *env, jobject instance, jstring msg_) &#123;</span><br><span class="line">    const char *msg = env-&gt;GetStringUTFChars(msg_, 0);</span><br><span class="line">    // Do Something</span><br><span class="line">    env-&gt;ReleaseStringUTFChars(msg_, msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>九、数组操作</strong></p>
<ol>
<li><code>jobjectArray NewObjectArray(jsize length, jclass elementClass, jobject initialElement)</code><br>说明：创建引用数据类型的数组<br>参数：</li>
</ol>
<ul>
<li><p>length：数组的长度</p>
</li>
<li><p>elementClass：数组的元素所属的类</p>
</li>
<li><p>initialElement：使用什么样的对象来初始化，可以选择 NULL<br>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int points_count = 21;</span><br><span class="line">jclass pointFClass = env-&gt;FindClass(&quot;android/graphics/PointF&quot;);</span><br><span class="line">jobjectArray point_array = env-&gt;NewObjectArray(points_count, pointFClass, NULL);</span><br></pre></td></tr></table></figure></li>
</ul>
<p>2.<code>ArrayType NewArray(jsize length)</code><br>说明：创建基本数据类型的数组。这里的基本数据类型有：</p>
<p><img src="/../../../../images/image-20231123154203044.png" alt="image-20231123154203044"></p>
<p>参数：</p>
<ul>
<li>length：数组的长度</li>
</ul>
<ol start="3">
<li><code>jsize GetArrayLength(jarray array)</code><br>说明：获取数组的长度<br>参数：</li>
</ol>
<ul>
<li>array：指定的数组对象。jarray 是 jbooleanArray、jbyteArray、jcharArray 等的父类。</li>
</ul>
<ol start="4">
<li><code>jobject GetObjectArrayElement(jobjectArray array, jsize index)</code><br>说明：获取引用数据类型数组指定索引位置处的对象<br>参数：</li>
</ol>
<ul>
<li>array：引用数据类型数组</li>
<li>index：目标索引值</li>
</ul>
<ol start="5">
<li><code>void SetObjectArrayElement(jobjectArray array, jsize index, jobject value)</code><br>说明：设置引用数据类型数组指定索引位置处的值<br>参数：</li>
</ol>
<ul>
<li>array：需要设置的引用数据类型数组</li>
<li>index：目标索引值</li>
<li>value：需要设置的值</li>
</ul>
<ol start="6">
<li><code>NativeType GetArrayElements(ArrayType array, jboolean isCopy)</code><br>说明：获取基本数据类型数组的头指针<br>参数：</li>
</ol>
<ul>
<li>array：基本数据类型数组</li>
<li>isCopy：是否进行拷贝操作，0 为不拷贝</li>
</ul>
<ol start="7">
<li><code>void ReleaseArrayElements(ArrayType array, NativeType* elems, jint mode)</code><br>说明：释放基本数据类型数组指针。通常来说，Get 和 Release 是成对出现的<br>参数：</li>
</ol>
<ul>
<li>array：基本数据类型数组</li>
<li>elems：对应的 C 风格的基本数据类型指针</li>
<li>mode：释放模式，通常我们都是使用 0，有三种，如下<br><img src="/../../../../images/image-20231123154251199.png" alt="image-20231123154251199"></li>
</ul>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Java_com_afei_jnidemo_MainActivity_test(JNIEnv *env, jobject instance, jintArray array_) &#123;</span><br><span class="line">    jint *array = env-&gt;GetIntArrayElements(array_, 0);</span><br><span class="line">    // Do Something</span><br><span class="line">    env-&gt;ReleaseIntArrayElements(array_, array, 0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ol start="8">
<li><code>void GetArrayRegion(ArrayType array, jsize start, jsize len, NativeType* buf)</code><br>说明：返回基本数据类型数组的部分副本。这里的基本数据类型有：</li>
</ol>
<p><img src="/../../../../images/image-20231123154324154.png" alt="image-20231123154324154"></p>
<p>参数：</p>
<ul>
<li>array：基本数据类型数组</li>
<li>start：起始的索引值</li>
<li>len：拷贝的长度</li>
<li>buf：拷贝到的目标数组</li>
</ul>
<ol start="9">
<li><code>void SetArrayRegion(ArrayType array, jsize start, jsize len, const NativeType* buf)</code><br>说明：设置基本数据类型数组元素。类型和上面的表类似。<br>参数：</li>
</ol>
<ul>
<li>array：需要设置的基本数据类型数组</li>
<li>start：起始的索引值</li>
<li>len：需要设置的 buf 的长度</li>
<li>buf：需要设置的值数组</li>
</ul>
<p><strong>十、异常操作</strong></p>
<ol>
<li><code>jint Throw(jthrowable obj)</code><br>说明：抛出一个异常，需要手动创建异常的实例，调用较复杂，一般不使用这个方法<br>参数：</li>
</ol>
<ul>
<li><p>obj：异常对象<br>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">jclass ioExceptionClazz = env-&gt;FindClass(&quot;java/io/IOException&quot;);</span><br><span class="line">jmethodID ioExceptionConstructor = env-&gt;GetMethodID(ioExceptionClazz, &quot;&lt;init&gt;&quot;, &quot;(Ljava/lang/String;)V&quot;);</span><br><span class="line">jthrowable exceptionObj = static_cast&lt;jthrowable&gt;(env-&gt;NewObject(ioExceptionClazz, </span><br><span class="line">                                                      ioExceptionConstructor, &quot;IO异常&quot;));</span><br><span class="line">if (env-&gt;Throw(exceptionObj) == JNI_OK) &#123;</span><br><span class="line">    // 创建成功</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    // 创建失败</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><code>jint ThrowNew(jclass clazz, const char* message)</code><br>说明：抛出一个异常。使用起来比三个方法方便<br>参数：</li>
</ol>
<ul>
<li><p>clazz：指定的异常类</p>
</li>
<li><p>message：异常信息<br>示例：</p>
<p>  if (env-&gt;ThrowNew(env-&gt;FindClass(“java&#x2F;io&#x2F;IOException”), “IO异常”) &#x3D;&#x3D; JNI_OK) {<br>  &#x2F;&#x2F; 创建成功<br>  } else {<br>  &#x2F;&#x2F; 创建失败<br>  }</p>
</li>
</ul>
<ol start="3">
<li><p><code>jthrowable ExceptionOccurred()</code></p>
</li>
<li><p><code>jboolean ExceptionCheck()</code><br>说明：检查是否有异常，如果本地函数有异常抛出，ExceptionOccurred 会返回这个异常的示例，ExceptionCheck 只返回是否有异常</p>
</li>
<li><p>void ExceptionDescribe()<br>说明：将异常和堆栈信息推送到错误流</p>
</li>
<li><p>void ExceptionClear()<br>说明：清除掉发生的异常</p>
</li>
</ol>
<p>以上几个方法的示例：</p>
<p>Java 部分代码为：</p>
<pre><code>public class MainActivity extends AppCompatActivity &#123;
 
    static &#123;
        System.loadLibrary(&quot;native-lib&quot;);
    &#125;
 
    @Override
    protected void
    onCreate(Bundle savedInstanceState) &#123;
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        try &#123;
            test();
        &#125; catch (Exception e) &#123;
            Log.e(&quot;MainActivity&quot;, &quot;onCreate: &quot; + e);
        &#125;
    &#125;
 
    private native void test() throws IllegalArgumentException;
 
    private void callNullPointerException() throws NullPointerException &#123;
        throw new NullPointerException(&quot;MainActivity NullPointerException&quot;);
    &#125;
 
&#125;
</code></pre>
<p>JNI 部分代码为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">JNIEXPORT void JNICALL</span><br><span class="line">Java_com_afei_jnidemo_MainActivity_test(JNIEnv *env, jobject instance) &#123;</span><br><span class="line">    jclass clazz = env-&gt;GetObjectClass(instance);</span><br><span class="line">    jmethodID mid =env-&gt;GetMethodID(clazz, &quot;callNullPointerException&quot;, &quot;()V&quot;);</span><br><span class="line">    env-&gt;CallVoidMethod(instance, mid); // will throw a NullPointerException</span><br><span class="line">    jthrowable exc = env-&gt;ExceptionOccurred(); // 检测是否发生异常</span><br><span class="line">    if (exc) &#123;</span><br><span class="line">        LOGD(&quot;============&quot;);</span><br><span class="line">        env-&gt;ExceptionDescribe(); // 打印异常信息</span><br><span class="line">        LOGD(&quot;============&quot;);</span><br><span class="line">        env-&gt;ExceptionClear(); // 清除掉发生的异常</span><br><span class="line">        jclass newExcCls = env-&gt;FindClass(&quot;java/lang/IllegalArgumentException&quot;);</span><br><span class="line">        env-&gt;ThrowNew(newExcCls, &quot;throw from JNI&quot;); // 返回一个新的异常到 Java</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>运行结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">07-12 14:57:07.443 26623-26623/com.afei.jnidemo D/FaceAPI: ============</span><br><span class="line">07-12 14:57:07.443 26623-26623/com.afei.jnidemo W/System.err: java.lang.NullPointerException: MainActivity NullPointerException</span><br><span class="line">        at com.afei.jnidemo.MainActivity.callNullPointerException(MainActivity.java:34)</span><br><span class="line">        at com.afei.jnidemo.MainActivity.test(Native Method)</span><br><span class="line">        at com.afei.jnidemo.MainActivity.onCreate(MainActivity.java:25)</span><br><span class="line">        at android.app.Activity.performCreate(Activity.java:6857)</span><br><span class="line">        at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1125)</span><br><span class="line">        at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2702)</span><br><span class="line">        at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2810)</span><br><span class="line">        at android.app.ActivityThread.-wrap12(ActivityThread.java)</span><br><span class="line">        at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1532)</span><br><span class="line">        at android.os.Handler.dispatchMessage(Handler.java:102)</span><br><span class="line">        at android.os.Looper.loop(Looper.java:181)</span><br><span class="line">        at android.app.ActivityThread.main(ActivityThread.java:6288)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Native Method)</span><br><span class="line">07-12 14:57:07.443 26623-26623/com.afei.jnidemo W/System.err:     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:900)</span><br><span class="line">        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:790)</span><br><span class="line">07-12 14:57:07.443 26623-26623/com.afei.jnidemo D/FaceAPI: ============</span><br><span class="line">07-12 14:57:07.444 26623-26623/com.afei.jnidemo E/MainActivity: onCreate: java.lang.IllegalArgumentException: throw from JNI</span><br></pre></td></tr></table></figure>

<ol start="7">
<li><code>void FatalError(const char* msg)</code><br>说明：抛出一个致命异常，并且不希望JVM处理<br>参数：</li>
</ol>
<ul>
<li>msg：致命异常的信息</li>
</ul>
<p>十一、其它<br>    其他还有有关 Monitor Operations、NIO Support、Reflection Support 等一些方法，由于我也没使用过，就不再这里解释了。<br>    可以参考 JNI 的官网的介绍：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/functions.html#wp9502">https://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/functions.html#wp9502</a></p>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/afei__/article/details/81016413">JNI 方法大全及使用示例-CSDN博客</a></p>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <article id="post-Android进阶/NDK/蒋超大佬扫盲/9.函数签名及ndk调用java方法" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/">NDK</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/">蒋超大佬扫盲</a>
    </div>

                        
                        
  



                        
                        
                    </div>
                
                
   

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <p> <strong>基础知识</strong></p>
<p> <strong>1.1 访问域</strong></p>
<p>Java有两类域：实例域和静态域。类的每个实例都有自己的实例域副本，而每个类的所有实例共享同一个静态域。</p>
<p>了解Java的都知道，在一个类加载器中，类的class只有一个，但可以有很多类的实例对象。所以在我们使用JNI访问Java的方法时，会有两种不同的方法。</p>
<p><strong>1.2 域ID</strong></p>
<p>在前面章节中我们讲解了Java调用jni的方法，Java调用jni方法只需要注意函数的命名规则即可，但在jni访问Java的方法时需要获得访问域的ID，访问域有两种，同样，域ID也有两种。一种是静态域ID，一种是实例域ID,如下所示：</p>
<p><strong>1.2.1 获取类</strong></p>
<p>1.2.1.1 用对象引用获得jclass</p>
<p>通过传入Java对象（jobject类型变量），获取Java类对象。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jclass clazz;</span><br><span class="line">clazz = env-&gt;<span class="built_in">GetObjectClass</span>(env, instance);</span><br></pre></td></tr></table></figure>

<p>1.2.1.2 通过包名类名获取jclass</p>
<p>通过传入完整的包名&#x2F;类名获取java类对应的C&#x2F;C++环境下的jclass类型的变量，返回值：Java字节码class对象，对应C++中的jclass对象。注意：包名中的   .   使用   &#x2F;   来替代</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jclass clazz;</span><br><span class="line">clazz = env-&gt;<span class="built_in">FindClass</span>(<span class="string">&quot;com/jiangc/jni/TestJni&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>1.3 签名规则</strong></p>
<p>以下是签名规则，在jni的环境中调用Java的方法或者获取Field时，需要用到签名，签名规则如下：</p>
<table>
<thead>
<tr>
<th>java 类型</th>
<th>签名</th>
</tr>
</thead>
<tbody><tr>
<td>Boolean</td>
<td>Z</td>
</tr>
<tr>
<td>Byte</td>
<td>B</td>
</tr>
<tr>
<td>Char</td>
<td>C</td>
</tr>
<tr>
<td>Short</td>
<td>S</td>
</tr>
<tr>
<td>Int</td>
<td>I</td>
</tr>
<tr>
<td>Long</td>
<td>J</td>
</tr>
<tr>
<td>Float</td>
<td>F</td>
</tr>
<tr>
<td>Double</td>
<td>D</td>
</tr>
<tr>
<td>fully-qualified-class</td>
<td>Lfully-qualified-class</td>
</tr>
<tr>
<td>type[]</td>
<td>[type</td>
</tr>
<tr>
<td>method type</td>
<td>(arg-type)ret-type</td>
</tr>
</tbody></table>
<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.javap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJni</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;javap&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ()Ljava/lang/String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> String <span class="title function_">HelloWorld</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// (II)I</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// ()Z</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isTrue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>1.3.1 使用javap生成函数签名</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1.javac TestJni.java</span><br><span class="line">2.javap -s -p -classpatch . TestJni</span><br><span class="line"></span><br><span class="line">javap -s -p -classpath . TestJni</span><br><span class="line">警告: 文件 .\TestJni.class 不包含类 TestJni</span><br><span class="line">Compiled from &quot;TestJni.java&quot;</span><br><span class="line">public class com.example.javap.TestJni &#123;</span><br><span class="line">  public com.example.javap.TestJni();</span><br><span class="line">    descriptor: ()V</span><br><span class="line"></span><br><span class="line">  public native java.lang.String HelloWorld();</span><br><span class="line">    descriptor: ()Ljava/lang/String;</span><br><span class="line"></span><br><span class="line">  public int add(int, int);</span><br><span class="line">    descriptor: (II)I</span><br><span class="line"></span><br><span class="line">  public boolean isTrue();</span><br><span class="line">    descriptor: ()Z</span><br><span class="line"></span><br><span class="line">  static &#123;&#125;;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <strong>1.4 设置Android Studio javap</strong></p>
<p>打开Android  Studio ，File-&gt;Settings-&gt;Tools-&gt;External Tools扩展工具栏，如下图：<br><img src="/../../../../images/image-20231119174245513.png"></p>
<p>点击+号按钮<br><img src="/../../../../images/image-20231119174704232.png"></p>
<p>填写信息如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Program:  javap的绝对路径</span><br><span class="line">Arguments：-s -p $FileClass$</span><br><span class="line">Working directory: $OutputPath$</span><br></pre></td></tr></table></figure>

<p>首先编译一下项目，然后通过右键javap获取函数签名</p>
<p><img src="/../../../../images/image-20231119174910736.png"></p>
<p>获取到的签名如下：<br><img src="/../../../../images/image-20231119175155744.png"></p>
<p>这样我们就可以相对比较快捷的得到函数签名了。</p>
<p><strong>二. 通过jni访问java方法</strong></p>
<p><strong>2.1 调用实例对象的方法</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"><span class="function">JNIEXPORT jstring JNICALL</span></span><br><span class="line"><span class="function"><span class="title">Java_com_example_javap_TestJni_HelloWorld</span><span class="params">(JNIEnv *env, jobject thiz)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    jmethodID jmethodId;</span><br><span class="line">    jclass clazz = env-&gt;<span class="built_in">GetObjectClass</span>(thiz);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nullptr</span> == clazz) &#123;</span><br><span class="line">        <span class="built_in">LOGE</span>(<span class="string">&quot;jclass is null\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="comment">//GetMethodID()获取java方法，GetMethodID(类,方法名,方法签名)</span></span><br><span class="line">    jmethodId = env-&gt;<span class="built_in">GetMethodID</span>(clazz, <span class="string">&quot;add&quot;</span>, <span class="string">&quot;(II)I&quot;</span>);</span><br><span class="line">    jint result;</span><br><span class="line">    result = env-&gt;<span class="built_in">CallIntMethod</span>(thiz, jmethodId, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">LOGE</span>(<span class="string">&quot;result = %d\n&quot;</span>, result);</span><br><span class="line">    std::string hello = <span class="string">&quot;Hello from C++&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> env-&gt;<span class="built_in">NewStringUTF</span>(hello.<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"><span class="function">JNIEXPORT <span class="type">void</span> JNICALL</span></span><br><span class="line"><span class="function"><span class="title">Java_com_example_javap_TestJni_callStaticFunc</span><span class="params">(JNIEnv *env, jobject thiz)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    jclass clazz;</span><br><span class="line">    <span class="comment">// com.example.javap</span></span><br><span class="line">    clazz = env-&gt;<span class="built_in">FindClass</span>(<span class="string">&quot;com/example/javap/TestJni&quot;</span>);</span><br><span class="line">    jmethodID jmethodId = env-&gt;<span class="built_in">GetStaticMethodID</span>(clazz, <span class="string">&quot;sAdd&quot;</span>, <span class="string">&quot;(II)I&quot;</span>);</span><br><span class="line"></span><br><span class="line">    jint result = env-&gt;<span class="built_in">CallStaticIntMethod</span>(clazz, jmethodId, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">LOGE</span>(<span class="string">&quot;call static result : %d\n&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <article id="post-Android进阶/NDK/蒋超大佬扫盲/8.mqtt" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/">NDK</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/">蒋超大佬扫盲</a>
    </div>

                        
                        
  



                        
                        
                    </div>
                
                
   

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <p><strong>MQTT 源码移植</strong></p>
<p><strong>目标</strong></p>
<p>在应用层使用mqtt库和平台通信。</p>
<p><strong>移植原因</strong></p>
<p>mqtt java端接口匮乏，不能定制</p>
<p><strong>一. 源码下载</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/eclipse/paho.mqtt.c.git</span><br></pre></td></tr></table></figure>

<p>主要用的就是paho.mqtt.c  是C语言实现的一个库，也有Java的，本次移植主要是基于C端，原因就是更为灵活。</p>
<p><strong>二. 新建一个Android Studio工程</strong></p>
<p>模块化考虑，在新建的工程里新建一个Android Native module，用于封装mqtt的库，提供java接口,目录结构如下图</p>
<img src="../../../../images/image-20231115193730943-17007066907709.png" alt="image-20231115193730943" style="zoom:67%;" />

<p> <strong>三. 参考源码提供的Android.mk</strong></p>
<img src="../../../../images/image-20231115182011223-170070671314511.png" alt="image-20231115182011223" style="zoom:67%;" />


<p>Android.mk的主要内容，对于应用层的移植，我们需要根据这个文件转换成CMakeList.txt</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通用源文件列表，每个库都会依赖</span></span><br><span class="line">libpaho-mqtt3_local_src_c_files_common := \</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">(libpaho-mqtt3_lib_path)/MQTTProtocolClient.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/Tree.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/Heap.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/MQTTPacket.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/Clients.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/Thread.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/utf-8.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/StackTrace.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/MQTTProtocolOut.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/Socket.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/Log.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/Messages.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/LinkedList.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/MQTTPersistence.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/MQTTPacketOut.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/SocketBuffer.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/MQTTPersistenceDefault.c \</span></span><br><span class="line"><span class="language-bash"></span><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下面是声明的文件列表，分别用于生成不同的库</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">libpaho-mqtt3_local_src_c_files_c 文件列表</span></span><br><span class="line">libpaho-mqtt3_local_src_c_files_c := \</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">(libpaho-mqtt3_lib_path)/MQTTClient.c \</span></span><br><span class="line"><span class="language-bash"><span class="comment"># libpaho-mqtt3_local_src_c_files_cs 文件列表</span></span></span><br><span class="line">libpaho-mqtt3_local_src_c_files_cs := \</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">(libpaho-mqtt3_lib_path)/MQTTClient.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/SSLSocket.c \</span></span><br><span class="line"><span class="language-bash"><span class="comment"># libpaho-mqtt3_local_src_c_files_a 文件列表</span></span></span><br><span class="line">libpaho-mqtt3_local_src_c_files_a := \</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">(libpaho-mqtt3_lib_path)/MQTTAsync.c \</span></span><br><span class="line"><span class="language-bash"><span class="comment"># libpaho-mqtt3_local_src_c_files_as 文件列表</span></span></span><br><span class="line">libpaho-mqtt3_local_src_c_files_as := \</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">(libpaho-mqtt3_lib_path)/MQTTAsync.c \</span></span><br><span class="line"><span class="language-bash">	$(libpaho-mqtt3_lib_path)/SSLSocket.c \</span></span><br><span class="line"><span class="language-bash"></span><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">########################################  静态库  #####################################################</span></span></span><br><span class="line">.......................................................................................................</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">########################################  动态库  #####################################################</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">libpaho-mqtt3c</span></span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line">LOCAL_MODULE    := libpaho-mqtt3c</span><br><span class="line">LOCAL_SHARED_LIBRARIES := libdl</span><br><span class="line">LOCAL_EXPORT_C_INCLUDE_DIRS := $(LOCAL_PATH)/$(libpaho-mqtt3_lib_path)</span><br><span class="line">LOCAL_C_INCLUDES:= $(libpaho-mqtt3_c_includes)</span><br><span class="line">LOCAL_SRC_FILES := $(libpaho-mqtt3_local_src_c_files_common) $(libpaho-mqtt3_local_src_c_files_c)</span><br><span class="line">include $(BUILD_SHARED_LIBRARY)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">libpaho-mqtt3cs</span></span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line">LOCAL_MODULE    := libpaho-mqtt3cs</span><br><span class="line">LOCAL_SHARED_LIBRARIES := libcrypto libssl libdl</span><br><span class="line">LOCAL_EXPORT_C_INCLUDE_DIRS := $(LOCAL_PATH)/$(libpaho-mqtt3_lib_path)</span><br><span class="line">LOCAL_C_INCLUDES:= $(libpaho-mqtt3_c_includes)</span><br><span class="line">LOCAL_CFLAGS += -DOPENSSL</span><br><span class="line">LOCAL_SRC_FILES := $(libpaho-mqtt3_local_src_c_files_common) $(libpaho-mqtt3_local_src_c_files_cs)</span><br><span class="line">include $(BUILD_SHARED_LIBRARY)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">libpaho-mqtt3a</span></span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line">LOCAL_MODULE    := libpaho-mqtt3a</span><br><span class="line">LOCAL_SHARED_LIBRARIES := libdl</span><br><span class="line">LOCAL_EXPORT_C_INCLUDE_DIRS := $(LOCAL_PATH)/$&#123;libpaho-mqtt3_lib_path&#125;</span><br><span class="line">LOCAL_C_INCLUDES:= $(libpaho-mqtt3_c_includes)</span><br><span class="line">LOCAL_SRC_FILES := $(libpaho-mqtt3_local_src_c_files_common) $(libpaho-mqtt3_local_src_c_files_a)</span><br><span class="line">include $(BUILD_SHARED_LIBRARY)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">libpaho-mqtt3as</span></span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line">LOCAL_MODULE    := libpaho-mqtt3as</span><br><span class="line">LOCAL_SHARED_LIBRARIES := libcrypto libssl libdl</span><br><span class="line">LOCAL_EXPORT_C_INCLUDE_DIRS := $(LOCAL_PATH)/$&#123;libpaho-mqtt3_lib_path&#125;</span><br><span class="line">LOCAL_CFLAGS += -DOPENSSL</span><br><span class="line">LOCAL_C_INCLUDES:= $(libpaho-mqtt3_c_includes)</span><br><span class="line">LOCAL_SRC_FILES := $(libpaho-mqtt3_local_src_c_files_common) $(libpaho-mqtt3_local_src_c_files_as)</span><br><span class="line">include $(BUILD_SHARED_LIBRARY)</span><br></pre></td></tr></table></figure>

<p>基本上，Android.mk中的重点就是上面的描述了，包含了几个模块：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 通用源码列表</span><br><span class="line">2. 不同库的源码列表</span><br><span class="line">3. 生成不同库的依赖</span><br></pre></td></tr></table></figure>

<p>库的作用如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">paho-mqtt3a ： 一般实际开发中就是使用这个，a表示的是异步消息推送（asynchronous）。</span><br><span class="line">paho-mqtt3as ： as表示的是 异步+加密（asynchronous+OpenSSL）。</span><br><span class="line">paho-mqtt3c ： c 表示的应该是同步（Synchronize），一般性能较差，是发送+等待模式。</span><br><span class="line">paho-mqtt3cs ： cs表示的是同步+加密（asynchronous+OpenSSL）。</span><br></pre></td></tr></table></figure>

<p>转换成CMakeLists如下：这是最终的CMakeList.txt，具体的过程，请继续往下看</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For more information about using CMake with Android Studio, read the</span></span><br><span class="line"><span class="comment"># documentation: https://d.android.com/studio/projects/add-native-code.html.</span></span><br><span class="line"><span class="comment"># For more examples on how to use CMake, see https://github.com/android/ndk-samples.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sets the minimum CMake version required for this project.</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.22</span>.<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Declares the project name. The project name can be accessed via $&#123; PROJECT_NAME&#125;,</span></span><br><span class="line"><span class="comment"># Since this is the top level CMakeLists.txt, the project name is also accessible</span></span><br><span class="line"><span class="comment"># with $&#123;CMAKE_PROJECT_NAME&#125; (both CMake variables are in-sync within the top level</span></span><br><span class="line"><span class="comment"># build script scope).</span></span><br><span class="line"><span class="keyword">project</span>(<span class="string">&quot;mqtt&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;openssl/$&#123;CMAKE_ANDROID_ARCH_ABI&#125;/include&quot;</span>)</span><br><span class="line"><span class="comment"># 包含子目录相关头文件</span></span><br><span class="line"><span class="keyword">include_directories</span>(mqttsrc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通用源文件</span></span><br><span class="line"><span class="keyword">set</span>(libpaho-mqtt3_local_src_c_files_common</span><br><span class="line">        mqttsrc/MQTTProtocolClient.c</span><br><span class="line">        mqttsrc/Tree.c</span><br><span class="line">        mqttsrc/Heap.c</span><br><span class="line">        mqttsrc/MQTTPacket.c</span><br><span class="line">        mqttsrc/Clients.c</span><br><span class="line">        mqttsrc/Thread.c</span><br><span class="line">        mqttsrc/utf-<span class="number">8</span>.c</span><br><span class="line">        mqttsrc/StackTrace.c</span><br><span class="line">        mqttsrc/MQTTProtocolOut.c</span><br><span class="line">        mqttsrc/Socket.c</span><br><span class="line">        mqttsrc/Log.c</span><br><span class="line">        mqttsrc/Messages.c</span><br><span class="line">        mqttsrc/LinkedList.c</span><br><span class="line">        mqttsrc/MQTTPersistence.c</span><br><span class="line">        mqttsrc/SocketBuffer.c</span><br><span class="line">        mqttsrc/MQTTPersistenceDefault.c</span><br><span class="line">        mqttsrc/MQTTProperties.c</span><br><span class="line">        mqttsrc/MQTTTime.c</span><br><span class="line">        mqttsrc/MQTTPacketOut.c</span><br><span class="line">        mqttsrc/WebSocket.c</span><br><span class="line">        mqttsrc/Base64.c</span><br><span class="line">        mqttsrc/Proxy.c</span><br><span class="line">        mqttsrc/SHA1.c</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="comment"># libpaho-mqtt3_local_src_c_files_c</span></span><br><span class="line"><span class="keyword">set</span>(libpaho-mqtt3_local_src_c_files_c</span><br><span class="line">        mqttsrc/MQTTClient.c</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="comment"># libpaho-mqtt3_local_src_c_files_cs</span></span><br><span class="line"><span class="keyword">set</span>(libpaho-mqtt3_local_src_c_files_cs</span><br><span class="line">        mqttsrc/MQTTClient.c</span><br><span class="line">        mqttsrc/SSLSocket.c</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="comment"># libpaho-mqtt3_local_src_c_files_a</span></span><br><span class="line"><span class="keyword">set</span>(libpaho-mqtt3_local_src_c_files_a</span><br><span class="line">        mqttsrc/MQTTAsyncUtils.c</span><br><span class="line">        mqttsrc/MQTTAsync.c</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="comment"># libpaho-mqtt3_local_src_c_files_as</span></span><br><span class="line"><span class="keyword">set</span>(libpaho-mqtt3_local_src_c_files_as</span><br><span class="line">        mqttsrc/MQTTAsyncUtils.c</span><br><span class="line">        mqttsrc/MQTTAsync.c</span><br><span class="line">        mqttsrc/SSLSocket.c</span><br><span class="line">        )</span><br><span class="line"><span class="comment"># 导入预编译库</span></span><br><span class="line"><span class="comment"># crypto</span></span><br><span class="line"><span class="keyword">add_library</span>(crypto SHARED IMPORTED)</span><br><span class="line"><span class="keyword">set_target_properties</span>(crypto PROPERTIES IMPORTED_LOCATION <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/../../../libs/<span class="variable">$&#123;CMAKE_ANDROID_ARCH_ABI&#125;</span>/libcrypto.so)</span><br><span class="line"><span class="comment">## openssl</span></span><br><span class="line"><span class="keyword">add_library</span>(openssl SHARED IMPORTED)</span><br><span class="line"><span class="keyword">set_target_properties</span>(openssl PROPERTIES IMPORTED_LOCATION <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/../../../libs/<span class="variable">$&#123;CMAKE_ANDROID_ARCH_ABI&#125;</span>/libssl.so)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(libpaho-mqtt3c SHARED</span><br><span class="line">        <span class="variable">$&#123;libpaho-mqtt3_local_src_c_files_common&#125;</span></span><br><span class="line">        <span class="variable">$&#123;libpaho-mqtt3_local_src_c_files_c&#125;</span></span><br><span class="line">        )</span><br><span class="line"><span class="keyword">target_link_libraries</span>(libpaho-mqtt3c dl)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(libpaho-mqtt3cs SHARED</span><br><span class="line">        <span class="variable">$&#123;libpaho-mqtt3_local_src_c_files_common&#125;</span></span><br><span class="line">        <span class="variable">$&#123;libpaho-mqtt3_local_src_c_files_cs&#125;</span></span><br><span class="line">        )</span><br><span class="line"><span class="keyword">target_link_libraries</span>(libpaho-mqtt3cs openssl dl)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(libpaho-mqtt3a SHARED</span><br><span class="line">        <span class="variable">$&#123;libpaho-mqtt3_local_src_c_files_common&#125;</span></span><br><span class="line">        <span class="variable">$&#123;libpaho-mqtt3_local_src_c_files_a&#125;</span></span><br><span class="line">        )</span><br><span class="line"><span class="keyword">target_link_libraries</span>(libpaho-mqtt3a dl)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">add_library</span>(libpaho-mqtt3as SHARED</span><br><span class="line">        <span class="variable">$&#123;libpaho-mqtt3_local_src_c_files_common&#125;</span></span><br><span class="line">        <span class="variable">$&#123;libpaho-mqtt3_local_src_c_files_as&#125;</span></span><br><span class="line">        )</span><br><span class="line"><span class="keyword">target_link_libraries</span>(libpaho-mqtt3as openssl dl)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;CMAKE_PROJECT_NAME&#125;</span> SHARED</span><br><span class="line">        <span class="comment"># List C/C++ source files with relative paths to this CMakeLists.txt.</span></span><br><span class="line">        <span class="variable">$&#123;SOURCE_FILES&#125;</span></span><br><span class="line">        mqtt.cpp)</span><br><span class="line"><span class="keyword">target_include_directories</span>(mqtt PUBLIC openssl/<span class="variable">$&#123;CMAKE_ANDROID_ARCH_ABI&#125;</span>/<span class="keyword">include</span>)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(mqtt</span><br><span class="line">        libpaho-mqtt3c</span><br><span class="line">        libpaho-mqtt3cs</span><br><span class="line">        libpaho-mqtt3a</span><br><span class="line">        libpaho-mqtt3as</span><br><span class="line">        dl</span><br><span class="line">        crypto</span><br><span class="line">        openssl</span><br><span class="line">        android</span><br><span class="line">        log)</span><br></pre></td></tr></table></figure>

<p><strong>四. openssl编译</strong></p>
<p>保存下面内容为mkssl</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">while getopts n:o:a:t:d:h: option</span><br><span class="line">do</span><br><span class="line"> case &quot;$&#123;option&#125;&quot;</span><br><span class="line"> in</span><br><span class="line"> n) ANDROID_NDK=$&#123;OPTARG&#125;;;</span><br><span class="line"> o) OPENSSL_VERSION=$&#123;OPTARG&#125;;;</span><br><span class="line"> a) API_LEVEL=$&#123;OPTARG&#125;;;</span><br><span class="line"> t) BUILD_TARGETS=$&#123;OPTARG&#125;;;</span><br><span class="line"> d) OUT_DIR=$&#123;OPTARG&#125;;;</span><br><span class="line"> h) HOST_TAG=$&#123;OPTARG&#125;;;</span><br><span class="line"> *) twentytwo=$&#123;OPTARG&#125;;;</span><br><span class="line"> esac</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo &quot;ANDROID_NDK = $ANDROID_NDK&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;OPENSSL_VERSION= $OPENSSL_VERSION&quot;</span><br><span class="line">echo &quot;API_LEVEL = $API_LEVEL&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;BUILD_TARGETS = $BUILD_TARGETS&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;OUT_DIR= $OUT_DIR&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;HOST_TAG = $HOST_TAG&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;twentytwo=$twentytwo&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BUILD_DIR=/tmp/openssl_android_build</span><br><span class="line"></span><br><span class="line">if [ ! -d openssl-$&#123;OPENSSL_VERSION&#125; ]</span><br><span class="line">then</span><br><span class="line">    if [ ! -f openssl-$&#123;OPENSSL_VERSION&#125;.tar.gz ]</span><br><span class="line">    then</span><br><span class="line">        wget https://www.openssl.org/source/openssl-$&#123;OPENSSL_VERSION&#125;.tar.gz || exit 128</span><br><span class="line">    fi</span><br><span class="line">    tar xzf openssl-$&#123;OPENSSL_VERSION&#125;.tar.gz || exit 128</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">cd openssl-$&#123;OPENSSL_VERSION&#125; || exit 128</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### export ndk directory. Required by openssl-build-scripts #####</span></span></span><br><span class="line">case $&#123;OPENSSL_VERSION&#125; in</span><br><span class="line">    1.1.1*)</span><br><span class="line">        export ANDROID_NDK_HOME=$ANDROID_NDK</span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">        export ANDROID_NDK_ROOT=$ANDROID_NDK</span><br><span class="line">    ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">export PATH=$ANDROID_NDK/toolchains/llvm/prebuilt/$HOST_TAG/bin:$PATH</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### build-function #####</span></span></span><br><span class="line">build_the_thing() &#123;</span><br><span class="line">    make clean</span><br><span class="line">    ./Configure $SSL_TARGET -D__ANDROID_API__=$API_LEVEL &amp;&amp; \</span><br><span class="line">    make -j128 SHLIB_EXT=.so &amp;&amp; \</span><br><span class="line">    make install SHLIB_EXT=.so DESTDIR=$DESTDIR || exit 128</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### set variables according to build-tagret #####</span></span></span><br><span class="line">for build_target in $BUILD_TARGETS</span><br><span class="line">do</span><br><span class="line">    case $build_target in</span><br><span class="line">    armeabi-v7a)</span><br><span class="line">        DESTDIR=&quot;$BUILD_DIR/armeabi-v7a&quot;</span><br><span class="line">        SSL_TARGET=&quot;android-arm&quot;</span><br><span class="line">    ;;</span><br><span class="line">    x86)</span><br><span class="line">        DESTDIR=&quot;$BUILD_DIR/x86&quot;</span><br><span class="line">        SSL_TARGET=&quot;android-x86&quot;</span><br><span class="line">    ;;</span><br><span class="line">    x86_64)</span><br><span class="line">        DESTDIR=&quot;$BUILD_DIR/x86_64&quot;</span><br><span class="line">        SSL_TARGET=&quot;android-x86_64&quot;</span><br><span class="line">    ;;</span><br><span class="line">    arm64-v8a)</span><br><span class="line">        DESTDIR=&quot;$BUILD_DIR/arm64-v8a&quot;</span><br><span class="line">        SSL_TARGET=&quot;android-arm64&quot;</span><br><span class="line">    ;;</span><br><span class="line">    esac</span><br><span class="line"></span><br><span class="line">    rm -rf $DESTDIR</span><br><span class="line">    build_the_thing</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">### copy libraries and includes to output-directory #####</span></span></span><br><span class="line">    mkdir -p $OUT_DIR/$build_target/include</span><br><span class="line">    cp -R $DESTDIR/usr/local/include/* $OUT_DIR/$build_target/include</span><br><span class="line">    cp -R $DESTDIR/usr/local/ssl/* $OUT_DIR/$build_target/</span><br><span class="line">    mkdir -p $OUT_DIR/$build_target/lib</span><br><span class="line">    cp -R $DESTDIR/usr/local/lib/*.so $OUT_DIR/$build_target/lib</span><br><span class="line">    cp -R $DESTDIR/usr/local/lib/*.a $OUT_DIR/$build_target/lib</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo Success</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>chmod 777 mkssl</p>
<p>执行命令编译: 例如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./mkssl -n /data/android/Sdk/ndk/25.2.9519653 -a 21 -t &quot;armeabi-v7a&quot; -o 1.1.1l -d ./ -h linux-x86_64</span><br></pre></td></tr></table></figure>

<p>根据不同的需求更改-t 后面的参数,例如x86</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./mkssl -n /data/android/Sdk/ndk/25.2.9519653 -a 21 -t &quot;x86&quot; -o 1.1.1l -d ./ -h linux-x86_64</span><br></pre></td></tr></table></figure>

<p>脚本的参数含义如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-n： NDK的根目录</span><br><span class="line"></span><br><span class="line">-a：ABI 的级别</span><br><span class="line"></span><br><span class="line">-t：ABI</span><br><span class="line"></span><br><span class="line">-o：openssl的版本</span><br><span class="line"></span><br><span class="line">-d：输出目录</span><br><span class="line"></span><br><span class="line">-h：host的架构</span><br></pre></td></tr></table></figure>

<p><strong>五. 拷贝动态库到指定目录</strong></p>
<p>参考第一张图，将openssl生成的动态库拷贝到mqtt目录下的libs中<br><img src="../../../../images/image-20231115194629348-170070677790713.png" alt="image-20231115194629348" style="zoom:67%;" /></p>
<p><strong>六. 拷贝头文件</strong></p>
<p>参考第一张图，将openssl生成的头文件拷贝到cpp中<br><img src="../../../../images/image-20231115194756254-170070679015915.png" alt="image-20231115194756254" style="zoom:67%;" /></p>
<p><strong>七. 在cmake中包含这些头文件</strong></p>
<p>关键语法如下：这句话的意思就是编译的时候根据不同的ABI去引用不同的头文件，我们这里包含了四个ABI的头文件</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_include_directories</span>(mqtt PUBLIC openssl/<span class="variable">$&#123;CMAKE_ANDROID_ARCH_ABI&#125;</span>/<span class="keyword">include</span>)</span><br></pre></td></tr></table></figure>

<p><strong>八. 编译就行了</strong></p>
<h4 id="九-封装待续……"><a href="#九-封装待续……" class="headerlink" title="九. 封装待续……."></a>九. 封装待续…….</h4>
            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <article id="post-Android进阶/NDK/蒋超大佬扫盲/7.mmkv编译" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/">NDK</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/">蒋超大佬扫盲</a>
    </div>

                        
                        
  



                        
                        
                    </div>
                
                
   

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <p> MMKV简介</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MMKV 是基于 mmap 内存映射的 key-value 组件，底层序列化/反序列化使用 protobuf 实现，性能高，稳定性强。从 2015 年中至今在微</span><br><span class="line">信上使用，其性能和稳定性经过了时间的验证。近期也已移植到 Android / macOS / Win32 / POSIX 平台，一并开源。</span><br></pre></td></tr></table></figure>

<p>github地址：<a target="_blank" rel="noopener" href="https://github.com/Tencent/MMKV">https://github.com/Tencent/MMKV</a></p>
<p>通过github的中文文档查看编译指导：<a target="_blank" rel="noopener" href="https://github.com/Tencent/MMKV/blob/master/README_CN.md">https://github.com/Tencent/MMKV/blob/master/README_CN.md</a></p>
<p>直接查看POSIX 指南（POSIX是可移植操作系统接口是IEEE为要在各种UNIX操作系统上运行软件，而定义API的一系列互相关联的标准的总称）</p>
<p>POSIX 安装指南原文：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">POSIX 安装指南</span><br><span class="line">基本要求</span><br><span class="line">MMKV 支持 Linux(Ubuntu, Arch Linux, CentOS, Gentoo)、Unix(macOS, FreeBSD, OpenBSD) 等 POSIX 平台；</span><br><span class="line">MMKV 需使用 CMake 3.8.0 或以上进行编译；</span><br><span class="line">C++ 编译器需支持 C++ 17 标准。</span><br><span class="line">通过 CMake 安装引入</span><br><span class="line">获取 MMKV 源码:</span><br><span class="line"></span><br><span class="line">git clone https://github.com/Tencent/MMKV.git</span><br><span class="line">打开你项目的 CMakeLists.txt, 添加这几行:</span><br><span class="line"></span><br><span class="line">add_subdirectory(mmkv/POSIX/src mmkv)</span><br><span class="line">target_link_libraries(MyApp mmkv)</span><br><span class="line">添加头文件 #include &quot;MMKV.h&quot;，就可以愉快地开始你的 MMKV 之旅了。</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line"></span><br><span class="line">你也可以编译运行 demo 工程来测试 MMKV：</span><br><span class="line"></span><br><span class="line">cd mmkv/POSIX</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake -DCMAKE_BUILD_TYPE=Release ..</span><br><span class="line">make</span><br><span class="line">cd demo &amp;&amp; ./demo</span><br><span class="line">MMKV 依赖 zlib 库。如果你的系统没有安装 zlib1g-dev 库也不用担心，MMKV 会使用内置的精简版(zlib v1.2.11)。</span><br><span class="line"></span><br><span class="line">如果你确定不需要加密功能，你可以在Core/MMKVPredef.h 文件中打开宏MMKV_DISABLE_CRYPT，以减小一些二进制大小。</span><br></pre></td></tr></table></figure>

<p>简略编译过程（将mmkv源码引入 ndk编译）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. git clone https://github.com/Tencent/MMKV.git</span><br><span class="line">2. 创建一个空的Android 工程</span><br><span class="line">3. 创建一个moudle，选择Android Native Livrary</span><br><span class="line">4. 将mmkv中的Core目录直接复制到新建的moudle中</span><br><span class="line">5. 修改CMakeList.txt</span><br></pre></td></tr></table></figure>

<p>关键部分如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># For more information about using CMake with Android Studio, read the</span><br><span class="line"># documentation: https://d.android.com/studio/projects/add-native-code.html.</span><br><span class="line"># For more examples on how to use CMake, see https://github.com/android/ndk-samples.</span><br><span class="line"></span><br><span class="line"># Sets the minimum CMake version required for this project.</span><br><span class="line">cmake_minimum_required(VERSION 3.22.1)</span><br><span class="line"></span><br><span class="line"># Declares the project name. The project name can be accessed via $&#123; PROJECT_NAME&#125;,</span><br><span class="line"># Since this is the top level CMakeLists.txt, the project name is also accessible</span><br><span class="line"># with $&#123;CMAKE_PROJECT_NAME&#125; (both CMake variables are in-sync within the top level</span><br><span class="line"># build script scope).</span><br><span class="line">project(&quot;mmkv&quot;)</span><br><span class="line"></span><br><span class="line"># 添加头文件,方便自己的源码中引用Core下的头文件</span><br><span class="line">include_directories(Core)</span><br><span class="line"></span><br><span class="line"># 添加mmkv的子CMakeList,在编译时会首先执行子目录的CMakeList</span><br><span class="line">add_subdirectory(Core)</span><br><span class="line"></span><br><span class="line"># Creates and names a library, sets it as either STATIC</span><br><span class="line"># or SHARED, and provides the relative paths to its source code.</span><br><span class="line"># You can define multiple libraries, and CMake builds them for you.</span><br><span class="line"># Gradle automatically packages shared libraries with your APK.</span><br><span class="line">#</span><br><span class="line"># In this top level CMakeLists.txt, $&#123;CMAKE_PROJECT_NAME&#125; is used to define</span><br><span class="line"># the target library name; in the sub-module&#x27;s CMakeLists.txt, $&#123;PROJECT_NAME&#125;</span><br><span class="line"># is preferred for the same purpose.</span><br><span class="line">#</span><br><span class="line"># In order to load a library into your app from Java/Kotlin, you must call</span><br><span class="line"># System.loadLibrary() and pass the name of the library defined here;</span><br><span class="line"># for GameActivity/NativeActivity derived applications, the same library name must be</span><br><span class="line"># used in the AndroidManifest.xml file.</span><br><span class="line">add_library($&#123;CMAKE_PROJECT_NAME&#125; SHARED</span><br><span class="line">        # List C/C++ source files with relative paths to this CMakeLists.txt.</span><br><span class="line">        # 添加源文件，这个源文件可加可不加，随意</span><br><span class="line">        libmmkv.cpp</span><br><span class="line">        mmkv.cpp)</span><br><span class="line"></span><br><span class="line"># Specifies libraries CMake should link to your target library. You</span><br><span class="line"># can link libraries from various origins, such as libraries defined in this</span><br><span class="line"># build script, prebuilt third-party libraries, or Android system libraries.</span><br><span class="line">target_link_libraries($&#123;CMAKE_PROJECT_NAME&#125;</span><br><span class="line">			 mmkv</span><br><span class="line">        core</span><br><span class="line">        # pthread  这里注意，不能链接pthread，在NDK中使用stdc++</span><br><span class="line">        stdc++</span><br><span class="line">        # List libraries link to the target library</span><br><span class="line">        android</span><br><span class="line">        log)</span><br></pre></td></tr></table></figure>

<p>然后直接编译项目即可，具体封装可按照mmkv的api文档进行。详细内容可直接给项目导入Android studio查看</p>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <article id="post-Android进阶/NDK/蒋超大佬扫盲/6.libusb" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/">NDK</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/">蒋超大佬扫盲</a>
    </div>

                        
                        
  



                        
                        
                    </div>
                
                
   

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <p> libusb简介</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">libusb 是一个 C 库，提供对 USB 设备的通用访问。开发人员旨在使用它来促进与 USB 硬件通信的应用程序的生产。</span><br><span class="line">它是可移植的：使用单个跨平台 API，它提供对 Linux、macOS、Windows 等 USB 设备的访问</span><br><span class="line">它是用户模式：应用程序与设备通信不需要特殊权限或提升权限。</span><br><span class="line">它与版本无关：支持从 1.0 到 3.1（最新）的所有 USB 协议版本。</span><br></pre></td></tr></table></figure>

<p>官网：<a target="_blank" rel="noopener" href="https://libusb.info/">https://libusb.info/</a></p>
<p>仓库：<a target="_blank" rel="noopener" href="https://github.com/libusb/libusb/tree/master">https://github.com/libusb/libusb/tree/master</a></p>
<pre><code>git clone https://github.com/libusb/libusb.git
</code></pre>
<p><strong>编译</strong></p>
<p>官方的android目录下的编译指导文档原文：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">libusb for Android</span><br><span class="line">==================</span><br><span class="line"></span><br><span class="line">Building:</span><br><span class="line">---------</span><br><span class="line"></span><br><span class="line">To build libusb for Android do the following:</span><br><span class="line"></span><br><span class="line"> 1. Download the latest NDK from:</span><br><span class="line">    http://developer.android.com/tools/sdk/ndk/index.html</span><br><span class="line"></span><br><span class="line"> 2. Extract the NDK.</span><br><span class="line"></span><br><span class="line"> 3. Open a shell and make sure there exist an NDK global variable</span><br><span class="line">    set to the directory where you extracted the NDK.</span><br><span class="line"></span><br><span class="line"> 4. Change directory to libusb&#x27;s &quot;android/jni&quot;</span><br><span class="line"></span><br><span class="line"> 5. Run &quot;$NDK/ndk-build&quot;.</span><br><span class="line"></span><br><span class="line">The libusb library, examples and tests can then be found in:</span><br><span class="line">    &quot;android/libs/$ARCH&quot;</span><br><span class="line"></span><br><span class="line">Where $ARCH is one of:</span><br><span class="line">    armeabi</span><br><span class="line">    armeabi-v7a</span><br><span class="line">    mips</span><br><span class="line">    mips64</span><br><span class="line">    x86</span><br><span class="line">    x86_64</span><br><span class="line"></span><br><span class="line">Installing:</span><br><span class="line">-----------</span><br><span class="line"></span><br><span class="line">If you wish to use libusb from native code in own Android application</span><br><span class="line">then you should add the following line to your Android.mk file:</span><br><span class="line"></span><br><span class="line">  include $(PATH_TO_LIBUSB_SRC)/android/jni/libusb.mk</span><br><span class="line"></span><br><span class="line">You will then need to add the following lines to the build</span><br><span class="line">configuration for each native binary which uses libusb:</span><br><span class="line"></span><br><span class="line">  LOCAL_C_INCLUDES += $(LIBUSB_ROOT_ABS)</span><br><span class="line">  LOCAL_SHARED_LIBRARIES += libusb1.0</span><br><span class="line"></span><br><span class="line">The Android build system will then correctly include libusb in the</span><br><span class="line">application package (APK) file, provided ndk-build is invoked before</span><br><span class="line">the package is built.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Runtime Permissions:</span><br><span class="line">--------------------</span><br><span class="line"></span><br><span class="line">The Runtime Permissions on Android can be transferred from Java to Native</span><br><span class="line">over the following approach:</span><br><span class="line"></span><br><span class="line">  JAVA:</span><br><span class="line"></span><br><span class="line">   --&gt; Obtain USB permissions over the android.hardware.usb.UsbManager class</span><br><span class="line"></span><br><span class="line">      usbManager = (UsbManager) getSystemService(Context.USB_SERVICE);</span><br><span class="line">      HashMap&lt;String, UsbDevice&gt; deviceList = usbManager.getDeviceList();</span><br><span class="line">      for (UsbDevice usbDevice : deviceList.values()) &#123;</span><br><span class="line">          usbManager.requestPermission(usbDevice, mPermissionIntent);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">   --&gt; Get the native FileDescriptor of the UsbDevice and transfer it to</span><br><span class="line">       Native over JNI or JNA</span><br><span class="line"></span><br><span class="line">      UsbDeviceConnection usbDeviceConnection = usbManager.openDevice(camDevice);</span><br><span class="line">      int fileDescriptor = usbDeviceConnection.getFileDescriptor();</span><br><span class="line"></span><br><span class="line">   --&gt; JNA sample method:</span><br><span class="line"></span><br><span class="line">      JNA.INSTANCE.set_the_native_Descriptor(fileDescriptor);</span><br><span class="line"></span><br><span class="line">  NATIVE:</span><br><span class="line"></span><br><span class="line">   --&gt; Initialize libusb on Android</span><br><span class="line"></span><br><span class="line">      set_the_native_Descriptor(int fileDescriptor) &#123;</span><br><span class="line">          libusb_context *ctx;</span><br><span class="line">          libusb_device_handle *devh;</span><br><span class="line">          libusb_set_option(&amp;ctx, LIBUSB_OPTION_NO_DEVICE_DISCOVERY, NULL);</span><br><span class="line">          libusb_init(&amp;ctx);</span><br><span class="line">          libusb_wrap_sys_device(NULL, (intptr_t)fileDescriptor, &amp;devh);</span><br><span class="line">      &#125;</span><br><span class="line">      /* From this point you can regularly use all libusb functions as usual */</span><br><span class="line"></span><br><span class="line">   About LIBUSB_OPTION_NO_DEVICE_DISCOVERY:</span><br><span class="line"></span><br><span class="line">    The method libusb_set_option(&amp;ctx, LIBUSB_OPTION_NO_DEVICE_DISCOVERY, NULL)</span><br><span class="line">    does not affect the ctx.</span><br><span class="line">    It allows initializing libusb on unrooted Android devices by skipping</span><br><span class="line">    the device enumeration.</span><br><span class="line"></span><br><span class="line">Rooted Devices:</span><br><span class="line">---------------</span><br><span class="line"></span><br><span class="line">    For rooted devices the code using libusb could be executed as root</span><br><span class="line">    using the &quot;su&quot; command. An alternative would be to use the &quot;su&quot; command</span><br><span class="line">    to change the permissions on the appropriate /dev/bus/usb/ files.</span><br><span class="line"></span><br><span class="line">    Users have reported success in using android.hardware.usb.UsbManager</span><br><span class="line">    to request permission to use the UsbDevice and then opening the</span><br><span class="line">    device. The difficulties in this method is that there is no guarantee</span><br><span class="line">    that it will continue to work in the future Android versions, it</span><br><span class="line">    requires invoking Java APIs and running code to match each</span><br><span class="line">    android.hardware.usb.UsbDevice to a libusb_device.</span><br><span class="line"></span><br><span class="line">    For a rooted device it is possible to install libusb into the system</span><br><span class="line">    image of a running device:</span><br><span class="line"></span><br><span class="line">     1. Enable ADB on the device.</span><br><span class="line"></span><br><span class="line">     2. Connect the device to a machine running ADB.</span><br><span class="line"></span><br><span class="line">     3. Execute the following commands on the machine</span><br><span class="line">        running ADB:</span><br><span class="line"></span><br><span class="line">        # Make the system partition writable</span><br><span class="line">        adb shell su -c &quot;mount -o remount,rw /system&quot;</span><br><span class="line"></span><br><span class="line">        # Install libusb</span><br><span class="line">        adb push obj/local/armeabi/libusb1.0.so /sdcard/</span><br><span class="line">        adb shell su -c &quot;cat &gt; /system/lib/libusb1.0.so &lt; /sdcard/libusb1.0.so&quot;</span><br><span class="line">        adb shell rm /sdcard/libusb1.0.so</span><br><span class="line"></span><br><span class="line">        # Install the samples and tests</span><br><span class="line">        for B in listdevs fxload xusb sam3u_benchmark hotplugtest stress</span><br><span class="line">        do</span><br><span class="line">          adb push &quot;obj/local/armeabi/$B&quot; /sdcard/</span><br><span class="line">          adb shell su -c &quot;cat &gt; /system/bin/$B &lt; /sdcard/$B&quot;</span><br><span class="line">          adb shell su -c &quot;chmod 0755 /system/bin/$B&quot;</span><br><span class="line">          adb shell rm &quot;/sdcard/$B&quot;</span><br><span class="line">        done</span><br><span class="line"></span><br><span class="line">        # Make the system partition read only again</span><br><span class="line">        adb shell su -c &quot;mount -o remount,ro /system&quot;</span><br><span class="line"></span><br><span class="line">        # Run listdevs to</span><br><span class="line">        adb shell su -c &quot;listdevs&quot;</span><br><span class="line"></span><br><span class="line">     4. If your device only has a single OTG port then ADB can generally</span><br><span class="line">        be switched to using Wifi with the following commands when connected</span><br><span class="line">        via USB:</span><br><span class="line"></span><br><span class="line">        adb shell netcfg</span><br><span class="line">        # Note the wifi IP address of the phone</span><br><span class="line">        adb tcpip 5555</span><br><span class="line">        # Use the IP address from netcfg</span><br><span class="line">        adb connect 192.168.1.123:5555</span><br></pre></td></tr></table></figure>

<p>执行编译</p>
<pre><code>1.cd libusb
2.cd android/jni
3.找到自己的ndk目录，例如下面直接使用绝对路径 /home/tyl/Android/Sdk/ndk/26.1.10909125
4./home/tyl/Android/Sdk/ndk/26.1.10909125/ndk-build
5.生成的so文件在libusb/android/libs中
</code></pre>
<p>编译好的库可以直接集成到Android中了。</p>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <article id="post-Android进阶/NDK/蒋超大佬扫盲/5.OPUS编译" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/">NDK</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/">蒋超大佬扫盲</a>
    </div>

                        
                        
  



                        
                        
                    </div>
                
                
   

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <p>opus官网：<a target="_blank" rel="noopener" href="https://opus-codec.org/">https://opus-codec.org</a></p>
<p>github:<a target="_blank" rel="noopener" href="https://github.com/xiph/opus">https://github.com/xiph/opus</a></p>
<p>opus简介</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Opus 是一个完全开放、免版税、高度通用的音频编解码器。Opus 在互动方面无与伦比 通过互联网传输语音和音乐，但也用于存储和流式传输</span><br><span class="line">应用。它被互联网工程任务组 （IETF） 标准化为 RFC 6716，它结合了 Skype 的 SILK 编解码器和 Xiph.Org 的 CELT 编解码器的技术;</span><br></pre></td></tr></table></figure>

<p>下载opus</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.官网download页面找到Source code: opus-1.4.tar.gz，点击后自动下载</span><br><span class="line">2.通过github的cmake页面内的指南:git clone https://gitlab.xiph.org/xiph/opus</span><br><span class="line">（https://github.com/xiph/opus/tree/master/cmake）</span><br></pre></td></tr></table></figure>

<p>编译opus</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">通过查看cmake内的编译介绍</span><br><span class="line">1.cd opus</span><br><span class="line">2.mkdir build</span><br><span class="line">3.cd build</span><br><span class="line">4.cmake .. -DCMAKE_TOOLCHAIN_FILE=/home/tyl/Android/Sdk/ndk/26.1.10909125/build/cmake/android.toolchain.cmake -DANDROID_ABI=arm64-v8a</span><br><span class="line">//需要修改为本机的ndk路径，执行成功</span><br><span class="line">5.make  </span><br><span class="line">//执行完成后在build目录中就会看到libopus.a</span><br><span class="line">//如果需要so文件则需要进行配置 -DOPUS_BUILD_SHARED_LIBRARY=y </span><br><span class="line">6.cmake .. -DCMAKE_TOOLCHAIN_FILE=/home/tyl/Android/Sdk/ndk/26.1.10909125/build/cmake/android.toolchain.cmake -DANDROID_ABI=arm64-v8a -DOPUS_BUILD_SHARED_LIBRARY=y</span><br><span class="line">7.make</span><br><span class="line">//执行完毕后build目录下可以看到libopus.so文件</span><br></pre></td></tr></table></figure>

<p>自建编译脚本android.sh (自定义名字)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># 每次编译删除原来的编译文件</span><br><span class="line">rm build -rf</span><br><span class="line">rm install -rf</span><br><span class="line"># 创建临时编译目录，避免污染源文件</span><br><span class="line">mkdir build</span><br><span class="line"># 定义一个数组，存储架构类型，用来循环编译</span><br><span class="line">ARCH_ARRAY=(armeabi-v7a arm64-v8a x86 x86_64)</span><br><span class="line">mkdir install</span><br><span class="line">cd build</span><br><span class="line"></span><br><span class="line">for item in &quot;$&#123;ARCH_ARRAY【@】&#125;&quot;; do</span><br><span class="line">    mkdir -p install/$item</span><br><span class="line">    echo &quot;$item&quot;</span><br><span class="line">    echo &quot;$ANDROID_HOME&quot;</span><br><span class="line">    rm * -rf</span><br><span class="line">    cmake ..  \</span><br><span class="line">        -DCMAKE_TOOLCHAIN_FILE=$&#123;ANDROID_HOME&#125;/ndk/26.1.10909125/build/cmake/android.toolchain.cmake \</span><br><span class="line">        -DANDROID_ABI=$item \</span><br><span class="line">        -DOPUS_BUILD_SHARED_LIBRARY=y</span><br><span class="line">    make -j8</span><br><span class="line">    mkdir -p ../install/$item</span><br><span class="line">    mv *.so  ../install/$item/</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># 拷贝头文件到安装目录</span><br><span class="line">cp ../include -rf ../install                                                                                                                                                                                                 </span><br></pre></td></tr></table></figure>


            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <article id="post-Android进阶/NDK/蒋超大佬扫盲/4.JavaVM" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/">NDK</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/">蒋超大佬扫盲</a>
    </div>

                        
                        
  



                        
                        
                    </div>
                
                
   

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <p> <strong>一. NDK开发之JavaVM</strong></p>
<p>​	JNI定义了两个关键数据结构，一个是JavaVM，一个是JNIEnv,在前面我们看jni.h的时候也看到了，只是没有仔细查看他们的定义，这里先看第一个JavaVM，本质上，JavaVM是一个指向函数表的二级指针(在C++版本中，它们是一些类，这些类具有指向函数表的指针，并具有每个通过该函数表间接调用的JNI函数的成员函数。)JavaVM提供”调用接口”函数，我们可以利用此类的函数创建和销毁JavaVM。<strong>理论上，每个进程可以有多个JavaVM，但在Android中只允许有一个。</strong></p>
<p>上面这段话为官方原话，但对于初学者来讲，可能还不是很好理解，所以我们就以官方所描述的内容进行讲解分析。</p>
<p>首先，说JavaVM本质上是一个二级指针，也就是我们说的指针的指针;</p>
<p><strong>首先说指针</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">概念，它其实就是内存地址，比如说我们有一个变量，存放在某个位置，那么这个位置的地址就是这个位置的指针，指向这个位置。举个最简单</span><br><span class="line">	的例子就是，我们一般会在C语言中申请一块空间来存储东西，申请空间一般用malloc，这个函数返回了一个void *类型的返回值，返回的</span><br><span class="line">	这个值就是这块空间的地址。</span><br><span class="line"></span><br><span class="line">我们拿着这个地址就可以去操作这块空间了。</span><br></pre></td></tr></table></figure>

<p><strong>指针变量</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">指针变量首先是一个变量，它和我们平时定义的int，char，float，double等等变量没有任何区别，本身都是用来存数据的，只是int，</span><br><span class="line">	char，float，double等存的是一个值，而指针变量存放的是一个地址，这个地址指向了一块空间。</span><br></pre></td></tr></table></figure>

<p>理解了这两个概念，我们再说几个常见的概念：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">函数指针：指向函数的指针，我们拿着这个指针就可以直接调用这个函数。</span><br><span class="line">结构体指针：指向结构体的指针，我们拿着这个指针就可以操作结构体。</span><br></pre></td></tr></table></figure>

<p>所以，简单理解，我们有指针就可以做相关的操作。</p>
<p>指针和指针的指针(所谓二级指针)：</p>
<p>指针，也叫一级指针，它指向的是直接可以操作的内存空间。</p>
<p>指针的指针，也叫二级指针，它指向的是一级指针，一级指针指向的是可以操作的内存空间。如下图，一级指针直接指向可操作的内存空间，指针的指针是指向了指针，然后通过指针再指向可操作的内存空间(图中的102也是一个指针)。</p>
<img src="../../../../images/image-20230813102620884-17006187636953.png" alt="image-20230813102620884" style="zoom:67%;" />

<p>在了解了上面的基本概念之后，补充一下在C中和C++中调用上的一些区别，我们看一下jni.h</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * JNI invocation interface.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">JNIInvokeInterface</span> &#123;</span><br><span class="line">    <span class="type">void</span>*       reserved0;</span><br><span class="line">    <span class="type">void</span>*       reserved1;</span><br><span class="line">    <span class="type">void</span>*       reserved2;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">jint</span>        (*DestroyJavaVM)(JavaVM*);</span><br><span class="line">    <span class="built_in">jint</span>        (*AttachCurrentThread)(JavaVM*, JNIEnv**, <span class="type">void</span>*);</span><br><span class="line">    <span class="built_in">jint</span>        (*DetachCurrentThread)(JavaVM*);</span><br><span class="line">    <span class="built_in">jint</span>        (*GetEnv)(JavaVM*, <span class="type">void</span>**, jint);</span><br><span class="line">    <span class="built_in">jint</span>        (*AttachCurrentThreadAsDaemon)(JavaVM*, JNIEnv**, <span class="type">void</span>*);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * C++ version.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">_JavaVM</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="keyword">struct</span> <span class="title class_">JNIInvokeInterface</span>* functions;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(__cplusplus)</span></span><br><span class="line">    <span class="function">jint <span class="title">DestroyJavaVM</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">DestroyJavaVM</span>(<span class="keyword">this</span>); &#125;</span><br><span class="line">    <span class="function">jint <span class="title">AttachCurrentThread</span><span class="params">(JNIEnv** p_env, <span class="type">void</span>* thr_args)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">AttachCurrentThread</span>(<span class="keyword">this</span>, p_env, thr_args); &#125;</span><br><span class="line">    <span class="function">jint <span class="title">DetachCurrentThread</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">DetachCurrentThread</span>(<span class="keyword">this</span>); &#125;</span><br><span class="line">    <span class="function">jint <span class="title">GetEnv</span><span class="params">(<span class="type">void</span>** env, jint version)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">GetEnv</span>(<span class="keyword">this</span>, env, version); &#125;</span><br><span class="line">    <span class="function">jint <span class="title">AttachCurrentThreadAsDaemon</span><span class="params">(JNIEnv** p_env, <span class="type">void</span>* thr_args)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">AttachCurrentThreadAsDaemon</span>(<span class="keyword">this</span>, p_env, thr_args); &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/*__cplusplus*/</span></span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里，可以看出来，对于C++来说，JavaVM是一个结构体(C++中结构体和C中的不太一样，C++中允许有函数，和类相似)，结构体中有很</span></span><br><span class="line"><span class="comment">//多的成员函数，这个类等于说是一个代理，它帮我们调用了JNIInvokeInterface中的函数。</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(__cplusplus)</span></span><br><span class="line"><span class="keyword">typedef</span> _JNIEnv JNIEnv;</span><br><span class="line"><span class="keyword">typedef</span> _JavaVM JavaVM;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="comment">// 而C语言版本中，JavaVM是一个JNIInvokeInterface*类型的指针变量，这里注意一下，正是因为这样，在C和C++中，才会出现使用上的</span></span><br><span class="line"><span class="comment">//差别。</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">const</span> <span class="keyword">struct</span> <span class="title class_">JNINativeInterface</span>* JNIEnv;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">const</span> <span class="keyword">struct</span> <span class="title class_">JNIInvokeInterface</span>* JavaVM;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>知道了他们的调用区别之后，再看一下JavaVM到底有什么用,那就要看他的函数了</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * C++ version.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">_JavaVM</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="keyword">struct</span> <span class="title class_">JNIInvokeInterface</span>* functions;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(__cplusplus)</span></span><br><span class="line">    <span class="function">jint <span class="title">DestroyJavaVM</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="comment">// 释放JavaVM</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">DestroyJavaVM</span>(<span class="keyword">this</span>); &#125;</span><br><span class="line">    <span class="comment">// 将当前线程附着到虚拟机</span></span><br><span class="line">    <span class="function">jint <span class="title">AttachCurrentThread</span><span class="params">(JNIEnv** p_env, <span class="type">void</span>* thr_args)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">AttachCurrentThread</span>(<span class="keyword">this</span>, p_env, thr_args); &#125;</span><br><span class="line">    <span class="comment">// 讲当前线程和虚拟机分离</span></span><br><span class="line">    <span class="function">jint <span class="title">DetachCurrentThread</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">DetachCurrentThread</span>(<span class="keyword">this</span>); &#125;</span><br><span class="line">    <span class="comment">// 获取ENV</span></span><br><span class="line">    <span class="function">jint <span class="title">GetEnv</span><span class="params">(<span class="type">void</span>** env, jint version)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">GetEnv</span>(<span class="keyword">this</span>, env, version); &#125;</span><br><span class="line">    <span class="comment">// AttachCurrentThreadAsDaemon()函数在JNI中的作用是将当前线程附加到Java虚拟机中作为一个守护线程，以便在非Java线程中调用Java API，并使得当所有非守护线程结束时，Java虚拟机可以退出。</span></span><br><span class="line">    <span class="function">jint <span class="title">AttachCurrentThreadAsDaemon</span><span class="params">(JNIEnv** p_env, <span class="type">void</span>* thr_args)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">AttachCurrentThreadAsDaemon</span>(<span class="keyword">this</span>, p_env, thr_args); &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/*__cplusplus*/</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>通过上面的注释可以看到，JavaVM提供了获取JNIEnv的函数，将当前线程附着到java虚拟机中以及分离等功能。</p>
<p>本质上就是和javaVM取得联系，使得我们可以和java端进行通信，因为虚拟机并不知道我们C&#x2F;C++层的线程，所以他们不能直接通信，所以，需要将线程附着到虚拟机上，这样我们就可以获得虚拟机的环境，从而和Java端通信。</p>
<p><strong>二. NDK开发之JNIEnv</strong></p>
<p>​	前面了解了JavaVM之后，我们再看一下JNIEnv，了解一下它是干什么的。同样的，看一下它的实现。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * C++ object wrapper.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is usually overlaid on a C struct whose first element is a</span></span><br><span class="line"><span class="comment"> * JNINativeInterface*.  We rely somewhat on compiler behavior.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">_JNIEnv</span> &#123;</span><br><span class="line">    <span class="comment">/* do not rename this; it does not seem to be entirely opaque */</span></span><br><span class="line">    <span class="type">const</span> <span class="keyword">struct</span> <span class="title class_">JNINativeInterface</span>* functions;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(__cplusplus)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// ... 省略若干</span></span><br><span class="line">    <span class="function">jstring <span class="title">NewString</span><span class="params">(<span class="type">const</span> jchar* unicodeChars, jsize len)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">NewString</span>(<span class="keyword">this</span>, unicodeChars, len); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jsize <span class="title">GetStringLength</span><span class="params">(jstring string)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">GetStringLength</span>(<span class="keyword">this</span>, string); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">const</span> jchar* <span class="title">GetStringChars</span><span class="params">(jstring string, jboolean* isCopy)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">GetStringChars</span>(<span class="keyword">this</span>, string, isCopy); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ReleaseStringChars</span><span class="params">(jstring string, <span class="type">const</span> jchar* chars)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;<span class="built_in">ReleaseStringChars</span>(<span class="keyword">this</span>, string, chars); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jstring <span class="title">NewStringUTF</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* bytes)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">NewStringUTF</span>(<span class="keyword">this</span>, bytes); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jsize <span class="title">GetStringUTFLength</span><span class="params">(jstring string)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">GetStringUTFLength</span>(<span class="keyword">this</span>, string); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">const</span> <span class="type">char</span>* <span class="title">GetStringUTFChars</span><span class="params">(jstring string, jboolean* isCopy)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">GetStringUTFChars</span>(<span class="keyword">this</span>, string, isCopy); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ReleaseStringUTFChars</span><span class="params">(jstring string, <span class="type">const</span> <span class="type">char</span>* utf)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;<span class="built_in">ReleaseStringUTFChars</span>(<span class="keyword">this</span>, string, utf); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jsize <span class="title">GetArrayLength</span><span class="params">(jarray array)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">GetArrayLength</span>(<span class="keyword">this</span>, array); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobjectArray <span class="title">NewObjectArray</span><span class="params">(jsize length, jclass elementClass,</span></span></span><br><span class="line"><span class="params"><span class="function">        jobject initialElement)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">NewObjectArray</span>(<span class="keyword">this</span>, length, elementClass,</span><br><span class="line">        initialElement); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">jobject <span class="title">GetObjectArrayElement</span><span class="params">(jobjectArray array, jsize index)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> functions-&gt;<span class="built_in">GetObjectArrayElement</span>(<span class="keyword">this</span>, array, index); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SetObjectArrayElement</span><span class="params">(jobjectArray array, jsize index, jobject value)</span></span></span><br><span class="line"><span class="function">    </span>&#123; functions-&gt;<span class="built_in">SetObjectArrayElement</span>(<span class="keyword">this</span>, array, index, value); &#125;</span><br><span class="line">	<span class="comment">// ... 省略若干</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/*__cplusplus*/</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>看一下上面的函数，时不是很眼熟，就是前面我们讲过的常用函数的使用，所以JNIEnv的作用就是提供了我们和JavaVM通信的一些接口函数。</p>
<p>另外，它和JavaVM一样，也分别定义了C++和C的版本。原理也是一样的，在C++中通过一个结构体封装了一下，C中直接使用的是指针重命名的。所以调用上也和JavaVM一样。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++中</span></span><br><span class="line">env-&gt;xxxxx();</span><br><span class="line"><span class="comment">// C中(这里为什么要带*，是因为它是一个指针的指针)</span></span><br><span class="line">(*env)-&gt;xxxxx();</span><br></pre></td></tr></table></figure>

<p><strong>三. 全局引用和局部引用和弱全局引用</strong></p>
<p><strong>局部引用：</strong></p>
<p>引用在C++和java以及一些面向对象的语言中都存在，对于传递给原生方法的每个参数，以及JNI函数返回的几乎每个对象都属于局部引用，这意味着，局部引用在当前线程中的当前原生方法运行期间有效。在原生方法返回后，即使对象本身继续存在，该引用也无效。</p>
<p>这适用于jobject的所有子类，包括jclass、jstring和jarray。<br>所有我们在函数中直接获取到的对象都是局部的，如果想让它在全局可用，需要将他变成全局引用。</p>
<p><strong>这个规则对于JNIEnv不适用，它属于线程。</strong></p>
<p><strong>全局引用：</strong>局部引用在函数返回后便不能使用了，但如果想让局部引用在函数返回后依旧可以使用，就要将它变成全局的。</p>
<p>将一个局部引用变成全局引用可以通过NewGLobalRef方法,比如我们不想在每个地方都去获取java的class对象，就可以在一次获取后，将他变成全局的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">jclass localClazz;</span><br><span class="line">jclass globalClazz;</span><br><span class="line"></span><br><span class="line">jclass localClass = env-&gt;<span class="built_in">FindClass</span>(<span class="string">&quot;MyClass&quot;</span>);</span><br><span class="line">jclass globalClass = <span class="built_in">reinterpret_cast</span>&lt;jclass&gt;(env-&gt;<span class="built_in">NewGlobalRef</span>(localClass));</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO 记住，一定要记住，在不使用它的时候要进行释放，否则，内存泄漏</span></span><br><span class="line">env-&gt;<span class="built_in">DeleteGlobalRef</span>(globalClass);</span><br></pre></td></tr></table></figure>

<p>以上两种是我们比较常用的，还有一种引用叫弱全局引用</p>
<p><strong>弱全局引用：</strong></p>
<p>它是全局引用的一种类型，与全局引用一样，它也可以在方法返回之后，依旧可以使用，但和全局引用不同的是弱全局引用不会阻止潜在的对象被垃圾回收，所以使用的时候记得检测这个对象是否还有效，避免崩溃。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">jclass localClazz;</span><br><span class="line">jclass weakGlobalClazz;</span><br><span class="line"></span><br><span class="line">jclass localClass = env-&gt;<span class="built_in">FindClass</span>(<span class="string">&quot;MyClass&quot;</span>);</span><br><span class="line"><span class="comment">// 将局部引用变成弱全局引用</span></span><br><span class="line">jclass weakGlobalClazz = <span class="built_in">reinterpret_cast</span>&lt;jclass&gt;(env-&gt;<span class="built_in">NewWeakGlobalRef</span>(localClass));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用时检查,IsSameObject判断两个引用是否引用同一对象，必须使用 IsSameObject 函数，不能用 ==</span></span><br><span class="line"><span class="comment">// 这里和NULL比较，如果不同，说明有效</span></span><br><span class="line"><span class="keyword">if</span> (JNI_FALSE == env-&gt;<span class="built_in">IsSameObject</span>(weakGlobalClazz, <span class="literal">NULL</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 说明对象还存活，可以使用</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// 被回收了，不能再用了</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>四. JNI_OnLoad</strong></p>
<p>最后一个知识点，JNI_OnLoad,这个函数我们还没有使用过，这是一个被系统调用的函数，当库被加载的时候，系统会主动调用它。</p>
<p>那么它有什么用处？</p>
<p>一般情况下，我们在这个函数中获取JavaVM 对象保存到全局。 或者在这里动态注册JNI函数。再或者在这里获取一些类的class缓存起来。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">JNIEXPORT jint <span class="title">JNI_OnLoad</span><span class="params">(JavaVM* vm, <span class="type">void</span>* reserved)</span> </span>&#123;</span><br><span class="line">        JNIEnv* env;</span><br><span class="line">        <span class="keyword">if</span> (vm-&gt;<span class="built_in">GetEnv</span>(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">void</span>**&gt;(&amp;env), JNI_VERSION_1_6) != JNI_OK) &#123;</span><br><span class="line">            <span class="keyword">return</span> JNI_ERR;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Find your class. JNI_OnLoad is called from the correct class loader context for this to work.</span></span><br><span class="line">        jclass c = env-&gt;<span class="built_in">FindClass</span>(<span class="string">&quot;com/example/app/package/MyClass&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="literal">nullptr</span>) <span class="keyword">return</span> JNI_ERR;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register your class&#x27; native methods.</span></span><br><span class="line">        <span class="type">static</span> <span class="type">const</span> JNINativeMethod methods[] = &#123;</span><br><span class="line">            &#123;<span class="string">&quot;nativeFoo&quot;</span>, <span class="string">&quot;()V&quot;</span>, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">void</span>*&gt;(nativeFoo)&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;nativeBar&quot;</span>, <span class="string">&quot;(Ljava/lang/String;I)Z&quot;</span>, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">void</span>*&gt;(nativeBar)&#125;,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">int</span> rc = env-&gt;<span class="built_in">RegisterNatives</span>(c, methods, <span class="built_in">sizeof</span>(methods)/<span class="built_in">sizeof</span>(JNINativeMethod));</span><br><span class="line">        <span class="keyword">if</span> (rc != JNI_OK) <span class="keyword">return</span> rc;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JNI_VERSION_1_6;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>以上就是今天所讲解的全部内容了。这章内容稍微偏理论，我们将在下节课讲解其他内容时用到上面的所有知识点，所以务必掌握。</p>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <article id="post-Android进阶/NDK/蒋超大佬扫盲/3.JNI数据类型" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/">Android进阶</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/">NDK</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Android%E8%BF%9B%E9%98%B6/NDK/%E8%92%8B%E8%B6%85%E5%A4%A7%E4%BD%AC%E6%89%AB%E7%9B%B2/">蒋超大佬扫盲</a>
    </div>

                        
                        
  



                        
                        
                    </div>
                
                
   

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <p>在jni中，数据类型和java中的数据类型是不同的，在了解java和jni类型之间的关系之后，我们才能更好的在java和native之间传递数据。</p>
<p><strong>数据类型的分类</strong></p>
<p>基本类型</p>
<table>
<thead>
<tr>
<th>java</th>
<th>jni</th>
<th>C&#x2F;C++</th>
<th>大小</th>
</tr>
</thead>
<tbody><tr>
<td>boolean</td>
<td>jboolean</td>
<td>uint8_t</td>
<td>无符号8位</td>
</tr>
<tr>
<td>byte</td>
<td>jbyte</td>
<td>int8_t</td>
<td>有符号8位</td>
</tr>
<tr>
<td>char</td>
<td>jchar</td>
<td>uint16_t</td>
<td>无符号16位</td>
</tr>
<tr>
<td>short</td>
<td>jshort</td>
<td>int16_t</td>
<td>有符号16位</td>
</tr>
<tr>
<td>int</td>
<td>jint</td>
<td>int32_t</td>
<td>有符号32位</td>
</tr>
<tr>
<td>long</td>
<td>jlong</td>
<td>int64_t</td>
<td>有符号64位</td>
</tr>
<tr>
<td>float</td>
<td>jfloat</td>
<td>float</td>
<td>32位</td>
</tr>
<tr>
<td>double</td>
<td>jdouble</td>
<td>double</td>
<td>64位</td>
</tr>
</tbody></table>
<p>引用类型</p>
<table>
<thead>
<tr>
<th>java</th>
<th>jni</th>
<th>C</th>
<th>C++</th>
</tr>
</thead>
<tbody><tr>
<td>java.lang.Class</td>
<td>jclass</td>
<td>jobject</td>
<td>_jclass*</td>
</tr>
<tr>
<td>java.lang.Throwable</td>
<td>jthrowable</td>
<td>jobject</td>
<td>_jthrowable*</td>
</tr>
<tr>
<td>java.lang.String</td>
<td>jstring</td>
<td>jobject</td>
<td>_jstring *</td>
</tr>
<tr>
<td>Other objects</td>
<td>jobject</td>
<td>void *</td>
<td>_jobject*</td>
</tr>
<tr>
<td>java.lang.Object[]</td>
<td>jobjectArray</td>
<td>jarray</td>
<td>_jobjectArray*</td>
</tr>
<tr>
<td>boolean[]</td>
<td>jbooleanArray</td>
<td>jarray</td>
<td>_jbooleanArray*</td>
</tr>
<tr>
<td>byte[]</td>
<td>jbyteArray</td>
<td>jarray</td>
<td>_jbyteArray*</td>
</tr>
<tr>
<td>char[]</td>
<td>jcharArray</td>
<td>jarray</td>
<td>_jcharArray*</td>
</tr>
<tr>
<td>short[]</td>
<td>jshortArray</td>
<td>jarray</td>
<td>_jshortArray*</td>
</tr>
<tr>
<td>int[]</td>
<td>jintArray</td>
<td>jarray</td>
<td>_jintArray*</td>
</tr>
<tr>
<td>long[]</td>
<td>jlongArray</td>
<td>jarray</td>
<td>_jlongArray*</td>
</tr>
<tr>
<td>float[]</td>
<td>jfloatArray</td>
<td>jarray</td>
<td>_jfloatArray*</td>
</tr>
<tr>
<td>double[]</td>
<td>jdoubleArray</td>
<td>jarray</td>
<td>_jdoubleArray*</td>
</tr>
<tr>
<td>Other arrays</td>
<td>Jarray</td>
<td>jarray</td>
<td>jarray*</td>
</tr>
</tbody></table>
<p>对于引用类型，我们知道，在java中，所有类的父类都是java.long.Object,由于C语言中没有类的概念，所以在C语言中，使用void *代替，这是一个万能类型，在C++中定义了一个空的类 class _jobject {};来代替java中的类。</p>
<p>基本类型在jni.h中的定义：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Primitive types that match up with Java equivalents. */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint8_t</span>  jboolean; <span class="comment">/* unsigned 8 bits */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int8_t</span>   jbyte;    <span class="comment">/* signed 8 bits */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint16_t</span> jchar;    <span class="comment">/* unsigned 16 bits */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int16_t</span>  jshort;   <span class="comment">/* signed 16 bits */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int32_t</span>  jint;     <span class="comment">/* signed 32 bits */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int64_t</span>  jlong;    <span class="comment">/* signed 64 bits */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">float</span>    jfloat;   <span class="comment">/* 32-bit IEEE 754 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span>   jdouble;  <span class="comment">/* 64-bit IEEE 754 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* &quot;cardinal indices and sizes&quot; */</span></span><br><span class="line"><span class="keyword">typedef</span> jint     jsize;</span><br></pre></td></tr></table></figure>

<p>以下是使用C语言时jni.h中定义的数据类型</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Reference types, in C.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>*           jobject;</span><br><span class="line"><span class="keyword">typedef</span> jobject         jclass;</span><br><span class="line"><span class="keyword">typedef</span> jobject         jstring;</span><br><span class="line"><span class="keyword">typedef</span> jobject         jarray;</span><br><span class="line"><span class="keyword">typedef</span> jarray          jobjectArray;</span><br><span class="line"><span class="keyword">typedef</span> jarray          jbooleanArray;</span><br><span class="line"><span class="keyword">typedef</span> jarray          jbyteArray;</span><br><span class="line"><span class="keyword">typedef</span> jarray          jcharArray;</span><br><span class="line"><span class="keyword">typedef</span> jarray          jshortArray;</span><br><span class="line"><span class="keyword">typedef</span> jarray          jintArray;</span><br><span class="line"><span class="keyword">typedef</span> jarray          jlongArray;</span><br><span class="line"><span class="keyword">typedef</span> jarray          jfloatArray;</span><br><span class="line"><span class="keyword">typedef</span> jarray          jdoubleArray;</span><br><span class="line"><span class="keyword">typedef</span> jobject         jthrowable;</span><br><span class="line"><span class="keyword">typedef</span> jobject         jweak;</span><br></pre></td></tr></table></figure>

<p>以下是使用C++时jni.h定义的数据类型</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Reference types, in C++</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_jobject</span> &#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_jclass</span> : <span class="keyword">public</span> _jobject &#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_jstring</span> : <span class="keyword">public</span> _jobject &#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_jarray</span> : <span class="keyword">public</span> _jobject &#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_jobjectArray</span> : <span class="keyword">public</span> _jarray &#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_jbooleanArray</span> : <span class="keyword">public</span> _jarray &#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_jbyteArray</span> : <span class="keyword">public</span> _jarray &#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_jcharArray</span> : <span class="keyword">public</span> _jarray &#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_jshortArray</span> : <span class="keyword">public</span> _jarray &#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_jintArray</span> : <span class="keyword">public</span> _jarray &#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_jlongArray</span> : <span class="keyword">public</span> _jarray &#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_jfloatArray</span> : <span class="keyword">public</span> _jarray &#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_jdoubleArray</span> : <span class="keyword">public</span> _jarray &#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_jthrowable</span> : <span class="keyword">public</span> _jobject &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> _jobject*       jobject;</span><br><span class="line"><span class="keyword">typedef</span> _jclass*        jclass;</span><br><span class="line"><span class="keyword">typedef</span> _jstring*       jstring;</span><br><span class="line"><span class="keyword">typedef</span> _jarray*        jarray;</span><br><span class="line"><span class="keyword">typedef</span> _jobjectArray*  jobjectArray;</span><br><span class="line"><span class="keyword">typedef</span> _jbooleanArray* jbooleanArray;</span><br><span class="line"><span class="keyword">typedef</span> _jbyteArray*    jbyteArray;</span><br><span class="line"><span class="keyword">typedef</span> _jcharArray*    jcharArray;</span><br><span class="line"><span class="keyword">typedef</span> _jshortArray*   jshortArray;</span><br><span class="line"><span class="keyword">typedef</span> _jintArray*     jintArray;</span><br><span class="line"><span class="keyword">typedef</span> _jlongArray*    jlongArray;</span><br><span class="line"><span class="keyword">typedef</span> _jfloatArray*   jfloatArray;</span><br><span class="line"><span class="keyword">typedef</span> _jdoubleArray*  jdoubleArray;</span><br><span class="line"><span class="keyword">typedef</span> _jthrowable*    jthrowable;</span><br><span class="line"><span class="keyword">typedef</span> _jobject*       jweak;</span><br></pre></td></tr></table></figure>

<p>typedef 是为类型定义别名，从上面的代码来看，除了基本类型，在引用类型中，C最终是可以看成是void *,</p>
<p>而C++可以看成_jobject*。</p>
<p>全部写成void*    或者_jobject*    也是可以的,这里这么写主要是为了可读性和可扩展性。</p>
<p><strong>字符集</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在讲解数据类型的操作函数之前，先看一下字符集，为什么要讲解字符集，回到前面仔细观察一下基本类型的char，这个类型，在java中</span><br><span class="line">	和C/C++中占用的空间是不同的。熟悉C的朋友都知道，C语言中的char类型占用的是一个字节，而在java中char是占用了两个字节的，</span><br><span class="line">	而jchar也是占用了两个字节。这是因为java和C/C++使用的字符集不同，java使用的是Unicode字符集，而C使用的是ASCII字符集。</span><br></pre></td></tr></table></figure>

<p>Unicode字符集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Unicode是一个全球性的字符编码标准，它为世界上几乎所有的字符（包括各种文字、符号、标点符号等）都分配了唯一的代码点。每个代码</span><br><span class="line">	点用十六进制表示，例如U+0041代表拉丁字母&quot;A&quot;，U+4E2D代表汉字&quot;中&quot;。Unicode字符集的目标是为了包含地球上所有的书写系统。</span><br><span class="line"></span><br><span class="line">Unicode有不同的编码方案，最常见的是UTF-8、UTF-16和UTF-32。这些编码方案允许将Unicode代码点转换为字节序列以便存储和传输。</span><br></pre></td></tr></table></figure>

<p>ASCII字符集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ASCII字符集仅包含128个字符，包括英文字母、数字和一些特殊符号。这个字符集不足以表示全球范围内的所有字符，因此对于多语言支持</span><br><span class="line">	和Unicode字符，C语言需要借助宽字符类型（wchar_t）和相关的函数。</span><br><span class="line"></span><br><span class="line">所以，总的来说，Unicode字符集是一个包含全球字符的标准，可以表示各种语言和符号。而C中的char类型在默认情况下使用的是较小的字</span><br><span class="line">	符集（通常是ASCII或其扩展），需要通过宽字符类型和函数来支持Unicode字符。要在C中完全支持Unicode字符集，推荐使用wchar_t和</span><br><span class="line">	相关的宽字符函数。</span><br><span class="line"></span><br><span class="line">由于上面的不同，所以在使用jchar的时候要格外注意。如果java中的字符串仅包含了ASCII的字符，可以直接将jchar转换成char使用，这</span><br><span class="line">	是因为ASCII字符在Unicode中的表示和ASCII字符集中的表示是一致的。</span><br><span class="line"></span><br><span class="line">但是，如果java中的字符串包含了非ASCII的字符，比如汉字(一个字节无法表示)，则需要注意字符编码的转换，一般这种情况可以使用java</span><br><span class="line">	中的String类的getBytes方法将字符串转化为字节数组，指定为UTF-8字符集，然后在C中直接使用对应的字符集函数将字节数组转换成char</span><br><span class="line">	数组。</span><br></pre></td></tr></table></figure>

<p>所以，接下来我们看一下常用的几类数据类型的操作。</p>
<p><strong>常用数据操作函数</strong></p>
<p>基本数据类型操作</p>
<p>字符转换</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">JNIEXPORT <span class="type">void</span> JNICALL</span><br><span class="line"><span class="title function_">Java_com_jiangc_example1_MainActivity_charTest</span><span class="params">(JNIEnv *env, jobject thiz, jchar a, jchar b)</span> &#123;</span><br><span class="line">    <span class="type">int</span> codePoint = (<span class="type">int</span>) b;</span><br><span class="line">    <span class="type">char</span> utf8Char[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">if</span> (codePoint &lt; <span class="number">0x80</span>) &#123;    <span class="comment">// 128</span></span><br><span class="line">        utf8Char[<span class="number">0</span>] = (<span class="type">char</span>) codePoint;</span><br><span class="line">        utf8Char[<span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (codePoint &lt; <span class="number">0x800</span>) &#123;    <span class="comment">// 对于UTF-8编码来说，对于范围在0x80到0x7FF之间的Unicode字符用两个字节</span></span><br><span class="line">        <span class="comment">// 0x7ff</span></span><br><span class="line">        utf8Char[<span class="number">0</span>] = (<span class="type">char</span>)(<span class="number">0xC0</span> | (codePoint &gt;&gt; <span class="number">6</span>));</span><br><span class="line">        utf8Char[<span class="number">1</span>] = (<span class="type">char</span>)(<span class="number">0x80</span> | (codePoint &amp; <span class="number">0x3F</span>));</span><br><span class="line">        utf8Char[<span class="number">2</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        utf8Char[<span class="number">0</span>] = (<span class="type">char</span>)(<span class="number">0xE0</span> | (codePoint &gt;&gt; <span class="number">12</span>));</span><br><span class="line">        utf8Char[<span class="number">1</span>] = (<span class="type">char</span>)(<span class="number">0x80</span> | ((codePoint &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x3F</span>));</span><br><span class="line">        utf8Char[<span class="number">2</span>] = (<span class="type">char</span>)(<span class="number">0x80</span> | (codePoint &amp; <span class="number">0x3F</span>));</span><br><span class="line">        utf8Char[<span class="number">3</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    LOGE(<span class="string">&quot;jchar ============================== a = %c  b = %s\n&quot;</span>, a, utf8Char);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字符串创建</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line">jstring str = env-&gt;NewStringUTF(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数含义</span></span><br><span class="line"><span class="comment">// 这个函数在正常情况下会返回一个jstring，可以直接返回给JAVA端使用。</span></span><br><span class="line"><span class="comment">// 使用时需要做判断，如下</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">NULL</span> == str)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 出错了</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 其他深入的用法后面再说，这里先了解简单用法</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> 获取java端的字符串并转化成C&#x2F;C++端字符串</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TODO 获取jstring转化成C字符串</span></span><br><span class="line"><span class="comment"> * string: 要转换的Java字符串（jstring对象）</span></span><br><span class="line"><span class="comment"> * isCopy: 一个可选的指向jboolean变量的指针。当isCopy不为NULL时，</span></span><br><span class="line"><span class="comment"> * 函数将通过它返回一个标志，表示返回的C字符串是从Java字符串拷贝而来（JNI_TRUE）</span></span><br><span class="line"><span class="comment"> * 还是直接指向Java字符串的内部数据（JNI_FALSE）。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 函数返回值：</span></span><br><span class="line"><span class="comment"> * 如果成功，返回一个指向UTF-8编码的C字符串的指针。</span></span><br><span class="line"><span class="comment"> * 如果发生错误（如内存不足），返回NULL。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * TODO： 最终，这里调用的都是三个参数的 GetStringUTFChars(JNIEnv*, jstring, jboolean*);</span></span><br><span class="line"><span class="comment"> *        只是，封装了一次罢了，这里我们先不管env是什么，后面再讲，先使用两个参数的函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *cString = env-&gt;GetStringUTFChars(str, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">NULL</span> == cString) &#123;</span><br><span class="line">    LOGE(<span class="string">&quot;获取C字符串失败\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 这里注意，一定一定要记得释放，否则会内存泄漏</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 即便返回的字符串直接指向java字符串的内部数据，也不要修改它，不然会导致一些不确定的行为。</span></span><br><span class="line">env-&gt;ReleaseStringUTFChars(str, cString);</span><br></pre></td></tr></table></figure>

<p>函数的使用看上面的代码注释就可以了，需要注意的就是，在不使用的情况下，要对字符串进行释放，而且不要尝试修改获取到的字符串。</p>
<p>获取字符串的长度</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个视频里面没有讲，函数使用也很简单，看一下就知道了</span></span><br><span class="line">jsize <span class="title function_">GetStringLength</span><span class="params">(jstring <span class="built_in">string</span>)</span>;</span><br><span class="line"><span class="comment">// 这个函数返回一个jsize，也就是jint，也就是int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用方式：</span></span><br><span class="line"><span class="type">int</span> length = env-&gt;GetStringLength(str);</span><br></pre></td></tr></table></figure>

<p>数组操作</p>
<p>注意：对于数组，我们只讲一种类型，因为其他类型操作方式一样，大家可以自己尝试使用一下其他类型的数组函数</p>
<p>复制数组到native</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这个函数是将java端的数组内容复制到native端提供的数组中</span></span><br><span class="line"><span class="comment"> * @param array       java端数组</span></span><br><span class="line"><span class="comment"> * @param start       从哪里开始复制，比如从0开始</span></span><br><span class="line"><span class="comment"> * @param len         复制几个元素</span></span><br><span class="line"><span class="comment"> * @param buf         native端的数组地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">GetIntArrayRegion</span><span class="params">(jintArray <span class="built_in">array</span>, jsize start, jsize len,</span></span><br><span class="line"><span class="params">                       jint* buf)</span>;</span><br><span class="line"><span class="comment">// 使用也很简单</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO 1. 数组复制</span></span><br><span class="line">    <span class="type">int</span> *pArray = nullptr;</span><br><span class="line">    pArray = static_cast&lt;<span class="type">int</span> *&gt;(<span class="built_in">malloc</span>(length * <span class="keyword">sizeof</span>(<span class="type">int</span>)));</span><br><span class="line">    <span class="comment">// 数组复制到了pArray中</span></span><br><span class="line">    <span class="comment">// 对应了 Get&lt;Type&gt;ArrayRegion</span></span><br><span class="line">    env-&gt;GetIntArrayRegion(<span class="built_in">array</span>, <span class="number">0</span>, length, pArray);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样，就可以对数组进行操作了，但是，操作的修改不会被同步到java中，因为是复制的。</p>
<p>如果想将修改同步到java端，需要进行提交操作</p>
<p>数组设置(将native中的数组数据同步到java)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将native的数组内容设置到java端的数组中</span></span><br><span class="line"><span class="comment"> * @param array    被设置的java端的数组</span></span><br><span class="line"><span class="comment"> * @param start    从哪里开始设置</span></span><br><span class="line"><span class="comment"> * @param len      设置几个元素</span></span><br><span class="line"><span class="comment"> * @param buf      native的数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">SetIntArrayRegion</span><span class="params">(jintArray <span class="built_in">array</span>, jsize start, jsize len,</span></span><br><span class="line"><span class="params">                       <span class="type">const</span> jint* buf)</span>;</span><br><span class="line">    <span class="comment">// 修改</span></span><br><span class="line">    pArray[<span class="number">3</span>] = <span class="number">9</span>;</span><br><span class="line">    LOGE(<span class="string">&quot;after pArray[3] = %d\n&quot;</span>, pArray[<span class="number">3</span>]);</span><br><span class="line">    <span class="comment">// 如果想给数组提交到java,可以使用下面的方法</span></span><br><span class="line">    <span class="comment">// 对应了Set&lt;Type&gt;ArrayRegion</span></span><br><span class="line">    env-&gt;SetIntArrayRegion(<span class="built_in">array</span>, <span class="number">0</span>, length, pArray);</span><br></pre></td></tr></table></figure>

<p>注意： 一般来讲，我们不会大量使用复制数组，然后将改变的数据再同步到java，这样效率太低，一般使用指针的方式进行操作。</p>
<p> 获取java端数组指针</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取java端数组指针</span></span><br><span class="line"><span class="comment"> * @param array </span></span><br><span class="line"><span class="comment"> * @param isCopy </span></span><br><span class="line"><span class="comment"> * @return </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">jint* <span class="title function_">GetIntArrayElements</span><span class="params">(jintArray <span class="built_in">array</span>, jboolean* isCopy)</span>;</span><br><span class="line"><span class="comment">// 函数使用方法如下：</span></span><br><span class="line">    <span class="comment">// 对应了 Get&lt;Type&gt;ArrayElements</span></span><br><span class="line">    jint *elements = env-&gt;GetIntArrayElements(<span class="built_in">array</span>, nullptr);</span><br><span class="line">    <span class="keyword">if</span> (nullptr == elements) &#123;</span><br><span class="line">        <span class="keyword">return</span> nullptr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通过指针访问数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">        elements[i] = i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO 在获取到数组指针之后也要记得释放，否则会内存泄漏</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这个函数，前面两个参数一看就知道了，主要说明一下最后一个参数</span></span><br><span class="line"><span class="comment">     * mode: 释放数组元素时的标志</span></span><br><span class="line"><span class="comment">     * 主要有以下取值：</span></span><br><span class="line"><span class="comment">     * 0： 对Java的数组进行更新并释放C/C++的数组</span></span><br><span class="line"><span class="comment">     * JNI_COMMIT ：对Java的数组进行更新但是不释放C/C++的数组，一般用于周期性的修改java数组</span></span><br><span class="line"><span class="comment">     * JNI_ABORT：对Java的数组不进行更新,释放C/C++的数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">     <span class="comment">// 对应了 Release&lt;Type&gt;ArrayElements</span></span><br><span class="line">    env-&gt;ReleaseIntArrayElements(javaArray, elements, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>注意： 和string一样，凡是获取了指针的，一律记得释放，否则内存泄漏。</p>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/2/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/30/">30</a><a class="extend next" rel="next" href="/page/4/">Next &amp;raquo;</a>
        </nav>
    
</section>
        </div>
        <footer id="footer">
    <div class="outer">
       
    </div>
</footer>

        

    
        
<script src="/libs/lightgallery/js/lightgallery.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-pager.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-zoom.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-hash.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-share.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-video.min.js"></script>

    
    
        
<script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>

    
    



<!-- Custom Scripts -->

<script src="/js/main.js"></script>


    </div>
</body>
</html>